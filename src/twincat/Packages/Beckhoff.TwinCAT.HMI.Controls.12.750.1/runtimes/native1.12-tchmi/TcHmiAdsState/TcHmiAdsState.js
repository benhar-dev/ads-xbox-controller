var TcHmi;!function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){class TcHmiAdsState extends TcHmi.Controls.System.TcHmiControl{constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__subscriptionId=null,this.__localizedElements=new Map,this.__localizationReader=void 0,this.__destroyLocalizationWatch=null,this.__onResolverForStateImagesWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("stateImages"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__stateImages)||(this.__stateImages=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"StateImages"}),this.__processStateImages()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.StateImage, Id="+this.getId()+", Attribute=StateImages] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))}}__previnit(){if(super.__previnit(),this.__elementTemplateRoot=this.__element[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiAdsState-template")[0],!this.__elementTemplateRoot)throw new Error("Invalid Template.html");this.__destroyLocalizationWatch=this.__localization.watch(data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.setAttribute("title",tchmi_decode_control_characters(localizedText))}}})}__init(){super.__init()}__attach(){super.__attach(),this.__updateSubscription()}__detach(){super.__detach(),null!==this.__subscriptionId&&TcHmi.Server.unsubscribeEx(this.__subscriptionId,null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage(data.details))})}destroy(){var _a;this.__keepAlive||(super.destroy(),null===(_a=this.__destroyLocalizationWatch)||void 0===_a||_a.call(this))}__updateSubscription(){var _a,_b;TCHMI_DESIGNER||(null!==this.__subscriptionId&&TcHmi.Server.unsubscribeEx(this.__subscriptionId,null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage(data.details))}),this.__subscriptionId=TcHmi.Server.subscribeEx([{commandOptions:["SendErrorMessage"],symbol:this.__serverDomain+".AdsSyncReadStateReq",writeValue:this.__adsRuntime}],null!==(_b=null!==(_a=this.__serverInterval)&&void 0!==_a?_a:TcHmi.Config.get().tcHmiServer.websocketIntervalTime)&&void 0!==_b?_b:500,null,this.__serverResponseHandler()))}__serverResponseHandler(){return data=>{var _a,_b,_c,_d,_e,_f,_g,_h;if(this.__removeLocalizedElement(this.__elementTemplateRoot),data.error!==TcHmi.Errors.NONE)return TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage(data.details)),(null===(_a=data.details)||void 0===_a?void 0:_a.message)?this.__addLocalizedElement(this.__elementTemplateRoot,"ErrorPlaceholder",data.details.message):this.__addLocalizedElement(this.__elementTemplateRoot,"SubscriptionFailed",this.__serverDomain),void this.__elementTemplateRoot.setAttribute("data-tchmi-runtime-state","ConnectionError");if(!data.response)return TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()},Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type})),this.__addLocalizedElement(this.__elementTemplateRoot,"MissingResponse"),void this.__elementTemplateRoot.setAttribute("data-tchmi-runtime-state","ConnectionError");if(data.response.error)return TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage(data.response.error)),data.response.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"ErrorPlaceholder",data.response.error.message):this.__addLocalizedElement(this.__elementTemplateRoot,"SubscriptionFailed",this.__serverDomain),void this.__elementTemplateRoot.setAttribute("data-tchmi-runtime-state","ConnectionError");if(!data.response.commands||0===data.response.commands.length)return TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:"Missing commands in response from server with id: '"+data.response.id+"'.",domain:this.__type})),this.__addLocalizedElement(this.__elementTemplateRoot,"MissingCommands",data.response.id),void this.__elementTemplateRoot.setAttribute("data-tchmi-runtime-state","ConnectionError");for(const command of data.response.commands){if(command.error){TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=`+this.__serverDomain+".AdsSyncReadStateReq] "+TcHmi.Log.buildMessage(command.error)),"HMI_ADS_E_INVALID_RUNTIME"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"InvalidRuntime",this.__adsRuntime):"HMI_ADS_E_STATE"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"InvalidRouter"):"HMI_ADS_E_INVALID_SYMBOL"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"InvalidSymbol"):"HMI_ADS_E_INVALID_PARAMETER"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"InvalidParameter"):"HMI_ADS_E_TCVERSION"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"InvalidTwinCATVersion"):"HMI_ADS_E_CONFIGDIR"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"ConfigDirectory"):"HMI_ADS_E_PARSE_BASETYPES"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"ParseBaseTypes"):"HMI_ADS_E_PARSE_DATA"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"ParseAdsDate"):"HMI_ADS_E_INVALID_DATA"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"InvalidData"):"HMI_ADS_E_MISSING_PARAMETER"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"MissingParameter"):"HMI_ADS_E_DISABLED"===command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"RuntimeDisabled",this.__adsRuntime):command.error.message?this.__addLocalizedElement(this.__elementTemplateRoot,"ErrorPlaceholder",command.error.message):this.__addLocalizedElement(this.__elementTemplateRoot,"SubscriptionFailed",this.__serverDomain),this.__elementTemplateRoot.setAttribute("data-tchmi-runtime-state","ConnectionError");let imgUrl="";(null===(_b=this.__stateImages)||void 0===_b?void 0:_b.Error)?imgUrl="url("+this.__stateImages.Error+")":(null===(_c=this.__stateImages)||void 0===_c?void 0:_c.Fallback)&&(imgUrl="url("+this.__stateImages.Fallback+")"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"background-image",imgUrl);continue}let adsState=null!==(_e=null===(_d=null==command?void 0:command.readValue)||void 0===_d?void 0:_d.AdsState)&&void 0!==_e?_e:TcHmiAdsState.AdsState.Error,state=null!==(_f=TcHmiAdsState.AdsState[adsState])&&void 0!==_f?_f:"Unknown";this.__addLocalizedElement(this.__elementTemplateRoot,"State",this.__serverDomain,this.__adsRuntime,state),this.__elementTemplateRoot.setAttribute("data-tchmi-runtime-state",state);let imgUrl="";(null===(_g=this.__stateImages)||void 0===_g?void 0:_g[state])?imgUrl="url("+this.__stateImages[state]+")":(null===(_h=this.__stateImages)||void 0===_h?void 0:_h.Fallback)&&(imgUrl="url("+this.__stateImages.Fallback+")"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"background-image",imgUrl)}}}__addLocalizedElement(element,key,...parameters){let info={key:key};if(0!==parameters.length&&(info.parameters=parameters),this.__localizedElements.set(element,info),this.__localizationReader){let localizedText=this.__localizationReader.get(key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.setAttribute("title",tchmi_decode_control_characters(localizedText))}}__removeLocalizedElement(element){this.__localizedElements.delete(element)}setAdsRuntime(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AdsRuntime")),convertedValue!==this.__adsRuntime&&(this.__adsRuntime=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AdsRuntime"}),this.__processAdsRuntime())}getAdsRuntime(){return this.__adsRuntime}__processAdsRuntime(){this.__isAttached&&this.__updateSubscription()}setServerInterval(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerInterval")),convertedValue!==this.__serverInterval&&(this.__serverInterval=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerInterval"}),this.__processServerInterval())}getServerInterval(){return this.__serverInterval}__processServerInterval(){this.__isAttached&&this.__updateSubscription()}setServerDomain(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerDomain")),convertedValue!==this.__serverDomain&&(this.__serverDomain=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerDomain"}),this.__processServerDomain())}getServerDomain(){return this.__serverDomain}__processServerDomain(){this.__isAttached&&this.__updateSubscription()}setStateImages(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("StateImages"));let resolverInfo=this.__objectResolvers.get("stateImages");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("stateImages",{resolver:resolver,watchCallback:this.__onResolverForStateImagesWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForStateImagesWatchCallback)})}getStateImages(){return this.__stateImages}__processStateImages(){this.__isAttached&&this.__updateSubscription()}}Beckhoff.TcHmiAdsState=TcHmiAdsState,function(TcHmiAdsState){let AdsState;!function(AdsState){AdsState[AdsState.Invalid=0]="Invalid",AdsState[AdsState.Idle=1]="Idle",AdsState[AdsState.Reset=2]="Reset",AdsState[AdsState.Init=3]="Init",AdsState[AdsState.Start=4]="Start",AdsState[AdsState.Run=5]="Run",AdsState[AdsState.Stop=6]="Stop",AdsState[AdsState.SaveCfg=7]="SaveCfg",AdsState[AdsState.LoadCfg=8]="LoadCfg",AdsState[AdsState.PowerFailure=9]="PowerFailure",AdsState[AdsState.PowerGood=10]="PowerGood",AdsState[AdsState.Error=11]="Error",AdsState[AdsState.Shutdown=12]="Shutdown",AdsState[AdsState.Suspend=13]="Suspend",AdsState[AdsState.Resume=14]="Resume",AdsState[AdsState.Config=15]="Config",AdsState[AdsState.Reconfig=16]="Reconfig",AdsState[AdsState.Stopping=17]="Stopping",AdsState[AdsState.Incompatible=18]="Incompatible",AdsState[AdsState.Exception=19]="Exception"}(AdsState=TcHmiAdsState.AdsState||(TcHmiAdsState.AdsState={}))}(TcHmiAdsState=Beckhoff.TcHmiAdsState||(Beckhoff.TcHmiAdsState={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiAdsState","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiAdsState);