var TcHmi;!function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){class TcHmiKeyboard extends TcHmi.Controls.System.TcHmiControl{constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__layouts=null,this.__currentLayout={name:"empty",dimensions:{width:1,height:1},keys:[]},this.__fixedTargetInputElements=null,this.__fixedTargetTextareaElements=null,this.__layoutFileXhr=null,this.__modifiers={Shift:!1,Control:!1,Alt:!1,Meta:!1,CapsLock:!1,NumLock:!0,Insert:!1},this.__keys=new Map,this.__additionalKeys=new Map,this.__pressedKeyMouse=null,this.__pressedKeysTouch=[],this.__pressedKeys=[],this.__keyActions={KeyChar:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;let text=activeInput.value;null==text&&(text="");let specialKey=this.__specialKeys[key.key[sequenceIndex]],typedChar=void 0!==specialKey?specialKey:key.key[sequenceIndex];typedChar=this.__unescape(typedChar),null!==this.__compositionKey&&void 0!==this.__compositionKey.composition[typedChar]&&(typedChar=this.__compositionKey.composition[typedChar]),this.__compositionKey=null;let selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");activeInput.value=text.substring(0,selectionStart)+typedChar+text.substring(this.__modifiers.Insert?selectionEnd+1:selectionEnd),this.__setCaretPosition(activeInput,selectionStart+typedChar.length)},release:(key,activeInput,sequenceIndex)=>{key.ignoreModifiers||this.__unstickAllKeys()}},Shift:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Shift",!0),release:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Shift",!1)},Control:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Control",!0),release:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Control",!1)},Alt:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Alt",!0),release:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Alt",!1)},Meta:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Meta",!0),release:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Meta",!1)},CapsLock:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("CapsLock")},NumLock:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("NumLock")},Insert:{press:(key,activeInput,sequenceIndex)=>this.__toggleModifier("Insert")},ArrowLeft:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;let selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");this.__modifiers.Shift||selectionStart===selectionEnd?this.__moveCaret(activeInput,"backward",currentPosition=>this.__caretPositionLeft(currentPosition,activeInput.value,key.ignoreModifiers),key.ignoreModifiers):this.__setCaretPosition(activeInput,selectionStart),this.__arrowUpDownTarget=null}},ArrowRight:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;let selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");this.__modifiers.Shift||selectionStart===selectionEnd?this.__moveCaret(activeInput,"forward",currentPosition=>this.__caretPositionRight(currentPosition,activeInput.value,key.ignoreModifiers),key.ignoreModifiers):this.__setCaretPosition(activeInput,selectionEnd),this.__arrowUpDownTarget=null}},ArrowUp:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;this.__moveCaret(activeInput,"backward",currentPosition=>{let mirrorElement=this.__getMirrorElement(activeInput),currentCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,currentPosition),lastCoords=currentCoords,newPosition=currentPosition-1,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition),selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");for(null!==this.__arrowUpDownTarget&&this.__arrowUpDownTarget.input===activeInput&&this.__arrowUpDownTarget.selectionStart===selectionStart&&this.__arrowUpDownTarget.selectionEnd===selectionEnd||(this.__arrowUpDownTarget={left:currentCoords.left,input:activeInput,selectionStart:selectionStart,selectionEnd:selectionEnd});newPosition>=0&&(newCoords.top===currentCoords.top||newCoords.left>this.__arrowUpDownTarget.left);)lastCoords=newCoords,newPosition--,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition);return mirrorElement.parentNode.removeChild(mirrorElement),newPosition<0?0:this.__arrowUpDownTarget.left-newCoords.left<=lastCoords.left-this.__arrowUpDownTarget.left||lastCoords.top===currentCoords.top?newPosition:newPosition+1},key.ignoreModifiers),null!==this.__arrowUpDownTarget&&(this.__arrowUpDownTarget.selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),this.__arrowUpDownTarget.selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd"))}},ArrowDown:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;this.__moveCaret(activeInput,"forward",currentPosition=>{let mirrorElement=this.__getMirrorElement(activeInput),currentCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,currentPosition),lastCoords=currentCoords,newPosition=currentPosition+1,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition),topDifference=0,selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");for(null!==this.__arrowUpDownTarget&&this.__arrowUpDownTarget.input===activeInput&&this.__arrowUpDownTarget.selectionStart===selectionStart&&this.__arrowUpDownTarget.selectionEnd===selectionEnd||(this.__arrowUpDownTarget={left:currentCoords.left,input:activeInput,selectionStart:selectionStart,selectionEnd:selectionEnd});newPosition<=activeInput.value.length&&(newCoords.top===currentCoords.top||newCoords.left<this.__arrowUpDownTarget.left)&&(0===topDifference||newCoords.top-currentCoords.top<=topDifference);)topDifference=newCoords.top-currentCoords.top,lastCoords=newCoords,newPosition++,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition);return mirrorElement.parentNode.removeChild(mirrorElement),newPosition>activeInput.value.length?activeInput.value.length:0!==topDifference&&newCoords.top-currentCoords.top>topDifference?newPosition-1:newCoords.left-this.__arrowUpDownTarget.left<this.__arrowUpDownTarget.left-lastCoords.left||lastCoords.top===currentCoords.top?newPosition:newPosition-1},key.ignoreModifiers),null!==this.__arrowUpDownTarget&&(this.__arrowUpDownTarget.selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),this.__arrowUpDownTarget.selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd"))}},Home:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;this.__moveCaret(activeInput,"backward",currentPosition=>{if(this.__modifiers.Control&&!key.ignoreModifiers)return 0;let mirrorElement=this.__getMirrorElement(activeInput),currentCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,currentPosition),newPosition=currentPosition-1,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition);for(;newPosition>=0&&newCoords.top===currentCoords.top;)newPosition--,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition);return mirrorElement.parentNode.removeChild(mirrorElement),newPosition<0?0:newPosition+1},key.ignoreModifiers)}},End:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;this.__moveCaret(activeInput,"forward",currentPosition=>{if(this.__modifiers.Control&&!key.ignoreModifiers)return activeInput.value.length;let mirrorElement=this.__getMirrorElement(activeInput),currentCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,currentPosition),newPosition=currentPosition+1,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition);for(;newPosition<=activeInput.value.length&&newCoords.top===currentCoords.top;)newPosition++,newCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,newPosition);return mirrorElement.parentNode.removeChild(mirrorElement),newPosition>activeInput.value.length?activeInput.value.length:newPosition-1},key.ignoreModifiers)}},Backspace:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;let selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd"),text=activeInput.value;selectionStart===selectionEnd&&(selectionStart=this.__caretPositionLeft(selectionStart,text,key.ignoreModifiers)),text=text.substring(0,selectionStart)+text.substring(selectionEnd),activeInput.value=text,this.__setCaretPosition(activeInput,selectionStart)}},Delete:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;let selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd"),text=activeInput.value;selectionStart===selectionEnd&&(selectionEnd=this.__caretPositionRight(selectionEnd,text,key.ignoreModifiers)),text=text.substring(0,selectionStart)+text.substring(selectionEnd),activeInput.value=text,this.__setCaretPosition(activeInput,selectionStart)}},SelectAll:{press:(key,activeInput,sequenceIndex)=>{if(null!==activeInput){this.__setSelectionStartOrEnd(activeInput,"selectionStart",0),this.__setSelectionStartOrEnd(activeInput,"selectionEnd",activeInput.value.length);try{activeInput.selectionDirection="forward"}catch(ex){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] Tried to set selectionDirection on an input element that does not support this. Try using an <input type="text" /> element.`)}}},release:(key,activeInput,sequenceIndex)=>{key.ignoreModifiers||this.__unstickAllKeys()}},PlusMinus:{press:(key,activeInput,sequenceIndex)=>{if(null===activeInput)return;let text=activeInput.value,convertedText=Number(text),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");""===text?(activeInput.value="-",this.__setCaretPosition(activeInput,1)):"-"===text?(activeInput.value="",this.__setCaretPosition(activeInput,0)):isNaN(convertedText)||(convertedText>0?(activeInput.value="-"+text,this.__setCaretPosition(activeInput,selectionEnd+1)):convertedText<0||text.startsWith("-")?(activeInput.value=text.substring(1),this.__setCaretPosition(activeInput,selectionEnd-1)):(activeInput.value="-"+text,this.__setCaretPosition(activeInput,selectionEnd+1)))}}},this.__keyCodes={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Delete:46,";":186,":":186,"=":187,"+":187,",":188,"<":188,"-":189,_:189,".":190,">":190,"/":191,"?":191,"~":192,"[":219,"{":219,"\\":220,"|":220,"]":221,"}":221,"'":222,'"':222,"^":220,"Â´":221,"`":221},this.__specialKeys={Tab:"\t",Enter:"\n"},this.__stickiedKeys=[],this.__keysToStick=[],this.__compositionKey=null,this.__interactedKeys=[],this.__additionalKeysBaseKey=null,this.__arrowUpDownTarget=null,this.__shownLabels=[],this.__hiddenLabels=[],this.__indirectInputElement=null,this.__activeElement=null,this.__fixedTargetObserver=null,this.__iframes=new Set,this.__destroyOnResized=null,this.__destroyOnIframeElementAdded=null,this.__destroyOnIframeElementRemoved=null,this.__destroyOnAttached=null,this.__destroyOnDestroyed=null,this.__onResized=(evt,ctrl)=>{this.__processScaleMode()},this.__onIframeElementAdded=(evt,iframe)=>{this.__iframes.has(iframe)||(this.__iframes.add(iframe),iframe.addEventListener("load",this.__onIframeLoad,{passive:!0,capture:!1}),this.__handleIframeAddedOrLoaded(iframe))},this.__onIframeElementRemoved=(evt,iframe)=>{this.__iframes.has(iframe)&&(iframe.contentDocument&&this.__removeDocumentLevelEventListeners(iframe.contentDocument),iframe.removeEventListener("load",this.__onIframeLoad,{capture:!1}),this.__iframes.delete(iframe))},this.__onIframeLoad=event=>{event.target instanceof HTMLIFrameElement&&this.__handleIframeAddedOrLoaded(event.target)},this.__onFocusIn=event=>{var _a,_b;this.__layouts&&this.__layouts.useIndirectInput&&!this.__fixedTarget&&event.target!==this.__indirectInputElement&&this.__setActiveElement(event.target instanceof(null!==(_a=event.view)&&void 0!==_a?_a:window).HTMLInputElement||event.target instanceof(null!==(_b=event.view)&&void 0!==_b?_b:window).HTMLTextAreaElement?event.target:null)},this.__onFocusOut=event=>{this.__layouts&&this.__layouts.useIndirectInput&&!this.__fixedTarget&&event.relatedTarget!==this.__indirectInputElement&&(event.view===window?this.__setActiveElement(null):event.target&&event.target===this.__activeElement&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{event.target===this.__activeElement&&document.activeElement!==this.__indirectInputElement&&this.__setActiveElement(null)})}))},this.__onRootMouseDownOrTouchStart=event=>{"mousedown"===event.type&&0!==event.button||this.__layouts&&this.__layouts.useIndirectInput&&event.target===this.__indirectInputElement||event.preventDefault()},this.__onDocumentMouseDownOrTouchStart=event=>{var _a;if(null!==this.__additionalKeysBaseKey&&event.target!==this.__additionalKeysBaseKey.element&&event.target instanceof(null!==(_a=event.view)&&void 0!==_a?_a:window).Element){let additionalKeysContainer=this.__additionalKeys.get(this.__additionalKeysBaseKey.element);additionalKeysContainer&&!additionalKeysContainer.contains(event.target)&&this.__hideAdditionalKeys()}},this.__onMouseDown=event=>{if(!(0===event.button&&event.target instanceof HTMLElement&&this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")))return;let keyElement=event.target;for(;keyElement&&(!keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")||!keyElement.classList.contains("tchmi-keyboard-template-key"));){if(keyElement===event.currentTarget)return;keyElement=keyElement.parentElement}keyElement&&this.__pressedKeyMouse!==keyElement&&(keyElement.classList.add("down"),this.__pressedKeyMouse=keyElement,this.__keyInteractionStarted(keyElement),this.__raiseKeyPressStarted(keyElement))},this.__onMouseOver=event=>{if(!(event.target instanceof HTMLElement&&this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")))return;let keyElement=event.target;for(;keyElement&&(!keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")||!keyElement.classList.contains("tchmi-keyboard-template-key"));){if(keyElement===event.currentTarget)return;keyElement=keyElement.parentElement}keyElement&&(keyElement.classList.add("hover"),event.buttons>0&&null!==this.__additionalKeysBaseKey&&this.__additionalKeysBaseKey.dragging&&this.__additionalKeys.get(this.__additionalKeysBaseKey.element)===keyElement.parentElement&&!keyElement.classList.contains("down")&&(keyElement.classList.add("down"),this.__raiseKeyPressStarted(keyElement)))},this.__onMouseOut=event=>{if(!(event.target instanceof HTMLElement&&this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")))return;let keyElement=event.target;for(;keyElement&&(!keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")||!keyElement.classList.contains("tchmi-keyboard-template-key"));){if(keyElement===event.currentTarget)return;keyElement=keyElement.parentElement}keyElement&&(this.__handleMouseOrTouchLeave(keyElement,{x:event.clientX,y:event.clientY}),this.__pressedKeyMouse=null,this.__raiseKeyPressEnded(keyElement,"Canceled"))},this.__onMouseUp=event=>{if(!(event.target instanceof HTMLElement&&this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")))return;let keyElement=event.target;for(;keyElement&&(!keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")||!keyElement.classList.contains("tchmi-keyboard-template-key"));){if(keyElement===event.currentTarget)return;keyElement=keyElement.parentElement}keyElement&&(keyElement.classList.remove("down"),null!==this.__additionalKeysBaseKey&&(this.__additionalKeysBaseKey.dragging&&this.__additionalKeys.get(this.__additionalKeysBaseKey.element)===keyElement.parentElement&&(this.__pressedKeyMouse=keyElement,this.__keyInteractionStarted(keyElement)),this.__additionalKeysBaseKey.dragging=!1),keyElement===this.__pressedKeyMouse&&(this.__pressedKeyMouse=null,this.__keyInteractionEnded(keyElement),this.__raiseKeyPressEnded(keyElement,"Finished")))},this.__onTouchStart=event=>{if(this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate"))for(let i=0,ii=event.changedTouches.length;i<ii;i++){let touch=event.changedTouches[i];if(!(touch.target instanceof HTMLElement))continue;let keyElement=touch.target;for(;keyElement&&(!keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")||!keyElement.classList.contains("tchmi-keyboard-template-key"));){if(keyElement===event.currentTarget){keyElement=null;break}keyElement=keyElement.parentElement}keyElement&&(this.__pressedKeysTouch.filter(pressedKey=>pressedKey.keyElement===keyElement).length>0||(keyElement.classList.add("hover","down"),this.__pressedKeysTouch.push({touchID:touch.identifier,keyElement:keyElement}),this.__keyInteractionStarted(keyElement),this.__raiseKeyPressStarted(keyElement)))}},this.__onTouchMove=event=>{if(this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate"))for(let i=0,ii=event.changedTouches.length;i<ii;i++){let pressedKey=this.__pressedKeysTouch.filter(pressedKey=>pressedKey.touchID===event.changedTouches[i].identifier)[0];if(!pressedKey)continue;let touch=event.changedTouches[i],keyElement=document.elementFromPoint(touch.clientX,touch.clientY);if(null!==keyElement&&(keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label")||keyElement.classList.contains("tchmi-keyboard-template-label"))&&(keyElement=keyElement.parentElement),null===keyElement||keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")&&keyElement.classList.contains("tchmi-keyboard-template-key")||(keyElement=null),keyElement!==pressedKey.keyElement&&null!==pressedKey.keyElement){let interactedKeyRemoved=this.__handleMouseOrTouchLeave(pressedKey.keyElement,{x:touch.clientX,y:touch.clientY});if(this.__raiseKeyPressEnded(pressedKey.keyElement,"Canceled"),pressedKey.keyElement=null,!interactedKeyRemoved)continue}null!==keyElement&&null===pressedKey.keyElement&&(keyElement.classList.add("hover"),null!==this.__additionalKeysBaseKey&&this.__additionalKeysBaseKey.dragging&&this.__additionalKeys.get(this.__additionalKeysBaseKey.element)===keyElement.parentElement&&(keyElement.classList.add("down"),this.__raiseKeyPressStarted(keyElement)),pressedKey.keyElement=keyElement)}},this.__onTouchEndOrCancel=event=>{if(this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate"))for(let i=0,ii=event.changedTouches.length;i<ii;i++){let touch=event.changedTouches[i],pressedKey=this.__pressedKeysTouch.filter(pressedKey=>pressedKey.touchID===touch.identifier)[0];if(!(pressedKey&&touch.target instanceof HTMLElement))continue;let originalKeyElement=touch.target;for(;originalKeyElement&&(originalKeyElement.classList.contains(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")||originalKeyElement.classList.contains(".tchmi-keyboard-template-key"));){if(originalKeyElement===event.currentTarget){originalKeyElement=null;break}originalKeyElement=originalKeyElement.parentElement}if(!originalKeyElement)continue;originalKeyElement.classList.remove("hover"),originalKeyElement.classList.remove("down"),this.__pressedKeysTouch.splice(this.__pressedKeysTouch.indexOf(pressedKey),1);let keyElement=document.elementFromPoint(touch.clientX,touch.clientY);null!==keyElement&&(keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label")||keyElement.classList.contains("tchmi-keyboard-template-label"))&&(keyElement=keyElement.parentElement),null!==keyElement&&(keyElement.classList.remove("hover"),keyElement.classList.remove("down")),null===keyElement||keyElement.classList.contains("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key")&&keyElement.classList.contains("tchmi-keyboard-template-key")||(keyElement=null),null===keyElement||keyElement!==event.target&&keyElement.parentElement!==event.target||(null!==this.__additionalKeysBaseKey&&(this.__additionalKeysBaseKey.dragging&&this.__additionalKeys.get(this.__additionalKeysBaseKey.element)===keyElement.parentElement&&this.__keyInteractionStarted(keyElement),this.__additionalKeysBaseKey.dragging=!1),this.__keyInteractionEnded(keyElement),this.__raiseKeyPressEnded(keyElement,"Finished"))}},this.__onResolverForIndirectInputPaddingWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("indirectInputPadding"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__indirectInputPadding)||(this.__indirectInputPadding=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IndirectInputPadding"}),this.__processIndirectInputPadding()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=IndirectInputPadding] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForKeyboardPaddingWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("keyboardPadding"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__keyboardPadding)||(this.__keyboardPadding=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"KeyboardPadding"}),this.__processKeyboardPadding()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=KeyboardPadding] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForKeyPaddingWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("keyPadding"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__keyPadding)||(this.__keyPadding=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"KeyPadding"}),this.__processKeyPadding()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=KeyPadding] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForAdditionalKeyBackdropPaddingWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("additionalKeyBackdropPadding"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__additionalKeyBackdropPadding)||(this.__additionalKeyBackdropPadding=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AdditionalKeyBackdropPadding"}),this.__processAdditionalKeyBackdropPadding()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=AdditionalKeyBackdropPadding] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForKeyBackgroundColorWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("keyBackgroundColor"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__keyBackgroundColor)||(this.__keyBackgroundColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"KeyBackgroundColor"}),this.__processKeyBackgroundColor()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=KeyBackgroundColor] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForLabelColorWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("labelColor"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__labelColor)||(this.__labelColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelColor"}),this.__processLabelColor()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=LabelColor] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForLabelStrokeColorWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("labelStrokeColor"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__labelStrokeColor)||(this.__labelStrokeColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelStrokeColor"}),this.__processLabelStrokeColor()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=LabelStrokeColor] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForLabelFillColorWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("labelFillColor"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__labelFillColor)||(this.__labelFillColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelFillColor"}),this.__processLabelFillColor()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=LabelFillColor] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForAdditionalKeyBackdropColorWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("additionalKeyBackdropColor"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__additionalKeyBackdropColor)||(this.__additionalKeyBackdropColor=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AdditionalKeyBackdropColor"}),this.__processAdditionalKeyBackdropColor()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+", Attribute=AdditionalKeyBackdropColor] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))}}__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-keyboard-template")),this.__elementPaddingContainer=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-padding-container"),0===this.__elementPaddingContainer.length&&(this.__elementPaddingContainer=this.__elementTemplateRoot.find(".tchmi-keyboard-template-padding-container")),0===this.__elementTemplateRoot.length||0===this.__elementPaddingContainer.length)throw new Error("Invalid Template.html");super.__previnit()}__init(){if(super.__init(),!this.__layoutFile){let controlBasedLayoutAttr=this.__attrs["data-tchmi-layout"];controlBasedLayoutAttr&&this.setLayout(controlBasedLayoutAttr.value)}const passiveEventOptions={passive:!0,capture:!1},nonPassiveEventOptions={passive:!1,capture:!1};this.__element[0].addEventListener("mousedown",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),this.__element[0].addEventListener("touchstart",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),this.__element[0].addEventListener("mousedown",this.__onMouseDown,passiveEventOptions),this.__element[0].addEventListener("mouseover",this.__onMouseOver,passiveEventOptions),this.__element[0].addEventListener("mouseout",this.__onMouseOut,passiveEventOptions),this.__element[0].addEventListener("mouseup",this.__onMouseUp,passiveEventOptions),this.__element[0].addEventListener("touchstart",this.__onTouchStart,passiveEventOptions),this.__element[0].addEventListener("touchmove",this.__onTouchMove,passiveEventOptions),this.__element[0].addEventListener("touchend",this.__onTouchEndOrCancel,passiveEventOptions),this.__element[0].addEventListener("touchcancel",this.__onTouchEndOrCancel,passiveEventOptions)}__attach(){super.__attach(),this.__iframes=new Set(Array.from(document.getElementsByTagName("iframe")));for(const iframe of this.__iframes)iframe.addEventListener("load",this.__onIframeLoad,{passive:!0,capture:!1}),iframe.contentDocument&&this.__addDocumentLevelEventListeners(iframe.contentDocument);this.__destroyOnResized=TcHmi.EventProvider.register(this.__id+".onResized",this.__onResized),this.__destroyOnIframeElementAdded=TcHmi.EventProvider.register("System.onIFrameElementAdded",this.__onIframeElementAdded),this.__destroyOnIframeElementRemoved=TcHmi.EventProvider.register("System.onIFrameElementRemoved",this.__onIframeElementRemoved),this.__addDocumentLevelEventListeners(document),this.__processFixedTarget(),this.__setInitialActiveElements()}__detach(){var _a,_b,_c,_d,_e;super.__detach();for(const iframe of this.__iframes)iframe.contentDocument&&this.__removeDocumentLevelEventListeners(iframe.contentDocument),iframe.removeEventListener("load",this.__onIframeLoad,{capture:!1});this.__iframes.clear(),null===(_a=this.__destroyOnResized)||void 0===_a||_a.call(this),this.__destroyOnResized=null,null===(_b=this.__destroyOnIframeElementAdded)||void 0===_b||_b.call(this),this.__destroyOnIframeElementAdded=null,null===(_c=this.__destroyOnIframeElementRemoved)||void 0===_c||_c.call(this),this.__destroyOnIframeElementRemoved=null,null===(_d=this.__destroyOnAttached)||void 0===_d||_d.call(this),this.__destroyOnAttached=null,null===(_e=this.__destroyOnDestroyed)||void 0===_e||_e.call(this),this.__destroyOnDestroyed=null,this.__removeDocumentLevelEventListeners(document)}destroy(){if(this.__keepAlive)return;const passiveEventOptions={passive:!0,capture:!1},nonPassiveEventOptions={passive:!1,capture:!1};this.__element[0].removeEventListener("mousedown",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),this.__element[0].removeEventListener("touchstart",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),this.__element[0].removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),this.__element[0].removeEventListener("mouseenter",this.__onMouseOver,passiveEventOptions),this.__element[0].removeEventListener("mouseleave",this.__onMouseOut,passiveEventOptions),this.__element[0].removeEventListener("mouseup",this.__onMouseUp,passiveEventOptions),this.__element[0].removeEventListener("touchstart",this.__onTouchStart,passiveEventOptions),this.__element[0].removeEventListener("touchmove",this.__onTouchMove,passiveEventOptions),this.__element[0].removeEventListener("touchend",this.__onTouchEndOrCancel,passiveEventOptions),this.__element[0].removeEventListener("touchcancel",this.__onTouchEndOrCancel,passiveEventOptions),this.__layoutFileXhr&&(this.__layoutFileXhr.abort(),this.__layoutFileXhr=null),super.destroy()}__handleIframeAddedOrLoaded(iframe){if(iframe.contentDocument&&(this.__addDocumentLevelEventListeners(iframe.contentDocument),this.__fixedTargetObserver)){const targetControl=TcHmi.Controls.get(this.__fixedTarget);targetControl&&targetControl.getElement()[0].contains(iframe)&&this.__fixedTargetObserver.observe(iframe.contentDocument,{childList:!0,subtree:!0})}}__handleMouseOrTouchLeave(keyElement,coordinates){keyElement.classList.remove("hover"),keyElement.classList.remove("down");let interactedKey=this.__interactedKeys.filter(iKey=>iKey.element===keyElement)[0];if(void 0===interactedKey)return!1;if(interactedKey.key.longpressAction===TcHmiKeyboard.LongpressAction.ADDITIONALKEYS&&!interactedKey.timedOut){let boundingRectKey=keyElement.getBoundingClientRect(),keyCenter={x:boundingRectKey.left+boundingRectKey.width/2,y:boundingRectKey.top+boundingRectKey.height/2},additionalKeyBoundingRect=keyElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-backdrop")[0].getBoundingClientRect(),direction={x:Math.round((coordinates.x-keyCenter.x)/boundingRectKey.width),y:Math.round((coordinates.y-keyCenter.y)/boundingRectKey.height)},showAdditionalKeys=!1;if((additionalKeyBoundingRect.top<keyCenter.y&&additionalKeyBoundingRect.left<keyCenter.x&&additionalKeyBoundingRect.right>keyCenter.x&&direction.y<=-1||additionalKeyBoundingRect.bottom>keyCenter.y&&additionalKeyBoundingRect.left<keyCenter.x&&additionalKeyBoundingRect.right>keyCenter.x&&direction.y>=1||additionalKeyBoundingRect.left<keyCenter.x&&additionalKeyBoundingRect.top<keyCenter.y&&additionalKeyBoundingRect.bottom>keyCenter.y&&direction.x<=-1||additionalKeyBoundingRect.right>keyCenter.x&&additionalKeyBoundingRect.top<keyCenter.y&&additionalKeyBoundingRect.bottom>keyCenter.y&&direction.x>=1)&&(showAdditionalKeys=!0),showAdditionalKeys)return-1!==interactedKey.timeoutID&&(window.clearTimeout(interactedKey.timeoutID),interactedKey.timeoutID=-1),interactedKey.timedOut=!0,this.__showAdditionalKeys(interactedKey.element),!1}return this.__interactedKeys=this.__interactedKeys.filter(iKey=>iKey.element!==interactedKey.element),-1!==interactedKey.timeoutID&&(window.clearTimeout(interactedKey.timeoutID),interactedKey.timeoutID=-1),!0}__addDocumentLevelEventListeners(target){const passiveEventOptions={passive:!0,capture:!1};target.addEventListener("focusin",this.__onFocusIn,passiveEventOptions),target.addEventListener("focusout",this.__onFocusOut,passiveEventOptions),target.addEventListener("mousedown",this.__onDocumentMouseDownOrTouchStart,passiveEventOptions),target.addEventListener("touchstart",this.__onDocumentMouseDownOrTouchStart,passiveEventOptions)}__removeDocumentLevelEventListeners(target){const passiveEventOptions={passive:!0,capture:!1};target.removeEventListener("focusin",this.__onFocusIn,passiveEventOptions),target.removeEventListener("focusout",this.__onFocusOut,passiveEventOptions),target.removeEventListener("mousedown",this.__onDocumentMouseDownOrTouchStart,passiveEventOptions),target.removeEventListener("touchstart",this.__onDocumentMouseDownOrTouchStart,passiveEventOptions)}__showAdditionalKeys(keyElement){let additionalKeysContainer=this.__additionalKeys.get(keyElement);if(!additionalKeysContainer)return;let keyBoundingRect=keyElement.getBoundingClientRect();additionalKeysContainer.style.width=keyBoundingRect.width+"px",additionalKeysContainer.style.height=keyBoundingRect.height+"px",additionalKeysContainer.style.left=keyBoundingRect.left+"px",additionalKeysContainer.style.top=keyBoundingRect.top+"px";const passiveEventOptions={passive:!0,capture:!1},nonPassiveEventOptions={passive:!1,capture:!1};additionalKeysContainer.addEventListener("mousedown",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),additionalKeysContainer.addEventListener("touchstart",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),additionalKeysContainer.addEventListener("mousedown",this.__onMouseDown,passiveEventOptions),additionalKeysContainer.addEventListener("mouseover",this.__onMouseOver,passiveEventOptions),additionalKeysContainer.addEventListener("mouseout",this.__onMouseOut,passiveEventOptions),additionalKeysContainer.addEventListener("mouseup",this.__onMouseUp,passiveEventOptions),additionalKeysContainer.addEventListener("touchstart",this.__onTouchStart,passiveEventOptions),additionalKeysContainer.addEventListener("touchmove",this.__onTouchMove,passiveEventOptions),additionalKeysContainer.addEventListener("touchend",this.__onTouchEndOrCancel,passiveEventOptions),additionalKeysContainer.addEventListener("touchcancel",this.__onTouchEndOrCancel,passiveEventOptions),TcHmi.TopMostLayer.addEx($(additionalKeysContainer),{dimBackground:!1,modal:!1,removeCb:()=>keyElement.appendChild(additionalKeysContainer)}),keyElement.classList.add("show-additional-keys"),this.__additionalKeysBaseKey={element:keyElement,dragging:!0}}__hideAdditionalKeys(){if(null===this.__additionalKeysBaseKey)return;let additionalKeysContainer=this.__additionalKeys.get(this.__additionalKeysBaseKey.element);if(!additionalKeysContainer)return;const passiveEventOptions={passive:!0,capture:!1},nonPassiveEventOptions={passive:!1,capture:!1};additionalKeysContainer.removeEventListener("mousedown",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),additionalKeysContainer.removeEventListener("touchstart",this.__onRootMouseDownOrTouchStart,nonPassiveEventOptions),additionalKeysContainer.removeEventListener("mousedown",this.__onMouseDown,passiveEventOptions),additionalKeysContainer.removeEventListener("mouseover",this.__onMouseOver,passiveEventOptions),additionalKeysContainer.removeEventListener("mouseout",this.__onMouseOut,passiveEventOptions),additionalKeysContainer.removeEventListener("mouseup",this.__onMouseUp,passiveEventOptions),additionalKeysContainer.removeEventListener("touchstart",this.__onTouchStart,passiveEventOptions),additionalKeysContainer.removeEventListener("touchmove",this.__onTouchMove,passiveEventOptions),additionalKeysContainer.removeEventListener("touchend",this.__onTouchEndOrCancel,passiveEventOptions),additionalKeysContainer.removeEventListener("touchcancel",this.__onTouchEndOrCancel,passiveEventOptions),TcHmi.TopMostLayer.removeEx($(additionalKeysContainer)),this.__additionalKeysBaseKey.element.classList.remove("show-additional-keys"),this.__interactedKeys=this.__interactedKeys.filter(iKey=>iKey.element!==this.__additionalKeysBaseKey.element),this.__additionalKeysBaseKey=null}__keyInteractionStarted(keyElement){null!==this.__additionalKeysBaseKey&&this.__additionalKeysBaseKey.element!==keyElement&&this.__additionalKeys.get(this.__additionalKeysBaseKey.element)!==keyElement.parentElement&&this.__hideAdditionalKeys();let interactedKey=this.__interactedKeys.filter(iKey=>iKey.element===keyElement)[0];if(void 0===interactedKey){if(interactedKey={element:keyElement,key:this.__getKey(keyElement),pressed:!1,timeoutID:-1,timedOut:!1},null!==this.__additionalKeysBaseKey&&this.__additionalKeysBaseKey.element===interactedKey.element)interactedKey.hideAdditionalKeys=!0;else if(TcHmiKeyboard.isStandardKey(interactedKey.key)){let key=interactedKey.key;switch(key.longpressAction){case TcHmiKeyboard.LongpressAction.REPEAT:interactedKey.timeoutID=window.setTimeout(()=>{let repeat=()=>{this.__pressKey(key,!0),interactedKey.pressed=!0,interactedKey.timeoutID=window.setTimeout(repeat,this.__repetitionDelay)};this.__pressKey(key),interactedKey.pressed=!0,interactedKey.timedOut=!0,interactedKey.timeoutID=window.setTimeout(repeat,this.__repetitionDelay)},this.__longpressDelay);break;case TcHmiKeyboard.LongpressAction.ADDITIONALKEYS:interactedKey.timeoutID=window.setTimeout(()=>{this.__showAdditionalKeys(interactedKey.element),interactedKey.timedOut=!0,interactedKey.timeoutID=-1},this.__longpressDelay);break;case TcHmiKeyboard.LongpressAction.LOCK:if(key.mode===TcHmiKeyboard.KeyMode.STICKY){if(key.active&&!key.locked){let stickiedKey=this.__getStickiedKey(key,this.__stickiedKeys);if(void 0!==stickiedKey&&void 0!==this.__longpressDelay&&Date.now()-stickiedKey.stickTime<=this.__longpressDelay){let keyToStick=this.__getStickiedKey(key,this.__keysToStick);if(void 0===keyToStick){let stickiedKey=this.__keyToStickiedKey(key,!0);this.__keysToStick.push(stickiedKey)}else keyToStick.locked=!0;break}}interactedKey.timeoutID=window.setTimeout(()=>{let keyToStick=this.__getStickiedKey(key,this.__keysToStick);void 0!==keyToStick&&(keyToStick.locked=!0),interactedKey.timedOut=!0,interactedKey.timeoutID=-1},this.__longpressDelay)}case TcHmiKeyboard.LongpressAction.NONE:if(key.mode===TcHmiKeyboard.KeyMode.STICKY&&(this.__pressKey(key),interactedKey.pressed=!0,void 0===this.__getStickiedKey(key,this.__keysToStick))){let stickiedKey=this.__keyToStickiedKey(key,!1);this.__keysToStick.push(stickiedKey)}}}this.__interactedKeys.push(interactedKey)}else interactedKey.hideAdditionalKeys=!0}__keyInteractionEnded(keyElement){let interactedKey=this.__interactedKeys.filter(iKey=>iKey.element===keyElement)[0];if(void 0===interactedKey)return;if(null!==this.__additionalKeysBaseKey&&this.__additionalKeysBaseKey.element===interactedKey.element)return void(interactedKey.hideAdditionalKeys&&this.__hideAdditionalKeys());interactedKey.element.classList.contains("additional-key")&&this.__hideAdditionalKeys();let key=interactedKey.key;if(this.__interactedKeys.splice(this.__interactedKeys.indexOf(interactedKey),1),interactedKey.pressed||(this.__pressKey(key),interactedKey.pressed=!0),-1!==interactedKey.timeoutID&&(window.clearTimeout(interactedKey.timeoutID),interactedKey.timeoutID=-1),TcHmiKeyboard.isStandardKey(key))if(key.mode===TcHmiKeyboard.KeyMode.STICKY){let keyToStick=this.__getStickiedKey(key,this.__keysToStick);!key.active||!key.locked&&void 0!==keyToStick&&keyToStick.locked?void 0!==keyToStick?(this.__stickKey(key,keyToStick.locked),this.__keysToStick.splice(this.__keysToStick.indexOf(keyToStick),1)):this.__releaseKey(key):this.__unstickKey(key,!0)}else this.__releaseKey(key),key.mode===TcHmiKeyboard.KeyMode.TOGGLE&&this.__keys.forEach((definition,element)=>{TcHmiKeyboard.isStandardKey(key)&&(key.specialCapslock&&TcHmiKeyboard.isStandardKeyDefinition(definition)?definition.capsLock&&definition.capsLock[key.keyPath.join("")]===key.key.join(",")&&element.classList.toggle("active"):definition[key.keyPath.join("")]===key.key.join(",")&&element.classList.toggle("active"))});else this.__releaseKey(key)}__pressKey(key,repeat=!1){if(!TcHmiKeyboard.isStandardKey(key)||key.mode===TcHmiKeyboard.KeyMode.STICKY&&key.active)return;this.__layouts&&this.__layouts.useIndirectInput&&this.__indirectInputElement&&document.activeElement!==this.__indirectInputElement&&this.__startIndirectInput();const targetElement=this.__getTargetElement();if(targetElement)for(let j=0,jj=key.code.length;j<jj;j++){let cancelled=!this.__dispatchKeyEvent(targetElement,"keydown",key,j,repeat),compositionKeyFirstPress=!1;if(void 0!==key.composition&&(compositionKeyFirstPress=null===this.__compositionKey,compositionKeyFirstPress&&(this.__compositionKey=key)),null!==this.__compositionKey&&key.type===TcHmiKeyboard.KeyType.CHARACTER&&!compositionKeyFirstPress&&void 0===this.__compositionKey.composition[key.key[j]]&&this.__dispatchKeyEvent(targetElement,"keypress",this.__compositionKey,0,repeat)){let action=this.__keyActions.KeyChar;void 0!==action&&(this.__isSuitableElement(targetElement)?action.press(this.__compositionKey,targetElement,0):action.press(this.__compositionKey,null,0))}if(key.valid&&!cancelled&&!compositionKeyFirstPress){key.type===TcHmiKeyboard.KeyType.CHARACTER&&(cancelled=!this.__dispatchKeyEvent(targetElement,"keypress",key,j,repeat));let action=this.__keyActions[key.type===TcHmiKeyboard.KeyType.CHARACTER?"KeyChar":key.key[j]||""];if(void 0!==action&&!cancelled&&(this.__isSuitableElement(targetElement)?action.press(key,targetElement,j):action.press(key,null,j),key.type===TcHmiKeyboard.KeyType.CHARACTER||key.type===TcHmiKeyboard.KeyType.EDIT)){let event;"function"==typeof Event?event=new Event("input",{bubbles:!0}):(event=document.createEvent("event"),event.initEvent("input",!0,!1)),targetElement.dispatchEvent(event)}}}}__releaseKey(key){if(key.type===TcHmiKeyboard.KeyType.LAYOUTSWITCH){if(null!==this.__layouts){let layout=this.__layouts.layouts.filter(layout=>layout.name===key.layoutName)[0];void 0!==layout&&this.__activateLayout(layout)}}else if(key.type===TcHmiKeyboard.KeyType.INDIRECTINPUT){if(this.__indirectInputElement)switch(key.component){case TcHmiKeyboard.IndirectInputComponent.ACCEPT:this.__endIndirectInput();break;case TcHmiKeyboard.IndirectInputComponent.CANCEL:this.__endIndirectInput(!0)}}else{this.__layouts&&this.__layouts.useIndirectInput&&this.__indirectInputElement&&document.activeElement!==this.__indirectInputElement&&this.__startIndirectInput();const targetElement=this.__getTargetElement();if(targetElement)for(let j=0,jj=key.code.length;j<jj;j++){let cancelled=!this.__dispatchKeyEvent(targetElement,"keyup",key,j);if(key.valid&&!cancelled){let action=this.__keyActions[key.type===TcHmiKeyboard.KeyType.CHARACTER?"KeyChar":key.key[j]||""];void 0!==action&&void 0!==action.release&&(this.__isSuitableElement(targetElement)?action.release(key,targetElement,j):action.release(key,null,j))}}}}__getKey(keyElement){function splitWithConsecutiveTokens(value,token){if(void 0===value)return[];let lastIndex=0,tokenIndex=value.indexOf(token,lastIndex+1),res=[];for(;tokenIndex>-1;)res.push(value.substring(lastIndex,tokenIndex)),lastIndex=tokenIndex+token.length,tokenIndex=value.indexOf(token,lastIndex+1);return lastIndex<value.length&&res.push(value.substring(lastIndex)),res}let keyDefinition=this.__keys.get(keyElement);if(!keyDefinition)throw new Error("Invalid key");if("layout-switch"===keyDefinition.type)return{type:TcHmiKeyboard.KeyType.LAYOUTSWITCH,layoutName:keyDefinition.layoutName};if("indirect-input"===keyDefinition.type){let component=TcHmi.ValueConverter.toEnum(keyDefinition.component,TcHmiKeyboard.IndirectInputComponent);if(null===component)throw new Error("Invalid value for component in indirect input definition");return{type:TcHmiKeyboard.KeyType.INDIRECTINPUT,component:component}}let key={code:splitWithConsecutiveTokens(keyDefinition.code,","),key:[],keyPath:[],unmodifiedKey:splitWithConsecutiveTokens(keyDefinition.key,","),type:TcHmi.ValueConverter.toEnum(keyDefinition.type,TcHmiKeyboard.KeyType,TcHmiKeyboard.KeyType.CHARACTER),mode:TcHmi.ValueConverter.toEnum(keyDefinition.mode,TcHmiKeyboard.KeyMode,TcHmiKeyboard.KeyMode.NORMAL),location:(keyDefinition.location||"").split(",").map(value=>TcHmi.ValueConverter.toEnum(value,TcHmiKeyboard.KeyLocation,TcHmiKeyboard.KeyLocation.STANDARD)),active:keyElement.classList.contains("active"),locked:keyElement.classList.contains("locked"),noCapsLock:keyDefinition.noCapsLock||!1,ignoreModifiers:keyDefinition.ignoreModifiers||!1,valid:!0,longpressAction:TcHmi.ValueConverter.toEnum(keyDefinition.longpressAction,TcHmiKeyboard.LongpressAction,TcHmiKeyboard.LongpressAction.NONE),specialCapslock:!1},path=[];if(!key.ignoreModifiers){if(this.__modifiers.Shift&&path.push("Shift"),this.__modifiers.Control&&path.push("Ctrl"),this.__modifiers.Alt&&path.push("Alt"),this.__modifiers.CapsLock&&!key.noCapsLock){if(keyDefinition.capsLock){let capslockPath=path.join("")+"Key";capslockPath=capslockPath.substr(0,1).toLowerCase()+capslockPath.substr(1),void 0!==keyDefinition.capsLock[capslockPath]&&(key.specialCapslock=!0)}key.specialCapslock||(-1===path.indexOf("Shift")?path.unshift("Shift"):path.shift())}this.__modifiers.NumLock&&Object.keys(keyDefinition).filter(key=>key.startsWith("numlock")).length>0&&path.unshift("Numlock"),path.length>0&&(path[0]=path[0].toLowerCase())}let pathedType=(key.specialCapslock?keyDefinition.capsLock:keyDefinition)[path.length>0?path.concat(["Type"]).join(""):"type"];void 0!==pathedType&&path.length>0?key.type=TcHmi.ValueConverter.toEnum(pathedType,TcHmiKeyboard.KeyType,TcHmiKeyboard.KeyType.CHARACTER):key.type!==TcHmiKeyboard.KeyType.CHARACTER&&(path=[]);let keyData=(key.specialCapslock?keyDefinition.capsLock:keyDefinition)[path.length>0?path.concat(["Key"]).join(""):"key"],compositionPath=path.length>0?path.concat(["Composition"]).join(""):"composition";if(void 0!==(key.specialCapslock?keyDefinition.capsLock:keyDefinition)[compositionPath]&&(key.composition=TcHmi.ValueConverter.toObject((key.specialCapslock?keyDefinition.capsLock:keyDefinition)[compositionPath],void 0)),void 0===keyData&&(key.valid=!1,keyData=keyDefinition.key),key.key=splitWithConsecutiveTokens(keyData,","),"Any"===key.key[0]&&(void 0===this.__getKey.__anyKey?(key.unmodifiedKey[0]=key.key[0]=String.fromCharCode(Math.floor(95*Math.random()+32)),this.__getKey.__anyKey=key.key[0]):(key.unmodifiedKey[0]=key.key[0]=this.__getKey.__anyKey,delete this.__getKey.__anyKey)),key.keyPath=path.length>0?path.concat(["Key"]):["key"],key.code.length>key.key.length?key.code.splice(key.key.length,key.code.length-key.key.length):key.key.length>key.code.length&&key.key.splice(key.code.length,key.key.length-key.code.length),key.location.length<key.code.length)for(let i=key.location.length,ii=key.code.length;i<ii;i++)key.location.push(TcHmiKeyboard.KeyLocation.STANDARD);else key.location.length>key.code.length&&key.location.splice(key.code.length,key.location.length-key.code.length);return key}__getTargetElement(){var _a;if(this.__layouts&&this.__layouts.useIndirectInput&&this.__indirectInputElement)return this.__indirectInputElement;if(this.__fixedTarget){let elements=[];null!==this.__fixedTargetInputElements&&(elements=elements.concat(Array.from(this.__fixedTargetInputElements))),null!==this.__fixedTargetTextareaElements&&(elements=elements.concat(Array.from(this.__fixedTargetTextareaElements)));const targetControl=TcHmi.Controls.get(this.__fixedTarget);if(targetControl)for(const iframe of Array.from(targetControl.getElement()[0].getElementsByTagName("iframe")))iframe.contentDocument&&(elements=elements.concat(Array.from(iframe.contentDocument.querySelectorAll("input, textarea"))));return 0===elements.length&&void 0!==targetControl&&elements.push(targetControl.getElement()[0]),elements.length>1?(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] The fixedTarget control contains more than on input or textarea element and is thus not suitable to be used as a fixedTarget.`),null):0===elements.length?null:elements[0]}return document.activeElement?document.activeElement instanceof HTMLIFrameElement&&(null===(_a=document.activeElement.contentDocument)||void 0===_a?void 0:_a.activeElement)?document.activeElement.contentDocument.activeElement:document.activeElement:null}__dispatchKeyEvent(target,type,key,sequenceIndex,repeat=!1){let event,eventInit={key:void 0!==key.composition&&"keypress"!==type?"Dead":key.key[sequenceIndex],code:key.code[sequenceIndex],location:key.location[sequenceIndex],shiftKey:this.__modifiers.Shift,ctrlKey:this.__modifiers.Control,altKey:this.__modifiers.Alt,metaKey:this.__modifiers.Meta,bubbles:!0,cancelable:!0,repeat:repeat};if(null!==this.__compositionKey&&void 0!==this.__compositionKey.composition[eventInit.key]&&(eventInit.key=this.__compositionKey.composition[eventInit.key]),"keypress"===type&&key.type===TcHmiKeyboard.KeyType.CHARACTER){if(void 0!==key.key[sequenceIndex]){let specialKey=this.__specialKeys[key.key[sequenceIndex]],typedChar=void 0!==specialKey?specialKey:key.key[sequenceIndex];typedChar=this.__unescape(typedChar),null!==this.__compositionKey&&void 0!==this.__compositionKey.composition[typedChar]&&(typedChar=this.__compositionKey.composition[typedChar]),eventInit.charCode=typedChar.charCodeAt(0),eventInit.keyCode=eventInit.charCode,eventInit.which=eventInit.charCode}}else void 0!==this.__keyCodes[key.key[sequenceIndex]]?(eventInit.keyCode=this.__keyCodes[key.key[sequenceIndex]],eventInit.which=eventInit.keyCode):key.type===TcHmiKeyboard.KeyType.CHARACTER&&(void 0!==key.unmodifiedKey[sequenceIndex]?eventInit.keyCode=this.__unescape(key.unmodifiedKey[sequenceIndex]).toUpperCase().charCodeAt(0):void 0!==key.key[sequenceIndex]&&(eventInit.keyCode=this.__unescape(key.key[sequenceIndex]).toUpperCase().charCodeAt(0)),eventInit.which=eventInit.keyCode);if("function"==typeof KeyboardEvent)event=new KeyboardEvent(type,eventInit);else{let modifiers=[];eventInit.altKey&&modifiers.push("Alt"),eventInit.altKey&&eventInit.ctrlKey&&modifiers.push("AltGraph"),this.__modifiers.CapsLock&&modifiers.push("CapsLock"),eventInit.ctrlKey&&modifiers.push("Control"),eventInit.metaKey&&modifiers.push("Meta"),this.__modifiers.NumLock&&modifiers.push("NumLock"),eventInit.shiftKey&&modifiers.push("Shift"),event=document.createEvent("KeyboardEvent"),event.initKeyboardEvent(type,eventInit.bubbles||!1,eventInit.cancelable||!1,window,eventInit.key||"",eventInit.location||0,modifiers.join(" "),eventInit.repeat||!1,"")}return event.which!==eventInit.which&&void 0!==eventInit.which&&(Object.defineProperty(event,"which",{get:function(){return this.whichVal}}),event.whichVal=eventInit.which,void 0!==eventInit.charCode&&(Object.defineProperty(event,"charCode",{get:function(){return this.charCodeVal}}),event.charCodeVal=eventInit.charCode),void 0!==eventInit.keyCode&&(Object.defineProperty(event,"keyCode",{get:function(){return this.keyCodeVal}}),event.keyCodeVal=eventInit.keyCode)),target.dispatchEvent(event)}__toggleModifier(key,value){this.__modifiers[key]=void 0===value?!this.__modifiers[key]:value,this.__updateActiveModifiers()}__updateActiveModifiers(){let toRemove=[];if(this.__element[0].classList.forEach(className=>{-1!==className.indexOf("-active")&&toRemove.push(className)}),this.__element[0].classList.remove(...toRemove),this.__shownLabels.forEach(label=>label.classList.remove("show")),this.__hiddenLabels.forEach(label=>label.classList.remove("hide")),this.__shownLabels=[],this.__hiddenLabels=[],this.__modifiers.Shift||this.__modifiers.Control||this.__modifiers.Alt||this.__modifiers.Meta||this.__modifiers.CapsLock){let activeModifiers="";this.__modifiers.Shift&&(activeModifiers+="shift"),this.__modifiers.Control&&this.__modifiers.Alt?activeModifiers+="altgr":this.__modifiers.Control?activeModifiers+="control":this.__modifiers.Alt&&(activeModifiers+="alt"),this.__modifiers.Meta&&(activeModifiers+="meta"),activeModifiers.length>0&&this.__element[0].classList.add(activeModifiers+"-active");let activeOrDefault=activeModifiers.length>0?activeModifiers:"default";if(this.__modifiers.CapsLock){this.__element[0].classList.add("capslock-active");let selectorShow=".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key.no-caps-lock .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-"+activeOrDefault,selectorHide=".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key.no-caps-lock .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-"+activeOrDefault,modifiedModifiers=activeModifiers;this.__modifiers.Shift?(modifiedModifiers=modifiedModifiers.replace("shift",""),0===modifiedModifiers.length&&(modifiedModifiers="default")):modifiedModifiers="shift"+modifiedModifiers,selectorShow+=", .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key:not(.no-caps-lock) .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-"+modifiedModifiers,selectorHide+=", .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key:not(.no-caps-lock) .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-"+modifiedModifiers,activeModifiers="capslock"+activeModifiers,selectorShow+=", .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key:not(.no-caps-lock) .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-"+activeModifiers,selectorHide+=", .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key:not(.no-caps-lock) .TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-"+activeModifiers,this.__shownLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(selectorShow))),this.__hiddenLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(selectorHide)))}else this.__shownLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-"+activeOrDefault))),this.__hiddenLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-"+activeOrDefault)))}else this.__element[0].classList.add("default-active"),this.__shownLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-default"))),this.__hiddenLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-default")));this.__modifiers.NumLock&&(this.__element[0].classList.add("numlock-active"),this.__shownLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-numlock"))),this.__hiddenLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-numlock")))),this.__modifiers.Insert&&(this.__element[0].classList.add("insert-active"),this.__shownLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.show-insert"))),this.__hiddenLabels.push(...Array.from(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label.hide-insert")))),this.__shownLabels.forEach(label=>label.classList.add("show")),this.__hiddenLabels.forEach(label=>label.classList.add("hide"))}__stickKey(key,lock=!1){if(key.mode!==TcHmiKeyboard.KeyMode.STICKY)return;let stickiedKey=this.__getStickiedKey(key,this.__stickiedKeys);void 0===stickiedKey?(stickiedKey=this.__keyToStickiedKey(key,lock),stickiedKey.stickTime=Date.now(),this.__stickiedKeys.push(stickiedKey)):stickiedKey.locked=lock,this.__keys.forEach((definition,element)=>{key.specialCapslock&&TcHmiKeyboard.isStandardKeyDefinition(definition)?definition.capsLock&&definition.capsLock[key.keyPath.join("")]===key.key.join(",")&&(element.classList.add("active"),element.classList.toggle("locked",lock)):definition[key.keyPath.join("")]===key.key.join(",")&&(element.classList.add("active"),element.classList.toggle("locked",lock))})}__unstickKey(key,unlock=!1){if(key.mode!==TcHmiKeyboard.KeyMode.STICKY)return;let keyIndex=this.__stickiedKeys.indexOf(key);if(-1===keyIndex)for(let i=0,ii=this.__stickiedKeys.length;i<ii;i++)if(this.__stickiedKeys[i].key.join(",")===key.key.join(",")&&this.__stickiedKeys[i].keyPath.join("-")===key.keyPath.join("-")){keyIndex=i;break}if(-1!==keyIndex){if(!this.__stickiedKeys[keyIndex].locked||unlock)return this.__releaseKey(this.__stickiedKeys[keyIndex]),this.__stickiedKeys.splice(keyIndex,1),this.__keys.forEach((definition,element)=>{key.specialCapslock&&TcHmiKeyboard.isStandardKeyDefinition(definition)?definition.capsLock&&definition.capsLock[key.keyPath.join("")]===key.key.join(",")&&element.classList.remove("active","locked"):definition[key.keyPath.join("")]===key.key.join(",")&&element.classList.remove("active","locked")}),!0}return!1}__unstickAllKeys(){if(!this.__releaseStickyKeysManually){let keyIndex=0;for(let i=0,ii=this.__stickiedKeys.length;i<ii;i++){this.__unstickKey(this.__stickiedKeys[keyIndex])||keyIndex++}}this.__keysToStick=[]}__getStickiedKey(searchKey,stickiedKeyCollection){return stickiedKeyCollection.filter(k=>k.key.join(",")===searchKey.key.join(",")&&k.keyPath.join("-")===searchKey.keyPath.join("-"))[0]}__keyToStickiedKey(key,locked){return{code:key.code,key:key.key,keyPath:key.keyPath,unmodifiedKey:key.unmodifiedKey,type:key.type,mode:key.mode,location:key.location,active:key.active,noCapsLock:key.noCapsLock,ignoreModifiers:key.ignoreModifiers,valid:key.valid,longpressAction:key.longpressAction,composition:key.composition,specialCapslock:key.specialCapslock,locked:locked,stickTime:-1}}__caretPositionLeft(currentPosition,text,ignoreModifiers){if(currentPosition<=0)return 0;if(this.__modifiers.Control&&!ignoreModifiers){let boundariesRegEx=/\b\S/g,match=boundariesRegEx.exec(text),previousIndex=0;for(;match&&!(match.index>=currentPosition);)previousIndex=match.index,match=boundariesRegEx.exec(text);return previousIndex}{if(1===currentPosition)return 0;let charCodeLow=text.charCodeAt(currentPosition-1),charCodeHigh=text.charCodeAt(currentPosition-2);return charCodeLow>=56320&&charCodeLow<=57343&&charCodeHigh>=55296&&charCodeHigh<=56319?currentPosition-2:currentPosition-1}}__caretPositionRight(currentPosition,text,ignoreModifiers){if(currentPosition>=text.length)return text.length;if(this.__modifiers.Control&&!ignoreModifiers){let boundariesRegEx=/\S\s*\b/g,match=boundariesRegEx.exec(text);for(;match&&!(match.index+1>currentPosition);)match=boundariesRegEx.exec(text);return null!==match?match.index+1:text.length}{if(currentPosition===text.length-1)return text.length;let charCodeHigh=text.charCodeAt(currentPosition),charCodeLow=text.charCodeAt(currentPosition+1);return charCodeHigh>=55296&&charCodeHigh<=56319&&charCodeLow>=56320&&charCodeLow<=57343?currentPosition+2:currentPosition+1}}__moveCaret(activeInput,direction,positionFinder,ignoreModifiers){let selectionStart=this.__getSelectionStartOrEnd(activeInput,"selectionStart"),selectionEnd=this.__getSelectionStartOrEnd(activeInput,"selectionEnd");if(this.__modifiers.Shift&&!ignoreModifiers){if(selectionStart===selectionEnd||activeInput.selectionDirection===direction){"forward"===direction?this.__setSelectionStartOrEnd(activeInput,"selectionEnd",positionFinder(selectionEnd)):this.__setSelectionStartOrEnd(activeInput,"selectionStart",positionFinder(selectionStart));try{activeInput.selectionDirection=direction}catch(ex){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] Tried to set selectionDirection on an input element that does not support this. Try using an <input type="text" /> element.`)}}else if("forward"===direction){let newCaretPosition=positionFinder(selectionStart);if(newCaretPosition<selectionEnd)this.__setSelectionStartOrEnd(activeInput,"selectionStart",newCaretPosition);else{this.__setSelectionStartOrEnd(activeInput,"selectionStart",selectionEnd),this.__setSelectionStartOrEnd(activeInput,"selectionEnd",newCaretPosition);try{activeInput.selectionDirection=direction}catch(ex){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] Tried to set selectionDirection on an input element that does not support this. Try using an <input type="text" /> element.`)}}}else{let newCaretPosition=positionFinder(selectionEnd);if(newCaretPosition>=selectionStart)this.__setSelectionStartOrEnd(activeInput,"selectionEnd",newCaretPosition);else{this.__setSelectionStartOrEnd(activeInput,"selectionEnd",selectionStart),this.__setSelectionStartOrEnd(activeInput,"selectionStart",newCaretPosition);try{activeInput.selectionDirection=direction}catch(ex){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] Tried to set selectionDirection on an input element that does not support this. Try using an <input type="text" /> element.`)}}}this.__scrollCaretIntoViewbox(activeInput)}else this.__setCaretPosition(activeInput,positionFinder(selectionStart))}__setCaretPosition(activeInput,position){this.__setSelectionStartOrEnd(activeInput,"selectionStart",position),this.__setSelectionStartOrEnd(activeInput,"selectionEnd",position);try{activeInput.selectionDirection="forward"}catch(ex){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] Tried to set selectionDirection on an input element that does not support this. Try using an <input type="text" /> element.`)}this.__scrollCaretIntoViewbox(activeInput)}__setSelectionStartOrEnd(activeInput,startOrEnd,position){if(position<0?position=0:position>activeInput.value.length&&(position=activeInput.value.length),activeInput[startOrEnd]!==position)try{activeInput[startOrEnd]=position}catch(ex){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] Tried to set selection or caret position on an input element that does not support this. Try using an <input type="text" /> element.`)}}__getSelectionStartOrEnd(activeInput,startOrEnd){let position=activeInput[startOrEnd]||0;return position<0?position=0:position>activeInput.value.length&&(position=activeInput.value.length),position}__scrollCaretIntoViewbox(activeInput){let caretPosition="backward"===activeInput.selectionDirection?this.__getSelectionStartOrEnd(activeInput,"selectionStart"):this.__getSelectionStartOrEnd(activeInput,"selectionEnd"),mirrorElement=this.__getMirrorElement(activeInput),caretCoords=this.__getCaretCoordinates(mirrorElement,activeInput.value,caretPosition);mirrorElement.style.width="auto",mirrorElement.style.height="auto",mirrorElement.style.padding="",mirrorElement.style.overflow="hidden",mirrorElement.textContent=".";let caretHeight=mirrorElement.clientHeight;mirrorElement.parentNode.removeChild(mirrorElement);let computed=window.getComputedStyle(activeInput),paddingTop=parseInt(computed.paddingTop||"0",10),paddingRight=parseInt(computed.paddingRight||"0",10),paddingBottom=parseInt(computed.paddingBottom||"0",10),paddingLeft=parseInt(computed.paddingLeft||"0",10);caretCoords.left<activeInput.scrollLeft+paddingLeft?activeInput.scrollLeft=caretCoords.left-paddingLeft:caretCoords.left+1>activeInput.scrollLeft+activeInput.clientWidth-paddingLeft-paddingRight&&(activeInput.scrollLeft=caretCoords.left+1-(activeInput.clientWidth-paddingLeft-paddingRight)),caretCoords.top<activeInput.scrollTop+paddingTop?activeInput.scrollTop=caretCoords.top-paddingTop:caretCoords.top+caretHeight>activeInput.scrollTop+activeInput.clientHeight-paddingTop-paddingBottom&&(activeInput.scrollTop=caretCoords.top+caretHeight-(activeInput.clientHeight-paddingTop-paddingBottom))}__getMirrorElement(element){let div=document.createElement("div"),style=div.style,computed=window.getComputedStyle(element);return style.position="absolute",style.visibility="hidden",["whiteSpace","wordWrap","direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"].forEach((function(prop){style[prop]=computed[prop]})),null!==window.mozInnerScreenX?element.scrollHeight>parseInt(computed.height||"0",10)&&(style.overflowY="scroll"):style.overflow="hidden",document.body.appendChild(div),div}__getCaretCoordinates(mirrorElement,text,caretPosition){let span=mirrorElement.getElementsByTagName("span")[0]||document.createElement("span");return mirrorElement.textContent=text.substring(0,caretPosition).replace(/  /g," Â "),span.textContent=text.substring(caretPosition)||".",mirrorElement.appendChild(span),{top:span.offsetTop,left:span.offsetLeft}}__unescape(value){return value.replace(/\\b/g,"\b").replace(/\\t/g,"\t").replace(/\\n/g,"\n").replace(/\\v/g,"\v").replace(/\\f/g,"\f").replace(/\\r/g,"\r").replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\\\/g,"\\")}__isSuitableElement(element){return"TEXTAREA"===element.tagName.toUpperCase()||"INPUT"===element.tagName.toUpperCase()&&["password","search","tel","text","url"].includes(element.type)}__mapLayoutNameToLayoutFileName(oldName){let newPath="";switch(oldName){case"DE-DE_QWERTZ_full":newPath="German - with NumPad";break;case"DE-DE_QWERTZ_standard":newPath="German - basic";break;case"EN-US_QWERTY_full":newPath="US - with NumPad";break;case"EN-US_QWERTY_standard":newPath="US - basic";break;case"DE-DE_QWERTZ_compact":newPath="German - compact";break;case"EN-US_QWERTY_compact":newPath="US - compact";break;case"Calculator":case"Numpad":case"PINpad":newPath=oldName;break;default:return null}return"KeyboardLayouts/"+newPath+".keyboard.json"}setLayout(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew),mappedValue=this.__mapLayoutNameToLayoutFileName(convertedValue);if(null!==mappedValue)return this.setLayoutFile(mappedValue)}getLayout(){return null}setLayoutFile(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LayoutFile")),convertedValue!==this.__layoutFile&&(this.__layoutFile=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LayoutFile"}),this.__processLayoutFile())}getLayoutFile(){return this.__layoutFile}__processLayoutFile(){if(!this.__layoutFile)return void(TCHMI_DESIGNER?this.__elementPaddingContainer[0].innerHTML='<div class="TcHmi_Controls_Beckhoff_TcHmiKeyboard-designer-info" style="font-style:italic;">No configured LayoutFile.<br>Please add a LayoutFile to the project and set the LayoutFile attribute.<div>':this.__elementPaddingContainer[0].innerText="");if(TCHMI_DESIGNER){const designerInfoElem=this.__elementPaddingContainer[0].querySelector(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-designer-info");designerInfoElem&&designerInfoElem.remove()}const path=tchmi_path(this.__layoutFile);let cacheEntry=TcHmiKeyboard.LayoutCache.get(path);const cacheEntryCallback=data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}, Attribute=LayoutPath] ${TcHmi.Log.buildMessage(data.details)}`),this.__layouts=data.layouts,this.__processLayoutJsonFile()};if(cacheEntry&&!cacheEntry.pending)this.__layouts=cacheEntry.layouts,this.__processLayoutJsonFile();else if(cacheEntry&&cacheEntry.pending)cacheEntry.pendingCallbacks.push(cacheEntryCallback);else if(!cacheEntry){this.__layoutFileXhr&&this.__layoutFileXhr.abort(),cacheEntry={layouts:null,pending:!0,pendingCallbacks:[cacheEntryCallback]},TcHmiKeyboard.LayoutCache.set(path,cacheEntry);const xhrErrorHandler=()=>{TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+', Attribute=LayoutPath] Loading layout file "'+this.__layoutFile+'" failed with status: "'+xhr.status+'".'),this.__layouts=null,this.__processLayoutJsonFile(),this.__layoutFileXhr=null,this.__elementPaddingContainer[0].innerText="",cacheEntry&&(cacheEntry.pending=!1,cacheEntry.pendingCallbacks.forEach(callback=>{const error=TcHmi.Callback.callSafe(callback,this,{error:TcHmi.Errors.ERROR,details:{code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],domain:"TcHmiKeyboard",reason:`Loading layout file "${this.__layoutFile}" failed with status: "${xhr.status}".`},layouts:null});error&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(error)}),cacheEntry.pendingCallbacks=[]),TcHmiKeyboard.LayoutCache.delete(path)},xhr=new XMLHttpRequest;this.__layoutFileXhr=xhr,xhr.open("GET",path,!0),xhr.addEventListener("load",()=>{if(200===xhr.status){const layouts=TcHmi.ValueConverter.toObject(xhr.responseText);cacheEntry&&(cacheEntry.layouts=layouts,cacheEntry.pending=!1,cacheEntry.pendingCallbacks.forEach(callback=>{const error=TcHmi.Callback.callSafe(callback,this,{error:TcHmi.Errors.NONE,layouts:layouts});error&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(error)}),cacheEntry.pendingCallbacks=[])}else xhrErrorHandler();this.__layoutFileXhr=null}),xhr.addEventListener("error",xhrErrorHandler),xhr.addEventListener("abort",()=>{TcHmiKeyboard.LayoutCache.delete(path)}),xhr.send()}}__processLayoutJsonFile(){if(null!==this.__layouts){Array.isArray(this.__layouts.layouts)&&0!==this.__layouts.layouts.length||TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("Loading layout in control "+this.__id+' failed. Invalid layout file: "layouts" property is missing or empty!');let filteredLayouts=this.__layouts.layouts.filter(layout=>!!layout.name&&"string"==typeof layout.name&&"default"===layout.name.toLowerCase());filteredLayouts.length>0?this.__activateLayout(filteredLayouts[0]):this.__activateLayout(this.__layouts.layouts[0]),this.__indirectInputElement&&!this.__layouts.useIndirectInput&&(this.__indirectInputElement.remove(),this.__indirectInputElement=null),this.__isAttached&&this.__setInitialActiveElements()}this.__fixedTarget&&this.__processFixedTarget()}__activateLayout(layout){if(!Array.isArray(layout.keys))return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Activating layout failed. Missing property=keys."));this.__keys.clear(),this.__additionalKeys.clear();let fragment=document.createDocumentFragment(),indirectInputTextboxFound=!1,indirectInputAcceptFound=!1;for(let i=0,ii=layout.keys.length;i<ii;i++){let definition=layout.keys[i];if("indirect-input"===definition.type)switch(definition.component){case"textbox":indirectInputTextboxFound=!0;break;case"accept":indirectInputAcceptFound=!0}let keyElement=this.__createKey(definition);keyElement&&!keyElement.parentElement&&fragment.appendChild(keyElement)}this.__layouts&&this.__layouts.useIndirectInput?(indirectInputTextboxFound||TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+'] Layout has "useIndirectInput" = true, but is missing the textbox.'),indirectInputAcceptFound||TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+'] Layout has "useIndirectInput" = true, but is missing the accept key.')):(indirectInputTextboxFound||indirectInputAcceptFound)&&TCHMI_CONSOLE_LOG_LEVEL>=2&&TcHmi.Log.warn("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+'] Layout contains elements for indirect input, but has "useIndirectInput" not set to true.');for(let i=this.__elementPaddingContainer[0].childElementCount-1;i>=0;i--){let element=this.__elementPaddingContainer[0].children.item(i);element instanceof HTMLDivElement&&element.remove()}this.__elementPaddingContainer[0].appendChild(fragment),this.__currentLayout=layout,this.__updateActiveModifiers(),this.__processScaleMode(),this.__processKeyPadding(),this.__processAdditionalKeyBackdropPadding(),this.__processLabelFontFamily(),this.__processLabelFontSize(),this.__processLabelFontStyle(),this.__processLabelFontWeight(),this.__processLabelStrokeThickness(),this.__processLabelStrokeColor(),this.__processLabelFillColor(),this.__processLabelColor(),this.__processKeyBackgroundColor(),this.__processAdditionalKeyBackdropColor()}__createKey(definition){if(!this.__layouts||!this.__layouts.useIndirectInput&&"indirect-input"===definition.type)return;if(void 0===definition.geometry||null===definition.geometry)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=geometry."));if(void 0===definition.geometry.top||null===definition.geometry.top)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=geometry.top."));if(void 0===definition.geometry.left||null===definition.geometry.left)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=geometry.left."));if(void 0===definition.geometry.width||null===definition.geometry.width)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=geometry.width."));if(void 0===definition.geometry.height||null===definition.geometry.height)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=geometry.height."));if("layout-switch"===definition.type){if(void 0===definition.layoutName||null===definition.layoutName)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=layoutName."))}else if("indirect-input"===definition.type){if(void 0===definition.component||null===definition.component)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=component."))}else{if(void 0===definition.code||null===definition.code)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=code."));if(void 0===definition.key||null===definition.key)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id="+this.getId()+"] Creating key failed. Key definition is missing property=key."))}let keyElement;if("indirect-input"===definition.type&&"textbox"===definition.component){if(this.__updateIndirectInputElement(definition),!this.__indirectInputElement)throw new Error("Could not create textbox for indirect input.");keyElement=this.__indirectInputElement}else{keyElement=document.createElement("div"),keyElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key","tchmi-keyboard-template-key");for(let prop in definition)definition.hasOwnProperty(prop)&&("object"!=typeof definition[prop]?keyElement.dataset[prop]=definition[prop]:prop.includes("omposition")&&(keyElement.dataset[prop]=JSON.stringify(definition[prop])));if(TcHmiKeyboard.isStandardKeyDefinition(definition)&&(definition.noCapsLock&&keyElement.classList.add("no-caps-lock"),definition.additionalKeys)){let additionalKeysContainer=document.createElement("div");additionalKeysContainer.classList.add("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-additional-keys-container");for(let i=0,ii=definition.additionalKeys.length;i<ii;i++){let additionalKeyElement=this.__createKey(definition.additionalKeys[i]);if(void 0===additionalKeyElement)return;additionalKeyElement.classList.add("additional-key"),additionalKeysContainer.appendChild(additionalKeyElement)}let backdropTop=Math.min(...definition.additionalKeys.map(def=>def.geometry.top)),backdropLeft=Math.min(...definition.additionalKeys.map(def=>def.geometry.left)),backdropWidth=Math.max(...definition.additionalKeys.map(def=>def.geometry.left+def.geometry.width-backdropLeft)),backdropHeight=Math.max(...definition.additionalKeys.map(def=>def.geometry.top+def.geometry.height-backdropTop)),backdrop=document.createElement("div");backdrop.classList.add("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-backdrop","tchmi-keyboard-template-backdrop"),backdrop.style.top=backdropTop+"%",backdrop.style.left=backdropLeft+"%",backdrop.style.width=backdropWidth+"%",backdrop.style.height=backdropHeight+"%",additionalKeysContainer.insertAdjacentElement("afterbegin",backdrop),keyElement.appendChild(additionalKeysContainer),this.__additionalKeys.set(keyElement,additionalKeysContainer)}if(Array.isArray(definition.labels))for(let j=0,jj=definition.labels.length;j<jj;j++){let label=definition.labels[j],labelElement=document.createElement("span");if(labelElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label","tchmi-keyboard-template-label"),void 0!==label.position&&null!==label.position&&label.position.length>0&&label.position.split(" ").forEach(position=>labelElement.classList.add(position)),"text"===label.type&&void 0!==label.text&&null!==label.text)labelElement.textContent=label.text;else if("svg"===label.type&&void 0!==label.svg&&null!==label.svg)labelElement.innerHTML=`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="${label.svg.dimensions.width}" height="${label.svg.dimensions.height}"><path d="${label.svg.path}"></path></svg>`;else if("image"===label.type&&void 0!==label.image&&null!==label.image){let labelBackground={color:null,image:label.image.source,imageWidth:void 0!==label.image.dimensions?label.image.dimensions.width:null,imageWidthUnit:"px",imageHeight:void 0!==label.image.dimensions?label.image.dimensions.height:null,imageHeightUnit:"px",imageHorizontalAlignment:"Center",imageVerticalAlignment:"Center",imagePadding:null};TcHmi.StyleProvider.processBackground(labelElement,labelBackground)}if(void 0!==label.visible&&label.visible.length>0)for(let k=0,kk=label.visible.length;k<kk;k++)labelElement.classList.add("show-"+label.visible[k]);else labelElement.classList.add("show-always");if(void 0!==label.hidden)for(let k=0,kk=label.hidden.length;k<kk;k++)labelElement.classList.add("hide-"+label.hidden[k]);keyElement.appendChild(labelElement)}}return keyElement.style.top=definition.geometry.top+"%",keyElement.style.left=definition.geometry.left+"%",keyElement.style.width=definition.geometry.width+"%",keyElement.style.height=definition.geometry.height+"%",TcHmiKeyboard.isStandardKeyDefinition(definition)&&!0===this.__modifiers[definition.key]&&keyElement.classList.add("active"),this.__keys.set(keyElement,definition),keyElement}__updateIndirectInputElement(definition,replaceOld=!1){if("textbox"!==definition.component)return;if(!this.__activeElement&&this.__indirectInputElement)return;let multiline=this.__activeElement instanceof HTMLTextAreaElement;if(!this.__indirectInputElement||multiline&&this.__indirectInputElement instanceof HTMLInputElement||!multiline&&this.__indirectInputElement instanceof HTMLTextAreaElement){let oldElement=this.__indirectInputElement;this.__indirectInputElement=multiline?document.createElement("textarea"):document.createElement("input"),this.__indirectInputElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-textbox"),this.__indirectInputElement.style.top=definition.geometry.top+"%",this.__indirectInputElement.style.left=definition.geometry.left+"%",this.__indirectInputElement.style.width=definition.geometry.width+"%",this.__indirectInputElement.style.height=definition.geometry.height+"%",this.__processIndirectInputHorizontalAlignment(),this.__processIndirectInputFontSize(),this.__processIndirectInputPadding(),replaceOld&&(oldElement&&oldElement.parentElement===this.__elementPaddingContainer[0]?this.__elementPaddingContainer[0].replaceChild(this.__indirectInputElement,oldElement):this.__elementPaddingContainer[0].appendChild(this.__indirectInputElement))}}setScaleMode(valueNew){let convertedValue=TcHmi.ValueConverter.toScaleModeString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ScaleMode")),convertedValue!==this.__scaleMode&&(this.__scaleMode=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ScaleMode"}),this.__processScaleMode())}getScaleMode(){return this.__scaleMode}__processScaleMode(){if(void 0===this.__scaleMode)return;if("ScaleToFill"===this.__scaleMode||"None"===this.__scaleMode){switch(this.__scaleMode){case"ScaleToFill":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementPaddingContainer,{width:null,height:null,"min-width":null,"min-height":null});break;case"None":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementPaddingContainer,{width:this.__currentLayout.dimensions.width+"px",height:this.__currentLayout.dimensions.height+"px","min-width":this.__currentLayout.dimensions.width+"px","min-height":this.__currentLayout.dimensions.height+"px"})}return}let width=this.getRenderedWidth();if(!width)return;let height=this.getRenderedHeight();if(height){if(this.__keyboardPadding){let originalWidth=width,getPixelValue=(value,unit,reference)=>"%"===unit?value/100*reference:value;width-=getPixelValue(this.__keyboardPadding.left,this.__keyboardPadding.leftUnit,originalWidth),width-=getPixelValue(this.__keyboardPadding.right,this.__keyboardPadding.rightUnit,originalWidth),height-=getPixelValue(this.__keyboardPadding.top,this.__keyboardPadding.topUnit,originalWidth),height-=getPixelValue(this.__keyboardPadding.bottom,this.__keyboardPadding.bottomUnit,originalWidth)}switch(this.__scaleMode){case"ScaleToFit":{let scaleX=width/this.__currentLayout.dimensions.width,scaleY=height/this.__currentLayout.dimensions.height,scale=scaleX<scaleY?scaleX:scaleY;TcHmi.StyleProvider.setSimpleElementStyle(this.__elementPaddingContainer,{width:this.__currentLayout.dimensions.width*scale+"px",height:this.__currentLayout.dimensions.height*scale+"px","min-width":this.__currentLayout.dimensions.width*scale+"px","min-height":this.__currentLayout.dimensions.height*scale+"px"})}break;case"ScaleToFitWidth":{let scale=width/this.__currentLayout.dimensions.width;TcHmi.StyleProvider.setSimpleElementStyle(this.__elementPaddingContainer,{width:this.__currentLayout.dimensions.width*scale+"px",height:this.__currentLayout.dimensions.height*scale+"px","min-width":this.__currentLayout.dimensions.width*scale+"px","min-height":this.__currentLayout.dimensions.height*scale+"px"})}break;case"ScaleToFitHeight":{let scale=height/this.__currentLayout.dimensions.height;TcHmi.StyleProvider.setSimpleElementStyle(this.__elementPaddingContainer,{width:this.__currentLayout.dimensions.width*scale+"px",height:this.__currentLayout.dimensions.height*scale+"px","min-width":this.__currentLayout.dimensions.width*scale+"px","min-height":this.__currentLayout.dimensions.height*scale+"px"})}}}}setFixedTarget(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("FixedTarget")),convertedValue!==this.__fixedTarget&&(this.__fixedTarget=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"FixedTarget"}),this.__processFixedTarget())}getFixedTarget(){return this.__fixedTarget}__processFixedTarget(){var _a,_b;let observeMutations=!1;if(null===(_a=this.__destroyOnAttached)||void 0===_a||_a.call(this),this.__destroyOnAttached=null,null===(_b=this.__destroyOnDestroyed)||void 0===_b||_b.call(this),this.__destroyOnDestroyed=null,this.__fixedTarget){let targetControl=TcHmi.Controls.get(this.__fixedTarget);if(targetControl){let element=targetControl.getElement()[0];if(this.__fixedTargetInputElements=element.getElementsByTagName("input"),this.__fixedTargetTextareaElements=element.getElementsByTagName("textarea"),this.__layouts&&this.__layouts.useIndirectInput){observeMutations=!0;let printError=!0,updateActiveElement=()=>{let elements=[];null!==this.__fixedTargetInputElements&&(elements=elements.concat(Array.from(this.__fixedTargetInputElements))),null!==this.__fixedTargetTextareaElements&&(elements=elements.concat(Array.from(this.__fixedTargetTextareaElements)));for(const iframe of Array.from(element.getElementsByTagName("iframe")))iframe.contentDocument&&(elements=elements.concat(Array.from(iframe.contentDocument.querySelectorAll("input, textarea"))));elements.length>1?TCHMI_CONSOLE_LOG_LEVEL>=1&&printError&&(TcHmi.Log.error(`[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiKeyboard, Id=${this.getId()}] The fixedTarget control contains more than on input or textarea element and is thus not suitable to be used as a fixedTarget.`),printError=!1):0!==elements.length&&this.__setActiveElement(elements[0])};this.__fixedTargetObserver=new MutationObserver(updateActiveElement),this.__fixedTargetObserver.observe(element,{childList:!0,subtree:!0});for(const iframe of this.__iframes)iframe.contentDocument&&element.contains(iframe)&&this.__fixedTargetObserver.observe(iframe.contentDocument,{childList:!0,subtree:!0});updateActiveElement()}this.__destroyOnDestroyed=TcHmi.EventProvider.register(this.__fixedTarget+".onDestroyed",()=>{this.__processFixedTarget()})}else this.__fixedTargetInputElements=null,this.__fixedTargetTextareaElements=null,this.__destroyOnAttached=TcHmi.EventProvider.register(this.__fixedTarget+".onAttached",()=>{this.__processFixedTarget()})}else this.__fixedTargetInputElements=null,this.__fixedTargetTextareaElements=null,this.__isAttached&&this.__setInitialActiveElements();this.__fixedTargetObserver&&!observeMutations&&(this.__fixedTargetObserver.disconnect(),this.__fixedTargetObserver=null)}setReleaseStickyKeysManually(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ReleaseStickyKeysManually")),convertedValue!==this.__releaseStickyKeysManually&&(this.__releaseStickyKeysManually=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ReleaseStickyKeysManually"}),this.__processReleaseStickyKeysManually())}getReleaseStickyKeysManually(){return this.__releaseStickyKeysManually}__processReleaseStickyKeysManually(){}__raiseKeyPressStarted(keyElement){let key,interactedKey=this.__interactedKeys.filter(iKey=>iKey.element===keyElement)[0];if(key=void 0!==interactedKey?interactedKey.key:this.__getKey(keyElement),!TcHmiKeyboard.isStandardKey(key))return;let pressedKeys=[];for(let i=0,ii=Math.min(key.code.length,key.key.length,key.location.length);i<ii;i++)pressedKeys.push({element:keyElement,key:{code:key.code[i],key:key.key[i],unmodifiedKey:key.unmodifiedKey[i],location:TcHmiKeyboard.KeyLocation[key.location[0]].toLowerCase()}});this.__pressedKeys=this.__pressedKeys.concat(pressedKeys),TcHmi.EventProvider.raise(this.__id+".onKeyPressStarted",pressedKeys),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PressedKeys"})}__raiseKeyPressEnded(keyElement,canceledOrFinished){let pressedKeys=this.__pressedKeys.filter(item=>item.element===keyElement);0!==pressedKeys.length&&(this.__pressedKeys=this.__pressedKeys.filter(item=>item.element!==keyElement),TcHmi.EventProvider.raise(this.__id+".onKeyPress"+canceledOrFinished,pressedKeys),TcHmi.EventProvider.raise(this.__id+".onKeyPressEnded",pressedKeys),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"PressedKeys"}))}__setActiveElement(element){var _a,_b;if(this.__indirectInputElement)if(this.__activeElement=element,element){let textboxDefintion=this.__keys.get(this.__indirectInputElement);textboxDefintion&&"indirect-input"===textboxDefintion.type&&(this.__keys.delete(this.__indirectInputElement),this.__updateIndirectInputElement(textboxDefintion,!0),this.__keys.set(this.__indirectInputElement,textboxDefintion)),this.__indirectInputElement.value=null!==(_b=null===(_a=this.__activeElement)||void 0===_a?void 0:_a.value)&&void 0!==_b?_b:""}else this.__indirectInputElement.value=""}__setInitialActiveElements(){var _a;if((null===(_a=this.__layouts)||void 0===_a?void 0:_a.useIndirectInput)&&!this.__fixedTarget)if(document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)this.__setActiveElement(document.activeElement);else if(document.activeElement instanceof HTMLIFrameElement&&document.activeElement.contentWindow){const iframeWindow=document.activeElement.contentWindow,activeElement=iframeWindow.document.activeElement;(activeElement instanceof iframeWindow.HTMLInputElement||activeElement instanceof iframeWindow.HTMLTextAreaElement)&&this.__setActiveElement(activeElement)}}__startIndirectInput(){var _a,_b,_c;if(!this.__indirectInputElement)return;this.__indirectInputElement.focus();const selectionStart=null===(_a=this.__activeElement)||void 0===_a?void 0:_a.selectionStart,selectionEnd=null===(_b=this.__activeElement)||void 0===_b?void 0:_b.selectionEnd,selectionDirection=null===(_c=this.__activeElement)||void 0===_c?void 0:_c.selectionDirection;this.__indirectInputElement.selectionStart=null!=selectionStart?selectionStart:this.__indirectInputElement.value.length,this.__indirectInputElement.selectionEnd=null!=selectionEnd?selectionEnd:this.__indirectInputElement.value.length,this.__indirectInputElement.selectionDirection=null!=selectionDirection?selectionDirection:"forward"}__endIndirectInput(canceled=!1){var _a,_b;if(!this.__indirectInputElement)return;let indirectInputText=this.__indirectInputElement.value;if(canceled)this.__indirectInputElement.value=null!==(_b=null===(_a=this.__activeElement)||void 0===_a?void 0:_a.value)&&void 0!==_b?_b:"";else{let selectionStart=this.__indirectInputElement.selectionStart,selectionEnd=this.__indirectInputElement.selectionEnd,selectionDirection=this.__indirectInputElement.selectionDirection;if(this.__activeElement){this.__activeElement.value=indirectInputText;try{this.__activeElement.selectionStart=null!==selectionStart?selectionStart:this.__activeElement.value.length,this.__activeElement.selectionEnd=null!==selectionEnd?selectionEnd:this.__activeElement.value.length,this.__activeElement.selectionDirection=null!==selectionDirection?selectionDirection:"forward"}catch(ex){}let event=new Event("input",{bubbles:!0});this.__activeElement.dispatchEvent(event)}}this.__activeElement&&this.__activeElement.focus(),TcHmi.EventProvider.raise(this.__id+(canceled?".onIndirectInputCanceled":".onIndirectInputAccepted"),indirectInputText)}getPressedKeys(){return this.__pressedKeys.map(item=>item.key)}setLongpressDelay(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LongpressDelay")),convertedValue!==this.__longpressDelay&&(this.__longpressDelay=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LongpressDelay"}),this.__processLongpressDelay())}getLongpressDelay(){return this.__longpressDelay}__processLongpressDelay(){}setRepetitionDelay(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("RepetitionDelay")),convertedValue!==this.__repetitionDelay&&(this.__repetitionDelay=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"RepetitionDelay"}),this.__processRepetitionDelay())}getRepetitionDelay(){return this.__repetitionDelay}__processRepetitionDelay(){}setIndirectInputHorizontalAlignment(valueNew){let convertedValue=TcHmi.ValueConverter.toHorizontalAlignment(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("IndirectInputHorizontalAlignment")),convertedValue!==this.__indirectInputHorizontalAlignment&&(this.__indirectInputHorizontalAlignment=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IndirectInputHorizontalAlignment"}),this.__processIndirectInputHorizontalAlignment())}getIndirectInputHorizontalAlignment(){return this.__indirectInputHorizontalAlignment}__processIndirectInputHorizontalAlignment(){void 0!==this.__indirectInputHorizontalAlignment&&this.__indirectInputElement&&(this.__indirectInputElement.style.textAlign=this.__indirectInputHorizontalAlignment.toLowerCase())}setIndirectInputFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("IndirectInputFontSize")),convertedValue!==this.__indirectInputFontSize&&(this.__indirectInputFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IndirectInputFontSize"}),this.__processIndirectInputFontSize())}getIndirectInputFontSize(){return this.__indirectInputFontSize}__processIndirectInputFontSize(){void 0!==this.__indirectInputFontSize&&this.__indirectInputElement&&(null!==this.__indirectInputFontSize?this.__indirectInputElement.style.fontSize=this.__indirectInputFontSize+(this.__indirectInputFontSizeUnit||"px"):this.__indirectInputElement.style.fontSize="")}setIndirectInputFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toDimensionUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("IndirectInputFontSizeUnit")),convertedValue!==this.__indirectInputFontSizeUnit&&(this.__indirectInputFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"IndirectInputFontSizeUnit"}),this.__processIndirectInputFontSizeUnit())}getIndirectInputFontSizeUnit(){return this.__indirectInputFontSizeUnit}__processIndirectInputFontSizeUnit(){this.__processIndirectInputFontSize()}setIndirectInputPadding(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("IndirectInputPadding"));let resolverInfo=this.__objectResolvers.get("indirectInputPadding");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("indirectInputPadding",{resolver:resolver,watchCallback:this.__onResolverForIndirectInputPaddingWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForIndirectInputPaddingWatchCallback)})}getIndirectInputPadding(){return this.__indirectInputPadding}__processIndirectInputPadding(){void 0!==this.__indirectInputPadding&&this.__indirectInputElement&&TcHmi.StyleProvider.processContentPadding(this.__indirectInputElement,this.__indirectInputPadding)}setKeyboardPadding(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("KeyboardPadding"));let resolverInfo=this.__objectResolvers.get("keyboardPadding");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("keyboardPadding",{resolver:resolver,watchCallback:this.__onResolverForKeyboardPaddingWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForKeyboardPaddingWatchCallback)})}getKeyboardPadding(){return this.__keyboardPadding}__processKeyboardPadding(){TcHmi.StyleProvider.processContentPadding(this.__elementTemplateRoot,this.__keyboardPadding),this.__processScaleMode()}setKeyPadding(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("KeyPadding"));let resolverInfo=this.__objectResolvers.get("keyPadding");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("keyPadding",{resolver:resolver,watchCallback:this.__onResolverForKeyPaddingWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForKeyPaddingWatchCallback)})}getKeyPadding(){return this.__keyPadding}__processKeyPadding(){let labels=this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label"),sides=["top","right","bottom","left"];if(this.__keyPadding)for(let i=0,ii=sides.length;i<ii;i++){let value=this.__keyPadding[sides[i]],unit=this.__keyPadding[sides[i]+"Unit"]||"px";null==value?TcHmi.StyleProvider.setSimpleElementStyle(labels,sides[i],null):TcHmi.StyleProvider.setSimpleElementStyle(labels,sides[i],value+unit)}else for(let i=0,ii=sides.length;i<ii;i++)TcHmi.StyleProvider.setSimpleElementStyle(labels,sides[i],null)}setAdditionalKeyBackdropPadding(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AdditionalKeyBackdropPadding"));let resolverInfo=this.__objectResolvers.get("additionalKeyBackdropPadding");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("additionalKeyBackdropPadding",{resolver:resolver,watchCallback:this.__onResolverForAdditionalKeyBackdropPaddingWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForAdditionalKeyBackdropPaddingWatchCallback)})}getAdditionalKeyBackdropPadding(){return this.__additionalKeyBackdropPadding}__processAdditionalKeyBackdropPadding(){let backdrops=Array.from(this.__additionalKeys.values()).map(element=>element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-backdrop")[0]);TcHmi.StyleProvider.processContentPadding(backdrops,this.__additionalKeyBackdropPadding),this.__additionalKeyBackdropPadding?TcHmi.StyleProvider.processTransform(backdrops,{transformType:"Translate",x:-(this.__additionalKeyBackdropPadding.left||0),xUnit:this.__additionalKeyBackdropPadding.leftUnit||"px",y:-(this.__additionalKeyBackdropPadding.top||0),yUnit:this.__additionalKeyBackdropPadding.topUnit||"px"}):TcHmi.StyleProvider.processTransform(backdrops,null)}setLabelFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelFontSize")),convertedValue!==this.__labelFontSize&&(this.__labelFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelFontSize"}),this.__processLabelFontSize())}getLabelFontSize(){return this.__labelFontSize}__processLabelFontSize(){TcHmi.StyleProvider.processFontSize(this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key"),this.__labelFontSize,this.__labelFontSizeUnit)}setLabelFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toFontSizeUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelFontSizeUnit")),convertedValue!==this.__labelFontSizeUnit&&(this.__labelFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelFontSizeUnit"}),this.__processLabelFontSizeUnit())}getLabelFontSizeUnit(){return this.__labelFontSizeUnit}__processLabelFontSizeUnit(){this.__processLabelFontSize()}setLabelFontFamily(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelFontFamily")),convertedValue!==this.__labelFontFamily&&(this.__labelFontFamily=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelFontFamily"}),this.__processLabelFontFamily())}getLabelFontFamily(){return this.__labelFontFamily}__processLabelFontFamily(){TcHmi.StyleProvider.processFontFamily(this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key"),this.__labelFontFamily)}setLabelFontStyle(valueNew){let convertedValue=TcHmi.ValueConverter.toFontStyle(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelFontStyle")),convertedValue!==this.__labelFontStyle&&(this.__labelFontStyle=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelFontStyle"}),this.__processLabelFontStyle())}getLabelFontStyle(){return this.__labelFontStyle}__processLabelFontStyle(){TcHmi.StyleProvider.processFontStyle(this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key"),this.__labelFontStyle)}setLabelFontWeight(valueNew){let convertedValue=TcHmi.ValueConverter.toFontWeight(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelFontWeight")),convertedValue!==this.__labelFontWeight&&(this.__labelFontWeight=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelFontWeight"}),this.__processLabelFontWeight())}getLabelFontWeight(){return this.__labelFontWeight}__processLabelFontWeight(){TcHmi.StyleProvider.processFontWeight(this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key"),this.__labelFontWeight)}setLabelStrokeThickness(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelStrokeThickness")),convertedValue!==this.__labelStrokeThickness&&(this.__labelStrokeThickness=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"LabelStrokeThickness"}),this.__processLabelStrokeThickness())}getLabelStrokeThickness(){return this.__labelStrokeThickness}__processLabelStrokeThickness(){TcHmi.StyleProvider.setSimpleElementStyle(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label svg"),"stroke-width",this.__labelStrokeThickness+"px")}setKeyBackgroundColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("KeyBackgroundColor"));let resolverInfo=this.__objectResolvers.get("keyBackgroundColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("keyBackgroundColor",{resolver:resolver,watchCallback:this.__onResolverForKeyBackgroundColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForKeyBackgroundColorWatchCallback)})}getKeyBackgroundColor(){return this.__keyBackgroundColor}__processKeyBackgroundColor(){TcHmi.StyleProvider.processBackgroundColor(this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key"),this.__keyBackgroundColor)}setLabelColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelColor"));let resolverInfo=this.__objectResolvers.get("labelColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("labelColor",{resolver:resolver,watchCallback:this.__onResolverForLabelColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForLabelColorWatchCallback)})}getLabelColor(){return this.__labelColor}__processLabelColor(){TcHmi.StyleProvider.processTextColor(this.__elementPaddingContainer[0].getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-key"),this.__labelColor)}setLabelStrokeColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelStrokeColor"));let resolverInfo=this.__objectResolvers.get("labelStrokeColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("labelStrokeColor",{resolver:resolver,watchCallback:this.__onResolverForLabelStrokeColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForLabelStrokeColorWatchCallback)})}getLabelStrokeColor(){return this.__labelStrokeColor}__processLabelStrokeColor(){TcHmi.StyleProvider.processStrokeColor(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label svg"),this.__labelStrokeColor)}setLabelFillColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("LabelFillColor"));let resolverInfo=this.__objectResolvers.get("labelFillColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("labelFillColor",{resolver:resolver,watchCallback:this.__onResolverForLabelFillColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForLabelFillColorWatchCallback)})}getLabelFillColor(){return this.__labelFillColor}__processLabelFillColor(){TcHmi.StyleProvider.processFillColor(this.__elementPaddingContainer[0].querySelectorAll(".TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-label svg path"),this.__labelFillColor)}setAdditionalKeyBackdropColor(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AdditionalKeyBackdropColor"));let resolverInfo=this.__objectResolvers.get("additionalKeyBackdropColor");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("additionalKeyBackdropColor",{resolver:resolver,watchCallback:this.__onResolverForAdditionalKeyBackdropColorWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForAdditionalKeyBackdropColorWatchCallback)})}getAdditionalKeyBackdropColor(){return this.__additionalKeyBackdropColor}__processAdditionalKeyBackdropColor(){TcHmi.StyleProvider.processBackgroundColor(Array.from(this.__additionalKeys.values()).map(element=>element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiKeyboard-template-backdrop")[0]),this.__additionalKeyBackdropColor)}}TcHmiKeyboard.LayoutCache=new Map,Beckhoff.TcHmiKeyboard=TcHmiKeyboard,function(TcHmiKeyboard){let KeyType,KeyMode,KeyLocation,LongpressAction,IndirectInputComponent;TcHmiKeyboard.isStandardKeyDefinition=function(obj){return"layout-switch"!==obj.type&&"indirect-input"!==obj.type},TcHmiKeyboard.isStandardKey=function(obj){return obj.type!==KeyType.LAYOUTSWITCH&&obj.type!==KeyType.INDIRECTINPUT},function(KeyType){KeyType[KeyType.CHARACTER=0]="CHARACTER",KeyType[KeyType.MODIFIER=1]="MODIFIER",KeyType[KeyType.ACTION=2]="ACTION",KeyType[KeyType.EDIT=3]="EDIT",KeyType[KeyType.LAYOUTSWITCH=4]="LAYOUTSWITCH",KeyType[KeyType.INDIRECTINPUT=5]="INDIRECTINPUT"}(KeyType=TcHmiKeyboard.KeyType||(TcHmiKeyboard.KeyType={})),function(KeyMode){KeyMode[KeyMode.NORMAL=0]="NORMAL",KeyMode[KeyMode.STICKY=1]="STICKY",KeyMode[KeyMode.TOGGLE=2]="TOGGLE"}(KeyMode=TcHmiKeyboard.KeyMode||(TcHmiKeyboard.KeyMode={})),function(KeyLocation){KeyLocation[KeyLocation.STANDARD=0]="STANDARD",KeyLocation[KeyLocation.LEFT=1]="LEFT",KeyLocation[KeyLocation.RIGHT=2]="RIGHT",KeyLocation[KeyLocation.NUMPAD=3]="NUMPAD"}(KeyLocation=TcHmiKeyboard.KeyLocation||(TcHmiKeyboard.KeyLocation={})),function(LongpressAction){LongpressAction[LongpressAction.NONE=0]="NONE",LongpressAction[LongpressAction.REPEAT=1]="REPEAT",LongpressAction[LongpressAction.ADDITIONALKEYS=2]="ADDITIONALKEYS",LongpressAction[LongpressAction.LOCK=3]="LOCK"}(LongpressAction=TcHmiKeyboard.LongpressAction||(TcHmiKeyboard.LongpressAction={})),function(IndirectInputComponent){IndirectInputComponent[IndirectInputComponent.TEXTBOX=0]="TEXTBOX",IndirectInputComponent[IndirectInputComponent.ACCEPT=1]="ACCEPT",IndirectInputComponent[IndirectInputComponent.CANCEL=2]="CANCEL"}(IndirectInputComponent=TcHmiKeyboard.IndirectInputComponent||(TcHmiKeyboard.IndirectInputComponent={}))}(TcHmiKeyboard=Beckhoff.TcHmiKeyboard||(Beckhoff.TcHmiKeyboard={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiKeyboard","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiKeyboard);