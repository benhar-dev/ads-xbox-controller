var TcHmi;!function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){class TcHmiEventGrid extends TcHmi.Controls.System.TcHmiControl{constructor(element,pcElement,attrs){super(element,pcElement,attrs),this.__internalFilter=[],this.__noPayloadsFilter=[{path:"type",comparator:"!=",value:TcHmi.Server.Events.Type.Payload}],this.__internalColumns=[],this.__storageValidation={filter:{function:"getFilter",expectedResult:void 0},columns:{function:"getColumns",expectedResult:void 0}},this.__sortingInitialized=!1,this.__headerFontFamilyInitialized=!1,this.__headerFontSizeInitialized=!1,this.__headerFontSizeUnitInitialized=!1,this.__headerFontStyleInitialized=!1,this.__headerFontWeightInitialized=!1,this.__gridFontFamilyInitialized=!1,this.__gridFontSizeInitialized=!1,this.__gridFontSizeUnitInitialized=!1,this.__gridFontStyleInitialized=!1,this.__gridFontWeightInitialized=!1,this.__headerHeightInitialized=!1,this.__headerHeightUnitInitialized=!1,this.__rowHeightInitialized=!1,this.__typeToggles=new Map([[TcHmi.Server.Events.Type.Alarm,void 0],[TcHmi.Server.Events.Type.Message,void 0]]),this.__severityToggles=new Map([[TcHmi.Server.Events.Severity.Verbose,void 0],[TcHmi.Server.Events.Severity.Info,void 0],[TcHmi.Server.Events.Severity.Warning,void 0],[TcHmi.Server.Events.Severity.Error,void 0],[TcHmi.Server.Events.Severity.Critical,void 0]]),this.__menuBarButtons=new Map([["filter",void 0],["columns",void 0],["confirm",void 0],["confirmAll",void 0]]),this.__buttonTooltips={message:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Message%/l%",alarm:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Alarm%/l%",verbose:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Verbose%/l%",info:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Info%/l%",warning:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Warning%/l%",error:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Error%/l%",critical:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Critical%/l%",filter:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Filter%/l%",columns:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Columns%/l%",confirm:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Confirm%/l%",confirmAll:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_ConfirmAll%/l%"},this.__canConfirm=!0,this.__filterPopup=null,this.__columnsPopup=null,this.__detailsPopup=null,this.__confirmAllPopup=null,this.__typesToShow=new Map([[TcHmi.Server.Events.Type.Alarm,!0],[TcHmi.Server.Events.Type.Message,!0]]),this.__severitiesToShow=new Map([[TcHmi.Server.Events.Severity.Verbose,!0],[TcHmi.Server.Events.Severity.Info,!0],[TcHmi.Server.Events.Severity.Warning,!0],[TcHmi.Server.Events.Severity.Error,!0],[TcHmi.Server.Events.Severity.Critical,!0]]),this.__themedIcons={types:new Map,severities:new Map},this.__localizedElements=new Map,this.__localizationReader=void 0,this.__destroyLocalizationWatch=null,this.__subscriptionId=null,this.__availableColumns={severity:{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Verbose%/l%",value:TcHmi.Server.Events.Severity.Verbose,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/verbose.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Info%/l%",value:TcHmi.Server.Events.Severity.Info,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/info.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Warning%/l%",value:TcHmi.Server.Events.Severity.Warning,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/warning.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Error%/l%",value:TcHmi.Server.Events.Severity.Error,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/error.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Critical%/l%",value:TcHmi.Server.Events.Severity.Critical,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/critical.svg"}]},type:{name:"type",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Message%/l%",value:TcHmi.Server.Events.Type.Message,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/message.svg"},{text:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Label_Text_Alarm%/l%",value:TcHmi.Server.Events.Type.Alarm,height:30,width:30,source:Controls.getBasePathEx(this)+"/Themes/Base/Images/alarm.svg"}]},domain:{name:"domain",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Domain%/l%",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},sourceDomain:{name:"sourceDomain",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_SourceDomain%/l%",control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},name:{name:"name",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Name%/l%",control:"TextBlock",width:200,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},text:{name:"text",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Text%/l%",control:"TextBlock",width:373,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},alarmState:{name:"alarmState",label:"",control:"TextBlock",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateRaised:{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Raised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeRaised:{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_TimeRaised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateRaised:{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_DateRaised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateConfirmed:{name:"timeConfirmed",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Confirmed%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeConfirmed:{name:"timeConfirmed",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_TimeConfirmed%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateConfirmed:{name:"timeConfirmed",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_DateConfirmed%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeAndDateCleared:{name:"timeCleared",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Cleared%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},timeCleared:{name:"timeCleared",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_TimeCleared%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToTimeString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"},dateCleared:{name:"timeCleared",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_DateCleared%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateString",fnParams:[]},width:100,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Center",verticalAlignment:"Center"}},this.__destroyersToCallOnDetach=[],this.__onUserInGroupChangedDestroyer=null,this.__doubletapStartTime=0,this.__onUserInGroupChanged=()=>{this.__setCanConfirm(!0)},this.__onResized=()=>{"Left"!==this.__menuBarPosition&&"Right"!==this.__menuBarPosition||this.__fixVerticalMenuBarWidth()},this.__onThemeDataChanged=()=>{this.__updateThemedResources(),this.__updateColumns(this.__internalColumns)},this.__onSelectedItemChanged=()=>{this.__processSelectedItem(),TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"SelectedEvent"}),TcHmi.EventProvider.raise(this.__id+".onSelectedItemChanged",this.getSelectedEvent())},this.__onDataGridPropertyChanged=(event,data)=>{["Sorting","HeaderFontFamily","HeaderFontSize","HeaderFontSizeUnit","HeaderFontStyle","HeaderFontWeight","GridFontFamily","GridFontSize","GridFontSizeUnit","GridFontStyle","GridFontWeight","HeaderHeight","HeaderHeightUnit","RowHeight"].includes(data.propertyName)&&TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:data.propertyName})},this.__onFilterPressed=()=>{this.__filterPopup||(this.__filterPopup=new Beckhoff.TcHmiEventGridPopups.FilterPopup(this.__elementFilterPopup[0],this),this.__filterPopup.registerOkButtonHandler(()=>{TcHmi.Access.checkAccess(this,"configure")&&(this.__updateFilter(this.__filterPopup.getSettings()),this.__setStoredValueWithValidation("filter",this.__internalFilter))}),this.__filterPopup.registerResetButtonHandler(()=>{var _a;this.__removeStoredValue("filter"),this.__filterPopup.requiresUpdate()&&this.__filterPopup.update(null!==(_a=this.__filter)&&void 0!==_a?_a:[],!1)})),this.__filterPopup.requiresUpdate()&&this.__filterPopup.update(this.__internalFilter,!(tchmi_equal(this.__internalFilter,this.__filter)||0===this.__internalFilter.length&&!this.__filter)),this.__filterPopup.show()},this.__onColumnsPressed=()=>{this.__columnsPopup||(this.__columnsPopup=new Beckhoff.TcHmiEventGridPopups.ColumnsPopup(this.__elementColumnsPopup[0],this),this.__columnsPopup.registerOkButtonHandler(()=>{TcHmi.Access.checkAccess(this,"configure")&&(this.__updateColumns(this.__columnsPopup.getSettings()),this.__setStoredValueWithValidation("columns",this.__internalColumns))}),this.__columnsPopup.registerResetButtonHandler(()=>{var _a;this.__removeStoredValue("columns"),this.__columnsPopup.requiresUpdate()&&this.__columnsPopup.update(null!==(_a=this.__columns)&&void 0!==_a?_a:[],!1)})),this.__columnsPopup.requiresUpdate()&&this.__columnsPopup.update(this.__internalColumns,!(tchmi_equal(this.__internalColumns,this.__columns)||0===this.__internalColumns.length&&!this.__columns)),this.__columnsPopup.show()},this.__onConfirmPressed=()=>{let event=this.__datagrid.getSelectedRowValue();TcHmi.Server.Events.isAlarm(event)&&TcHmi.Server.Events.confirmAlarm(event,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+"] Unable to confirm alarm with id "+event.id+" in domain "+event.domain+". Error: "+TcHmi.Log.buildMessage(data.details)),"object"==typeof data.details&&null!==data.details&&data.details.code===TcHmi.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__setCanConfirm(!1)})},this.__onConfirmAllPressed=()=>{this.__confirmAllPopup||(this.__confirmAllPopup=new Beckhoff.TcHmiEventGridPopups.ConfirmAllPopup(this.__elementConfirmAllPopup[0],this));let commands=new Map;commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter()},(command,data)=>{var _a;command.readValue?this.__confirmAllPopup.update(command.readValue.map(TcHmi.Server.Events.parseServerEvent).filter(TcHmi.Server.Events.isAlarm)):TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:"Missing property: 'readValue' in command for symbol: 'ListEvents' in response from server with id: '"+(null===(_a=data.response)||void 0===_a?void 0:_a.id)+"'.",domain:this.__type}))}),TcHmi.Server.requestEx({requestType:"ReadWrite",commands:Array.from(commands.keys())},null,this.__getServerResponseHandler(commands)),this.__confirmAllPopup.update([]),this.__confirmAllPopup.show()},this.__onDoubleclick=event=>{if(!this.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this,"operate")||!TcHmi.Access.checkAccess(this,"viewDetails"))return;if(!(event.target instanceof Element))return;let tableRow=event.target;for(;tableRow&&!tableRow.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")&&!tableRow.classList.contains("tchmi-datagrid-template-row");)tableRow=tableRow.parentElement;tableRow&&(TcHmi.EventProvider.raise(this.__id+".onItemDoubleClicked",this.getSelectedEvent()),this.__showDetails())},this.__onTouchStart=event=>{if(!this.getIsEnabled())return;if(!TcHmi.Access.checkAccess(this,"operate")||!TcHmi.Access.checkAccess(this,"viewDetails"))return;if(!(event.target instanceof Element))return;let tableRow=event.target;for(;tableRow&&(!tableRow.classList.contains("TcHmi_Controls_Beckhoff_TcHmiDatagrid-template-row")||!tableRow.classList.contains("tchmi-datagrid-template-row"));)tableRow=tableRow.parentElement;let now=Date.now();tableRow&&(now-this.__doubletapStartTime<300?(TcHmi.EventProvider.raise(this.__id+".onItemDoubleClicked",this.getSelectedEvent()),this.__showDetails(),this.__doubletapStartTime=0,event.preventDefault()):this.__doubletapStartTime=now)},this.__onScroll=event=>{this.getIsEnabled()&&TcHmi.Access.checkAccess(this,"operate")&&TcHmi.Access.checkAccess(this,"viewDetails")&&(this.__doubletapStartTime=0)},this.__onResolverForColumnsWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("columns"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__columns)||(this.__columns=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Columns"}),this.__processColumns()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+", Attribute=Columns] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))},this.__onResolverForFilterWatchCallback=data=>{!1===this.__isAttached&&this.__suspendObjectResolver("filter"),data.error===TcHmi.Errors.NONE?tchmi_equal(data.value,this.__filter)||(this.__filter=data.value,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Filter"}),this.__processFilter()):TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+", Attribute=Filter] Resolving symbols from object failed with error: "+TcHmi.Log.buildMessage(data.details))}}__previnit(){if(this.__elementTemplateRoot=this.__element.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template"),0===this.__elementTemplateRoot.length&&(this.__elementTemplateRoot=this.__element.find(".tchmi-event-grid-template")),this.__elementGridContainer=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-grid-container"),0===this.__elementGridContainer.length&&(this.__elementGridContainer=this.__elementTemplateRoot.find(".tchmi-event-grid-template-grid-container")),this.__elementMenuBar=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-menu-bar"),0===this.__elementMenuBar.length&&(this.__elementMenuBar=this.__elementTemplateRoot.find(".tchmi-event-grid-template-menu-bar")),this.__elementTypeToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-type-toggles"),0===this.__elementTypeToggles.length&&(this.__elementTypeToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-type-toggles")),this.__elementSeverityToggles=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-severity-toggles"),0===this.__elementSeverityToggles.length&&(this.__elementSeverityToggles=this.__elementMenuBar.find(".tchmi-event-grid-template-severity-toggles")),this.__elementOptions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-options"),0===this.__elementOptions.length&&(this.__elementOptions=this.__elementMenuBar.find(".tchmi-event-grid-template-options")),this.__elementMessageActions=this.__elementMenuBar.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-event-actions"),0===this.__elementMessageActions.length&&(this.__elementMessageActions=this.__elementMenuBar.find(".tchmi-event-grid-template-event-actions")),this.__elementFilterPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-popup"),0===this.__elementFilterPopup.length&&(this.__elementFilterPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-filter-popup")),this.__elementColumnsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-popup"),0===this.__elementColumnsPopup.length&&(this.__elementColumnsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-columns-popup")),this.__elementDetailsPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-details-popup"),0===this.__elementDetailsPopup.length&&(this.__elementDetailsPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-details-popup")),this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup"),0===this.__elementConfirmAllPopup.length&&(this.__elementConfirmAllPopup=this.__elementTemplateRoot.find(".tchmi-event-grid-template-confirm-all-popup")),0===this.__elementTemplateRoot.length||0===this.__elementGridContainer.length||0===this.__elementMenuBar.length||0===this.__elementTypeToggles.length||0===this.__elementSeverityToggles.length||0===this.__elementOptions.length||0===this.__elementMessageActions.length||0===this.__elementFilterPopup.length||0===this.__elementColumnsPopup.length||0===this.__elementDetailsPopup.length||0===this.__elementConfirmAllPopup.length)throw new Error("Invalid Template.html");let datagrid=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",this.__id+".eventDatagrid",{"data-tchmi-width":100,"data-tchmi-width-unit":"%","data-tchmi-height":100,"data-tchmi-height-unit":"%","data-tchmi-row-classes-provider":{objectType:"Function",active:!0,fn:"EventClassesProvider",fnParams:[]},"data-tchmi-cell-content-padding":{left:3,right:3}},this);if(!datagrid)throw new Error("Could not create controls for TcHmiEventGrid.");datagrid.__setDataSymbolTransform(TcHmi.Server.Events.parseServerEvent),this.__datagrid=datagrid;let localizedElements=this.__element[0].querySelectorAll("[data-tchmi-localized-content-key]");for(let i=0,ii=localizedElements.length;i<ii;i++){let element=localizedElements[i],localizeKey=element.dataset.tchmiLocalizedContentKey;localizeKey&&this.__localizedElements.set(element,{key:localizeKey})}this.__destroyLocalizationWatch=this.__localization.watch(data=>{if(data.error===TcHmi.Errors.NONE&&data.reader){this.__localizationReader=data.reader;for(const[element,info]of this.__localizedElements){let localizedText=data.reader.get(info.key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}}),super.__previnit()}__init(){super.__init(),this.__initStorage(),this.__onUserInGroupChangedDestroyer=TcHmi.EventProvider.register("onUserInGroupChanged",this.__onUserInGroupChanged),this.__elementGridContainer.append(this.__datagrid.getElement());for(const type of this.__typeToggles.keys()){let buttonName=TcHmi.Server.Events.Type[type].toLowerCase(),button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}.${buttonName}ToggleButton`,{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[buttonName],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight,"data-tchmi-icon":`${Controls.getBasePathEx(this)}/Themes/Base/Images/${buttonName}.svg`,"data-tchmi-icon-width":30,"data-tchmi-icon-height":30,"data-tchmi-icon-horizontal-alignment":"Left"},this);if(!button)throw new Error("Could not create controls for TcHmiEventGrid.");let buttonElement=button.getElement();buttonElement.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${buttonName.toLowerCase()}-toggle-button`),buttonElement.addClass(`tchmi-event-grid-template-${buttonName.toLowerCase()}-toggle-button`),this.__typeToggles.set(type,button),this.__elementTypeToggles.append(buttonElement)}for(const severity of this.__severityToggles.keys()){let buttonName=TcHmi.Server.Events.Severity[severity].toLowerCase(),button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiToggleButton",`${this.__id}.${buttonName}ToggleButton`,{"data-tchmi-width":void 0!==this.__buttonHeight?2*this.__buttonHeight:60,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-text":"0","data-tchmi-text-horizontal-alignment":"Right","data-tchmi-text-padding":{left:0,top:0,right:7,bottom:0},"data-tchmi-toggle-state":"Active","data-tchmi-tooltip":this.__buttonTooltips[buttonName],"data-tchmi-text-font-family":this.__buttonFontFamily,"data-tchmi-text-font-size":this.__buttonFontSize,"data-tchmi-text-font-size-unit":this.__buttonFontSizeUnit,"data-tchmi-text-font-style":this.__buttonFontStyle,"data-tchmi-text-font-weight":this.__buttonFontWeight,"data-tchmi-icon":`${Controls.getBasePathEx(this)}/Themes/Base/Images/${buttonName}.svg`,"data-tchmi-icon-width":30,"data-tchmi-icon-height":30,"data-tchmi-icon-horizontal-alignment":"Left"},this);if(!button)throw new Error("Could not create controls for TcHmiEventGrid.");let buttonElement=button.getElement();buttonElement.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${buttonName.toLowerCase()}-toggle-button`),buttonElement.addClass(`tchmi-event-grid-template-${buttonName.toLowerCase()}-toggle-button`),this.__severityToggles.set(severity,button),this.__elementSeverityToggles.append(buttonElement)}for(const buttonName of this.__menuBarButtons.keys()){let button=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__id}.${buttonName}Button`,{"data-tchmi-width":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-height":void 0!==this.__buttonHeight?this.__buttonHeight:30,"data-tchmi-tooltip":this.__buttonTooltips[buttonName]},this);if(!button)throw new Error("Could not create controls for TcHmiEventGrid.");let buttonElement=button.getElement();buttonElement.addClass(`TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-${buttonName.toLowerCase()}-button`),buttonElement.addClass(`tchmi-event-grid-template-${buttonName.toLowerCase()}-button`),this.__menuBarButtons.set(buttonName,button),"confirm"===buttonName||"confirmAll"===buttonName?(button.setIsEnabled(!1),this.__elementMessageActions.append(buttonElement)):this.__elementOptions.append(buttonElement)}let configureMapping=[{controlRight:"operate",virtualControlRight:"configure"}],filterButton=this.__menuBarButtons.get("filter");filterButton&&filterButton.setVirtualControlRightMappings(configureMapping);let columnsButton=this.__menuBarButtons.get("columns");columnsButton&&columnsButton.setVirtualControlRightMappings(configureMapping)}__attach(){super.__attach(),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__id+".onResized",this.__onResized)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register("onThemeDataChanged",this.__onThemeDataChanged));for(const[type,button]of this.__typeToggles)this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(button.getId()+".onToggleStateChanged",this.__getTypeToggleStateChangedHandler(button,type)));for(const[severity,button]of this.__severityToggles)this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(button.getId()+".onToggleStateChanged",this.__getSeverityToggleStateChangedHandler(button,severity)));this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__datagrid.getId()+".onPropertyChanged<selectedRowValue>",this.__onSelectedItemChanged)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__datagrid.getId()+".onPropertyChanged",this.__onDataGridPropertyChanged)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("filter").getId()+".onPressed",this.__onFilterPressed)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("columns").getId()+".onPressed",this.__onColumnsPressed)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("confirm").getId()+".onPressed",this.__onConfirmPressed)),this.__destroyersToCallOnDetach.push(TcHmi.EventProvider.register(this.__menuBarButtons.get("confirmAll").getId()+".onPressed",this.__onConfirmAllPressed));this.__elementGridContainer[0].addEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].addEventListener("touchstart",this.__onTouchStart,{passive:!1,capture:!1}),this.__elementGridContainer[0].addEventListener("scroll",this.__onScroll,!0),this.__updateThemedResources();let filter=this.__getStoredValue("filter");filter?this.__updateFilter(filter):this.__processFilter();let columns=this.__getStoredValue("columns");columns?this.__updateColumns(columns):this.__processColumns()}__detach(){super.__detach();for(let i=0,ii=this.__destroyersToCallOnDetach.length;i<ii;i++)this.__destroyersToCallOnDetach[i]();this.__destroyersToCallOnDetach=[];this.__elementGridContainer[0].removeEventListener("dblclick",this.__onDoubleclick),this.__elementGridContainer[0].removeEventListener("touchstart",this.__onTouchStart,{passive:!1,capture:!1}),this.__elementGridContainer[0].removeEventListener("scroll",this.__onScroll),this.__updateSubscription(!0)}destroy(){var _a;this.__keepAlive||(super.destroy(),this.__onUserInGroupChangedDestroyer&&(this.__onUserInGroupChangedDestroyer(),this.__onUserInGroupChangedDestroyer=null),this.__filterPopup&&(this.__filterPopup.destroy(),this.__filterPopup=null),this.__columnsPopup&&(this.__columnsPopup.destroy(),this.__columnsPopup=null),this.__detailsPopup&&(this.__detailsPopup.destroy(),this.__detailsPopup=null),this.__confirmAllPopup&&(this.__confirmAllPopup.destroy(),this.__confirmAllPopup=null),null===(_a=this.__destroyLocalizationWatch)||void 0===_a||_a.call(this))}__addLocalizedElement(element,key,...parameters){let info={key:key};if(0!==parameters.length&&(info.parameters=parameters),this.__localizedElements.set(element,info),this.__localizationReader){let localizedText=this.__localizationReader.get(key);info.parameters&&(localizedText=tchmi_format_string(localizedText,...info.parameters)),element.textContent=tchmi_decode_control_characters(localizedText)}}__removeLocalizedElement(element){this.__localizedElements.delete(element)}__getTypeToggleStateChangedHandler(toggleButton,type){return()=>{this.__typesToShow.set(type,"Active"===toggleButton.getToggleState()),this.__updateDatagridFilter()}}__getSeverityToggleStateChangedHandler(toggleButton,severity){return()=>{this.__severitiesToShow.set(severity,"Active"===toggleButton.getToggleState()),this.__updateDatagridFilter()}}__showDetails(){this.__allowDetailsPopup&&(this.__detailsPopup||(this.__detailsPopup=new Beckhoff.TcHmiEventGridPopups.DetailsPopup(this.__elementDetailsPopup[0],this)),this.__detailsPopup.update(this.__datagrid.getSelectedRowValue()),this.__detailsPopup.show())}__processSelectedItem(){let event=this.__datagrid.getSelectedRowValue();null===event?(this.__menuBarButtons.get("confirm").setIsEnabled(!1),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.hide()):(this.__menuBarButtons.get("confirm").setIsEnabled(TcHmi.Server.Events.isAlarm(event)&&event.confirmationState===TcHmi.Server.Events.ConfirmationState.WaitForConfirmation),this.__detailsPopup&&this.__detailsPopup.isShowing()&&this.__detailsPopup.update(event))}__updateSubscription(unsubscribeOnly=!1){var _a,_b;if(TCHMI_DESIGNER)return;if(null!==this.__subscriptionId&&TcHmi.Server.unsubscribeEx(this.__subscriptionId,null,data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.details))}),this.__subscriptionId=null,unsubscribeOnly||!this.__isAttached)return;let commands=this.__getToggleButtonCommands(),[confirmableCommand,confirmableHandler]=this.__getConfirmAllCommand();commands.set(confirmableCommand,confirmableHandler),commands.size>0&&(this.__subscriptionId=TcHmi.Server.subscribeEx(Array.from(commands.keys()),null!==(_b=null!==(_a=this.__serverInterval)&&void 0!==_a?_a:TcHmi.Config.get().tcHmiServer.websocketIntervalTime)&&void 0!==_b?_b:500,null,this.__getServerResponseHandler(commands)))}__getServerResponseHandler(commands){const propertiesToCheck=["symbol","customerData","writeValue","filter","orderBy","limit","offset"];return data=>{if(data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.response.error));else if(data.response.commands&&0!==data.response.commands.length)for(const command of data.response.commands)if(command.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.response.commands[0].error));else for(const[checkCommand,handler]of commands){let matches=!0;for(let prop in checkCommand)if(propertiesToCheck.includes(prop)&&!tchmi_equal(checkCommand[prop],command[prop])){matches=!1;break}if(matches){handler(command,data);break}}else TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:"Missing commands in response from server with id: '"+data.response.id+"'.",domain:this.__type}));else TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__type}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(data.details))}}__getToggleButtonCommands(){let commands=new Map;function getToggleButtonSubscriptionHandler(toggleButton){return(command,data)=>{toggleButton.setText(command.maxEntries?command.maxEntries.toString():"0")}}for(const[type,button]of this.__typeToggles){if(!button)continue;let typeComparison={path:"type",comparator:"==",value:type},filter=0===this.__internalFilter.length?[typeComparison]:[typeComparison,{logic:"AND"},this.__internalFilter];commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",limit:0,filter:filter},getToggleButtonSubscriptionHandler(button))}for(const[severity,button]of this.__severityToggles){if(!button)continue;let severityComparison={path:"severity",comparator:"==",value:severity},filter=0===this.__noPayloadsFilter.length?[severityComparison]:[severityComparison,{logic:"AND"},this.__noPayloadsFilter];commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",limit:0,filter:filter},getToggleButtonSubscriptionHandler(button))}return commands}__getConfirmAllCommand(){return[{commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter(),limit:0},(command,data)=>{var _a,_b;null===(_a=this.__menuBarButtons.get("confirmAll"))||void 0===_a||_a.setIsEnabled((null!==(_b=command.maxEntries)&&void 0!==_b?_b:0)>0)}]}__getConfirmAllFilter(){let filter=[{path:"type",comparator:"==",value:TcHmi.Server.Events.Type.Alarm},{logic:"AND"},{path:"confirmationState",comparator:"==",value:TcHmi.Server.Events.ConfirmationState.WaitForConfirmation}];return 0!==this.__internalFilter.length&&filter.push({logic:"AND"},this.__internalFilter),filter}__initStorage(){let stored=window.localStorage.getItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id);if(stored)try{this.__storage=JSON.parse(stored),"object"!=typeof this.__storage&&(this.__storage={})}catch(ex){this.__storage={}}else this.__storage={};for(let key in this.__storageValidation)this.__storageValidation[key].expectedResult=this[this.__storageValidation[key].function].apply(this);for(let key in this.__storage)tchmi_equal(this.__storageValidation[key].expectedResult,this.__storage[key].validation.expectedResult)||this.__removeStoredValue(key)}__getStoredValue(key){this.__storage||this.__initStorage();let user=TcHmi.Server.getCurrentUser(),storageForKey=this.__storage[key];if(storageForKey)return user?storageForKey.users?storageForKey.users[user]:void 0:storageForKey.anonymousUser}__setStoredValueWithValidation(key,value){var _a;this.__storage||this.__initStorage();let user=TcHmi.Server.getCurrentUser(),valueEqualsValidation=tchmi_equal(value,this.__storageValidation[key].expectedResult);if(!this.__storage[key]){if(valueEqualsValidation)return;this.__storage[key]={validation:{function:this.__storageValidation[key].function,expectedResult:void 0}}}let storageForKey=this.__storage[key];if(storageForKey.validation.expectedResult=this.__storageValidation[key].expectedResult,user){if(!(null===(_a=storageForKey.users)||void 0===_a?void 0:_a[user])&&valueEqualsValidation)return;storageForKey.users||(storageForKey.users={}),storageForKey.users[user]=value}else{if(void 0===storageForKey.anonymousUser&&valueEqualsValidation)return;storageForKey.anonymousUser=value}try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(ex){}}__removeStoredValue(key){this.__storage||this.__initStorage();let storageForKey=this.__storage[key];if(storageForKey){let user=TcHmi.Server.getCurrentUser();user?storageForKey.users?(delete storageForKey.users[user],0===Object.keys(storageForKey.users).length&&(void 0===storageForKey.anonymousUser?delete this.__storage[key]:delete storageForKey.users)):void 0===storageForKey.anonymousUser&&delete this.__storage[key]:storageForKey.users?delete storageForKey.anonymousUser:delete this.__storage[key]}if(Object.keys(this.__storage).length>0)try{window.localStorage.setItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id,JSON.stringify(this.__storage))}catch(ex){}else window.localStorage.removeItem("TCHMI_TCHMIEVENTGRID_USERPREFERENCES_"+this.__id)}__updateThemedResources(){this.__themedIcons=this.__getThemedIcons();let setIcon=(button,icon,buttonName)=>{icon?(button.setIcon(icon.imagePath),button.setIconWidth(icon.width),button.setIconHeight(icon.height)):(button.setIcon(`Themes/Base/Images/${buttonName}.svg`),button.setIconWidth(30),button.setIconHeight(30))};for(const[type,button]of this.__typeToggles)button&&setIcon(button,this.__themedIcons.types.get(type),TcHmi.Server.Events.Type[type].toLowerCase());for(const[severity,button]of this.__severityToggles)button&&setIcon(button,this.__themedIcons.severities.get(severity),TcHmi.Server.Events.Severity[severity].toLowerCase())}__getThemedIcons(){let getThemedIconValue=name=>{let themedResource=TcHmi.Theme.Resources.get(this,name);return themedResource.error===TcHmi.Errors.NONE&&themedResource.value?(themedResource.value.imagePath=TcHmi.Theme.Resources.resolveBasePath(this,themedResource)+themedResource.value.imagePath,themedResource.value):null},icons={types:new Map,severities:new Map};return icons.types.set(TcHmi.Server.Events.Type.Message,getThemedIconValue("MessageIcon")),icons.types.set(TcHmi.Server.Events.Type.Alarm,getThemedIconValue("AlarmIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Verbose,getThemedIconValue("VerboseIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Info,getThemedIconValue("InfoIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Warning,getThemedIconValue("WarningIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Error,getThemedIconValue("ErrorIcon")),icons.severities.set(TcHmi.Server.Events.Severity.Critical,getThemedIconValue("CriticalIcon")),icons}setColumns(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Columns"));let resolverInfo=this.__objectResolvers.get("columns");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("columns",{resolver:resolver,watchCallback:this.__onResolverForColumnsWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForColumnsWatchCallback)})}getColumns(){return this.__columns}__processColumns(){var _a;this.__updateColumns(null!==(_a=this.__columns)&&void 0!==_a?_a:[])}__updateColumns(columns){this.__internalColumns=columns;let columnConfig=columns.map(column=>{let dgColumn;return dgColumn=this.__availableColumns[column.columnName]?tchmi_clone_object(this.__availableColumns[column.columnName]):{name:column.columnName,label:void 0!==column.label&&null!==column.label?column.label:column.columnName,control:"TextBlock",width:150,widthUnit:"px",resize:!0,minWidth:50,minWidthUnit:"px",editable:!1,sortable:!0,horizontalAlignment:"Left",verticalAlignment:"Center"},void 0!==column.width&&(dgColumn.width=column.width,column.widthUnit&&(dgColumn.widthUnit=column.widthUnit)),("type"===dgColumn.name||"severity"===dgColumn.name)&&dgColumn.dataDefinitions&&Array.isArray(dgColumn.dataDefinitions)&&dgColumn.dataDefinitions.forEach(definition=>{let icon="type"===dgColumn.name?this.__themedIcons.types.get(definition.value):this.__themedIcons.severities.get(definition.value);icon&&(definition.source=icon.imagePath,definition.width=icon.width,definition.height=icon.height)}),dgColumn.sortable&&void 0!==column.sortable&&(dgColumn.sortable=column.sortable),dgColumn});this.__datagrid.setSrcColumn(columnConfig)}setFilter(valueNew){let convertedValue=TcHmi.ValueConverter.toObject(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("Filter"));let resolverInfo=this.__objectResolvers.get("filter");resolverInfo&&(resolverInfo.watchDestroyer&&resolverInfo.watchDestroyer(),resolverInfo.resolver.destroy());let resolver=new TcHmi.Symbol.ObjectResolver(convertedValue);this.__objectResolvers.set("filter",{resolver:resolver,watchCallback:this.__onResolverForFilterWatchCallback,watchDestroyer:resolver.watch(this.__onResolverForFilterWatchCallback)})}getFilter(){return this.__filter}__processFilter(){var _a;this.__updateFilter(null!==(_a=this.__filter)&&void 0!==_a?_a:[])}__updateFilter(filter){this.__isAttached&&(this.__internalFilter=filter,this.__noPayloadsFilter=[{path:"type",comparator:"!=",value:TcHmi.Server.Events.Type.Payload}],0!==filter.length&&this.__noPayloadsFilter.push({logic:"AND"},filter),this.__updateDatagridFilter(),this.__updateSubscription())}__updateDatagridFilter(){let hideFilter=[];for(const[type,show]of this.__typesToShow)show||(0!==hideFilter.length&&hideFilter.push({logic:"AND"}),hideFilter.push({path:"type",comparator:"!=",value:type}));for(const[severity,show]of this.__severitiesToShow)show||(0!==hideFilter.length&&hideFilter.push({logic:"AND"}),hideFilter.push({path:"severity",comparator:"!=",value:severity}));let filter=0===hideFilter.length?this.__noPayloadsFilter:[hideFilter,{logic:"AND"},this.__noPayloadsFilter];this.__datagrid.setFilter(filter)}setSorting(valueNew){this.__datagrid.setSorting(valueNew),this.__sortingInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"Sorting"}),this.__sortingInitialized=!0)}getSorting(){return this.__sortingInitialized?this.__datagrid.getSorting():void 0}setServerInterval(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ServerInterval")),convertedValue!==this.__serverInterval&&(this.__serverInterval=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ServerInterval"}),this.__processServerInterval())}getServerInterval(){return this.__serverInterval}__processServerInterval(){void 0!==this.__serverInterval&&null!==this.__serverInterval?this.__datagrid.setDataSymbol(new TcHmi.Symbol(`%s%ListEvents|Interval=${this.__serverInterval}%/s%`)):this.__datagrid.setDataSymbol(new TcHmi.Symbol("%s%ListEvents%/s%")),this.__updateSubscription()}setHeaderFontFamily(valueNew){this.__datagrid.setHeaderFontFamily(valueNew),this.__headerFontFamilyInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontFamily"}),this.__headerFontFamilyInitialized=!0)}getHeaderFontFamily(){return this.__headerFontFamilyInitialized?this.__datagrid.getHeaderFontFamily():void 0}setHeaderFontSize(valueNew){this.__datagrid.setHeaderFontSize(valueNew),this.__headerFontSizeInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontSize"}),this.__headerFontSizeInitialized=!0)}getHeaderFontSize(){return this.__headerFontSizeInitialized?this.__datagrid.getHeaderFontSize():void 0}setHeaderFontSizeUnit(valueNew){this.__datagrid.setHeaderFontSizeUnit(valueNew),this.__headerFontSizeUnitInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontSizeUnit"}),this.__headerFontSizeUnitInitialized=!0)}getHeaderFontSizeUnit(){return this.__headerFontSizeUnitInitialized?this.__datagrid.getHeaderFontSizeUnit():void 0}setHeaderFontStyle(valueNew){this.__datagrid.setHeaderFontStyle(valueNew),this.__headerFontStyleInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontStyle"}),this.__headerFontStyleInitialized=!0)}getHeaderFontStyle(){return this.__headerFontStyleInitialized?this.__datagrid.getHeaderFontStyle():void 0}setHeaderFontWeight(valueNew){this.__datagrid.setHeaderFontWeight(valueNew),this.__headerFontWeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderFontWeight"}),this.__headerFontWeightInitialized=!0)}getHeaderFontWeight(){return this.__headerFontWeightInitialized?this.__datagrid.getHeaderFontWeight():void 0}setGridFontFamily(valueNew){this.__datagrid.setGridFontFamily(valueNew),this.__datagrid.setRowNumbersFontFamily(valueNew),this.__gridFontFamilyInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontFamily"}),this.__gridFontFamilyInitialized=!0)}getGridFontFamily(){return this.__gridFontFamilyInitialized?this.__datagrid.getGridFontFamily():void 0}setGridFontSize(valueNew){this.__datagrid.setGridFontSize(valueNew),this.__datagrid.setRowNumbersFontSize(valueNew),this.__gridFontSizeInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontSize"}),this.__gridFontSizeInitialized=!0)}getGridFontSize(){return this.__gridFontSizeInitialized?this.__datagrid.getGridFontSize():void 0}setGridFontSizeUnit(valueNew){this.__datagrid.setGridFontSizeUnit(valueNew),this.__datagrid.setRowNumbersFontSizeUnit(valueNew),this.__gridFontSizeUnitInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontSizeUnit"}),this.__gridFontSizeUnitInitialized=!0)}getGridFontSizeUnit(){return this.__gridFontSizeUnitInitialized?this.__datagrid.getGridFontSizeUnit():void 0}setGridFontStyle(valueNew){this.__datagrid.setGridFontStyle(valueNew),this.__datagrid.setRowNumbersFontStyle(valueNew),this.__gridFontStyleInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontStyle"}),this.__gridFontStyleInitialized=!0)}getGridFontStyle(){return this.__gridFontStyleInitialized?this.__datagrid.getGridFontStyle():void 0}setGridFontWeight(valueNew){this.__datagrid.setGridFontWeight(valueNew),this.__datagrid.setRowNumbersFontWeight(valueNew),this.__gridFontWeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"GridFontWeight"}),this.__gridFontWeightInitialized=!0)}getGridFontWeight(){return this.__gridFontWeightInitialized?this.__datagrid.getGridFontWeight():void 0}setHeaderHeight(valueNew){this.__datagrid.setHeaderHeight(valueNew),this.__headerHeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderHeight"}),this.__headerHeightInitialized=!0)}getHeaderHeight(){return this.__headerHeightInitialized?this.__datagrid.getHeaderHeight():void 0}setHeaderHeightUnit(valueNew){this.__datagrid.setHeaderHeightUnit(valueNew),this.__headerHeightUnitInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"HeaderHeightUnit"}),this.__headerHeightUnitInitialized=!0)}getHeaderHeightUnit(){return this.__headerHeightUnitInitialized?this.__datagrid.getHeaderHeightUnit():void 0}setRowHeight(valueNew){this.__datagrid.setRowHeight(valueNew),this.__rowHeightInitialized||(TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"RowHeight"}),this.__rowHeightInitialized=!0)}getRowHeight(){return this.__rowHeightInitialized?this.__datagrid.getRowHeight():void 0}getRowHeightUnit(){return"px"}setAllowDetailsPopup(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("AllowDetailsPopup")),convertedValue!==this.__allowDetailsPopup&&(this.__allowDetailsPopup=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"AllowDetailsPopup"}),this.__processAllowDetailsPopup())}getAllowDetailsPopup(){return this.__allowDetailsPopup}__processAllowDetailsPopup(){}setShowMenuBar(valueNew){let convertedValue=TcHmi.ValueConverter.toBoolean(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ShowMenuBar")),convertedValue!==this.__showMenuBar&&(this.__showMenuBar=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ShowMenuBar"}),this.__processShowMenuBar())}getShowMenuBar(){return this.__showMenuBar}__processShowMenuBar(){this.__showMenuBar?(TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display",null),this.__fixVerticalMenuBarWidth()):TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"display","none")}setMenuBarPosition(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);(null===convertedValue||"Top"!==convertedValue&&"Bottom"!==convertedValue&&"Left"!==convertedValue&&"Right"!==convertedValue)&&(convertedValue=this.getAttributeDefaultValueInternal("MenuBarPosition")),convertedValue!==this.__menuBarPosition&&(this.__menuBarPosition=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"MenuBarPosition"}),this.__processMenuBarPosition())}getMenuBarPosition(){return this.__menuBarPosition}__processMenuBarPosition(){switch(this.__menuBarPosition){case"Top":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction",null),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Bottom":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","column-reverse"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction",null);break;case"Left":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column");break;case"Right":TcHmi.StyleProvider.setSimpleElementStyle(this.__elementTemplateRoot,"flex-direction","row-reverse"),TcHmi.StyleProvider.setSimpleElementStyle(this.__elementMenuBar,"flex-direction","column")}this.__fixVerticalMenuBarWidth()}setButtonFontFamily(valueNew){let convertedValue=TcHmi.ValueConverter.toString(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontFamily")),convertedValue!==this.__buttonFontFamily&&(this.__buttonFontFamily=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontFamily"}),this.__processButtonFontFamily())}getButtonFontFamily(){return this.__buttonFontFamily}__processButtonFontFamily(){var _a,_b;for(const button of this.__typeToggles.values())button&&button.setTextFontFamily(null!==(_a=this.__buttonFontFamily)&&void 0!==_a?_a:null);for(const button of this.__severityToggles.values())button&&button.setTextFontFamily(null!==(_b=this.__buttonFontFamily)&&void 0!==_b?_b:null)}setButtonFontSize(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontSize")),convertedValue!==this.__buttonFontSize&&(this.__buttonFontSize=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontSize"}),this.__processButtonFontSize())}getButtonFontSize(){return this.__buttonFontSize}__processButtonFontSize(){var _a,_b;for(const button of this.__typeToggles.values())button&&button.setTextFontSize(null!==(_a=this.__buttonFontSize)&&void 0!==_a?_a:null);for(const button of this.__severityToggles.values())button&&button.setTextFontSize(null!==(_b=this.__buttonFontSize)&&void 0!==_b?_b:null)}setButtonFontSizeUnit(valueNew){let convertedValue=TcHmi.ValueConverter.toDimensionUnit(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontSizeUnit")),convertedValue!==this.__buttonFontSizeUnit&&(this.__buttonFontSizeUnit=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontSizeUnit"}),this.__processButtonFontSizeUnit())}getButtonFontSizeUnit(){return this.__buttonFontSizeUnit}__processButtonFontSizeUnit(){var _a,_b;for(const button of this.__typeToggles.values())button&&button.setTextFontSizeUnit(null!==(_a=this.__buttonFontSizeUnit)&&void 0!==_a?_a:null);for(const button of this.__severityToggles.values())button&&button.setTextFontSizeUnit(null!==(_b=this.__buttonFontSizeUnit)&&void 0!==_b?_b:null)}setButtonFontStyle(valueNew){let convertedValue=TcHmi.ValueConverter.toFontStyle(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontStyle")),convertedValue!==this.__buttonFontStyle&&(this.__buttonFontStyle=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontStyle"}),this.__processButtonFontStyle())}getButtonFontStyle(){return this.__buttonFontStyle}__processButtonFontStyle(){var _a,_b;for(const button of this.__typeToggles.values())button&&button.setTextFontStyle(null!==(_a=this.__buttonFontStyle)&&void 0!==_a?_a:null);for(const button of this.__severityToggles.values())button&&button.setTextFontStyle(null!==(_b=this.__buttonFontStyle)&&void 0!==_b?_b:null)}setButtonFontWeight(valueNew){let convertedValue=TcHmi.ValueConverter.toFontWeight(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonFontWeight")),convertedValue!==this.__buttonFontWeight&&(this.__buttonFontWeight=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonFontWeight"}),this.__processButtonFontWeight())}getButtonFontWeight(){return this.__buttonFontWeight}__processButtonFontWeight(){var _a,_b;for(const button of this.__typeToggles.values())button&&button.setTextFontWeight(null!==(_a=this.__buttonFontWeight)&&void 0!==_a?_a:null);for(const button of this.__severityToggles.values())button&&button.setTextFontWeight(null!==(_b=this.__buttonFontWeight)&&void 0!==_b?_b:null)}setButtonHeight(valueNew){let convertedValue=TcHmi.ValueConverter.toNumber(valueNew);null===convertedValue&&(convertedValue=this.getAttributeDefaultValueInternal("ButtonHeight")),convertedValue!==this.__buttonHeight&&(this.__buttonHeight=convertedValue,TcHmi.EventProvider.raise(this.__id+".onPropertyChanged",{propertyName:"ButtonHeight"}),this.__processButtonHeight())}getButtonHeight(){return this.__buttonHeight}__processButtonHeight(){var _a,_b,_c,_d;for(const button of this.__typeToggles.values())button&&(button.setHeight(null!==(_a=this.__buttonHeight)&&void 0!==_a?_a:null),button.setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(const button of this.__severityToggles.values())button&&(button.setHeight(null!==(_b=this.__buttonHeight)&&void 0!==_b?_b:null),button.setWidth(void 0!==this.__buttonHeight?2*this.__buttonHeight:null));for(const button of this.__menuBarButtons.values())button&&(button.setHeight(null!==(_c=this.__buttonHeight)&&void 0!==_c?_c:null),button.setWidth(null!==(_d=this.__buttonHeight)&&void 0!==_d?_d:null));this.__fixVerticalMenuBarWidth()}getButtonHeightUnit(){return"px"}__fixVerticalMenuBarWidth(){let flexboxes=this.__elementMenuBar.add(this.__elementMenuBar.children());if(TcHmi.StyleProvider.setSimpleElementStyle(flexboxes,"min-width",null),"Left"===this.__menuBarPosition||"Right"===this.__menuBarPosition)for(let i=flexboxes.length-1;i>=0;i--){let lastElement=flexboxes[i].lastElementChild;if(lastElement){let menuBarWidth=lastElement.getBoundingClientRect().right-flexboxes[i].getBoundingClientRect().left;TcHmi.StyleProvider.setSimpleElementStyle(flexboxes[i],"min-width",menuBarWidth+"px")}}}getSelectedEvent(){return this.__datagrid?this.__datagrid.getSelectedRowValue():null}confirmSelectedAlarm(ctx){let alarm=this.getSelectedEvent();alarm?TcHmi.Server.Events.isAlarm(alarm)?TcHmi.Server.Events.confirmAlarm(alarm,data=>{data.error!==TcHmi.Errors.NONE?TCHMI_CONSOLE_LOG_LEVEL>=1&&(TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+"] Unable to confirm alarm with id "+alarm.id+" in domain "+alarm.domain+". Error: "+TcHmi.Log.buildMessage(data.details)),ctx.error(data.error,data.details)):ctx.success(data.error)}):ctx.error(TcHmi.Errors.E_INVALID,{code:TcHmi.Errors.E_INVALID,message:TcHmi.Errors[TcHmi.Errors.E_INVALID],reason:"The selected event is not an alarm. Select an alarm to be able to confirm it.",domain:this.__type}):ctx.success(TcHmi.Errors.NONE)}confirmAllAlarms(ctx){const commands=new Map;commands.set({commandOptions:["SendErrorMessage"],symbol:"ListEvents",filter:this.__getConfirmAllFilter()},(command,data)=>{var _a;if(!command.readValue){let error={code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:"Missing property: 'readValue' in command for symbol: 'ListEvents' in response from server with id: '"+(null===(_a=data.response)||void 0===_a?void 0:_a.id)+"'.",domain:this.__type};return TcHmi.Log.error(`[Source=Control, Module=${this.__type}, Id=${this.getId()}, Symbol=ListEvents] `+TcHmi.Log.buildMessage(error)),void ctx.error(TcHmi.Errors.E_SERVER_READVALUE_MISSING,error)}const alarms=command.readValue.map(TcHmi.Server.Events.parseServerEvent).filter(TcHmi.Server.Events.isAlarm);let confirmErrors=[];for(let i=0,ii=alarms.length;i<ii;i++)TcHmi.Server.Events.confirmAlarm(alarms[i],data=>{if(data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&(TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.getId()+"] Unable to confirm alarm with id "+alarms[i].id+" in domain "+alarms[i].domain+". Error: "+TcHmi.Log.buildMessage(data.details)),data.details&&confirmErrors.push(data.details)),"object"==typeof data.details&&null!==data.details&&data.details.code===TcHmi.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__setCanConfirm(!1),i===alarms.length-1)if(1===confirmErrors.length)ctx.error(confirmErrors[0].code,confirmErrors[0]);else if(confirmErrors.length>1){let error={code:TcHmi.Errors.ERROR,message:TcHmi.Errors[TcHmi.Errors.ERROR],reason:"[Source = Control, Module = TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id = "+this.getId()+"] Unable to confirm multiple alarms.",domain:this.__type,errors:confirmErrors};ctx.error(TcHmi.Errors.ERROR,error)}else ctx.success(TcHmi.Errors.NONE)})}),TcHmi.Server.requestEx({requestType:"ReadWrite",commands:Array.from(commands.keys())},null,this.__getServerResponseHandler(commands))}__processIsEnabled(){super.__processIsEnabled(),this.getIsEnabled()||this.__hideAllPopups()}__processAccessConfig(){super.__processAccessConfig(),!1!==TcHmi.Access.checkAccess(this,"operate")&&!1!==TcHmi.Access.checkAccess(this,"observe")||this.__hideAllPopups(),TcHmi.Access.checkAccess(this,"configure")||(this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide()),TcHmi.Access.checkAccess(this,"viewDetails")||this.__detailsPopup&&this.__detailsPopup.hide()}__hideAllPopups(){this.__filterPopup&&this.__filterPopup.hide(),this.__columnsPopup&&this.__columnsPopup.hide(),this.__detailsPopup&&this.__detailsPopup.hide(),this.__confirmAllPopup&&this.__confirmAllPopup.hide()}__setCanConfirm(value){this.__canConfirm=value,this.__detailsPopup&&this.__detailsPopup.__setCanConfirm(value),this.__menuBarButtons.get("confirm").getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!value),this.__menuBarButtons.get("confirmAll").getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!value),this.__menuBarButtons.get("confirm").getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!value),this.__menuBarButtons.get("confirmAll").getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!value),this.__menuBarButtons.get("confirm").setIsEnabled(value),this.__menuBarButtons.get("confirmAll").setIsEnabled(value)}__getCanConfirm(){return this.__canConfirm}}Beckhoff.TcHmiEventGrid=TcHmiEventGrid}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),TcHmi.Controls.registerEx("TcHmiEventGrid","TcHmi.Controls.Beckhoff",TcHmi.Controls.Beckhoff.TcHmiEventGrid),function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){let TcHmiEventGridPopups;!function(TcHmiEventGridPopups){TcHmiEventGridPopups.Popup=class{constructor(element,name,control){if(this.__eventDestroyers=[],this.__isShowing=!1,this.__name=name,this.__parentControl=control,this.__element=element,this.__elementContent=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-content")[0],this.__elementFooter=element.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-popup-footer")[0],!this.__element||!this.__elementContent||!this.__elementFooter)throw new Error("Invalid Template.html")}show(){this.__isShowing||(TcHmi.TopMostLayer.add(this.__parentControl,$(this.__element),{removeCb:()=>{this.__isShowing=!1},centerHorizontal:!0,centerVertical:!0}),this.__isShowing=!0)}hide(){this.__isShowing&&(TcHmi.TopMostLayer.remove(this.__parentControl,$(this.__element)),this.__isShowing=!1)}destroy(){for(let i=0,ii=this.__eventDestroyers.length;i<ii;i++)this.__eventDestroyers[i]()}isShowing(){return this.__isShowing}}}(TcHmiEventGridPopups=Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){let TcHmiEventGridPopups;!function(TcHmiEventGridPopups){class SettingsPopup extends TcHmiEventGridPopups.Popup{constructor(element,name,control){super(element,name,control),this.__resetHandlers=[],this.__okHandlers=[],this.__cancelHandlers=[],this.__updateRequired=!0;let resetButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.resetButton`,{"data-tchmi-width":170,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Reset_Config%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Reset_Config%/l%","data-tchmi-is-enabled":!1},this.__parentControl),okButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.okButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Ok%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Ok%/l%"},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.cancelButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Cancel%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Cancel%/l%"},this.__parentControl);if(!resetButton||!okButton||!cancelButton)throw new Error("Could not create controls for SettingsPopup.");this.__elementFooter.appendChild(resetButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(resetButton.getId()+".onPressed",()=>{this.__onButtonPressed(this.__resetHandlers,!1)})),this.__elementFooter.appendChild(okButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(okButton.getId()+".onPressed",()=>{this.__onButtonPressed(this.__okHandlers,!0)})),this.__elementFooter.appendChild(cancelButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",()=>{this.__onButtonPressed(this.__cancelHandlers,!0)})),this.__resetButton=resetButton}__onButtonPressed(handlers,hide){this.__updateRequired=!0;for(let i=0,ii=handlers.length;i<ii;i++)!1===handlers[i]()&&(hide=!1);hide&&this.hide()}registerResetButtonHandler(handler){return this.__resetHandlers.push(handler),()=>{let index=this.__resetHandlers.indexOf(handler);-1!==index&&this.__resetHandlers.splice(index,1)}}registerOkButtonHandler(handler){return this.__okHandlers.push(handler),()=>{let index=this.__okHandlers.indexOf(handler);-1!==index&&this.__okHandlers.splice(index,1)}}registerCancelButtonHandler(handler){return this.__cancelHandlers.push(handler),()=>{let index=this.__cancelHandlers.indexOf(handler);-1!==index&&this.__cancelHandlers.splice(index,1)}}update(settings,resetable=!1){this.__settings=tchmi_clone_object(settings),this.__updateRequired=!1,this.__resetButton.setIsEnabled(resetable)}getSettings(){return this.__settings}requiresUpdate(){return this.__updateRequired}}TcHmiEventGridPopups.SettingsPopup=SettingsPopup}(TcHmiEventGridPopups=Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){let TcHmiEventGridPopups;!function(TcHmiEventGridPopups){class ColumnsPopup extends TcHmiEventGridPopups.SettingsPopup{constructor(element,control){super(element,"columnsPopup",control),this.__settings=[],this.__availableColumns=new TcHmi.List,this.__selectedColumns=new TcHmi.List,this.__columns={type:{label:"Column_Header_Type",order:0,allowSortable:!0},severity:{label:"Column_Header_Severity",order:1,allowSortable:!0},alarmState:{label:"Column_Header_AlarmState",order:2,allowSortable:!0},domain:{label:"Column_Header_Domain",order:3,allowSortable:!0},sourceDomain:{label:"Column_Header_SourceDomain",order:4,allowSortable:!0},name:{label:"Column_Header_Name",order:5,allowSortable:!0},text:{label:"Column_Header_Text",order:6,allowSortable:!1},timeAndDateRaised:{label:"Column_Header_TimeAndDateRaised",order:7,allowSortable:!0},timeRaised:{label:"Column_Header_TimeRaised",order:8,allowSortable:!0},dateRaised:{label:"Column_Header_DateRaised",order:9,allowSortable:!0},timeAndDateConfirmed:{label:"Column_Header_TimeAndDateConfirmed",order:10,allowSortable:!0},timeConfirmed:{label:"Column_Header_TimeConfirmed",order:11,allowSortable:!0},dateConfirmed:{label:"Column_Header_DateConfirmed",order:12,allowSortable:!0},timeAndDateCleared:{label:"Column_Header_TimeAndDateCleared",order:13,allowSortable:!0},timeCleared:{label:"Column_Header_TimeCleared",order:14,allowSortable:!0},dateCleared:{label:"Column_Header_DateCleared",order:15,allowSortable:!0},"params::":{label:"params::",order:16,allowSortable:!0}},this.__activeElement=null,this.__activeColumn=null,this.__onAvailableColumnClick=event=>{let target=event.target;if(target.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||target.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){let column=target.parentElement,index=this.__availableColumns.findIndex(item=>item.element===column);if(-1===index)return;this.__availableColumns[index].name.startsWith("params::")?(this.__settings.push({columnName:"params::"}),column=this.__createColumnDiv("params::"),this.__elementSelectedColumns.appendChild(column),this.__selectedColumns.push({name:"params::",element:column})):(this.__settings.push({columnName:this.__availableColumns[index].name}),this.__elementSelectedColumns.appendChild(this.__availableColumns[index].element),this.__selectedColumns.push(this.__availableColumns[index]),this.__availableColumns.splice(index,1)),this.__activateColumn(column)}},this.__onSelectedColumnClick=event=>{let target=event.target;if(target.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column")||target.classList.contains("tchmi-event-grid-template-columns-config-column"))this.__activateColumn(target);else if(target.classList.contains("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle")||target.classList.contains("tchmi-event-grid-template-columns-config-column-selection-toggle")){let column=target.parentElement,index=this.__selectedColumns.findIndex(item=>item.element===column);if(-1===index)return;this.__settings.splice(index,1);let changedColumn=this.__selectedColumns[index];if(this.__selectedColumns.splice(index,1),changedColumn.name.startsWith("params::"))this.__elementSelectedColumns.removeChild(changedColumn.element);else{this.__availableColumns.push(changedColumn),this.__availableColumns.sort((a,b)=>this.__columns[a.name].order-this.__columns[b.name].order);let newIndex=this.__availableColumns.indexOf(changedColumn);-1===newIndex||newIndex>=this.__elementAvailableColumns.children.length?this.__elementAvailableColumns.appendChild(changedColumn.element):this.__elementAvailableColumns.insertBefore(changedColumn.element,this.__elementAvailableColumns.children[newIndex])}this.__activateColumn(null)}},this.__onUpPressed=()=>{let index=this.__selectedColumns.findIndex(item=>item.element===this.__activeElement);if(-1===index||0===index)return;let activeSetting=this.__settings[index];this.__settings[index]=this.__settings[index-1],this.__settings[index-1]=activeSetting;let activeColumn=this.__selectedColumns[index];this.__selectedColumns[index]=this.__selectedColumns[index-1],this.__selectedColumns[index-1]=activeColumn,this.__activeElement&&this.__activeElement.previousElementSibling&&this.__activeElement.previousElementSibling.insertAdjacentElement("beforebegin",this.__activeElement),this.__updateButtons()},this.__onDownPressed=()=>{let index=this.__selectedColumns.findIndex(item=>item.element===this.__activeElement);if(-1===index||index===this.__settings.length-1)return;let activeSetting=this.__settings[index];this.__settings[index]=this.__settings[index+1],this.__settings[index+1]=activeSetting;let activeColumn=this.__selectedColumns[index];this.__selectedColumns[index]=this.__selectedColumns[index+1],this.__selectedColumns[index+1]=activeColumn,this.__activeElement&&this.__activeElement.nextElementSibling&&this.__activeElement.nextElementSibling.insertAdjacentElement("afterend",this.__activeElement),this.__updateButtons()},this.__onWidthChanged=()=>{let text=this.__widthTextbox.getText();if(!text)return this.__widthTextbox.setBackgroundColor(null),void(this.__activeColumn&&void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width&&(delete this.__activeColumn.width,delete this.__activeColumn.widthUnit));let newWidth=parseFloat(text);if(!isNaN(newWidth)&&/^[+-]?\d*\.?\d+(?:[eE][+-]\d+)?$/.test(text)){if(this.__widthTextbox.setBackgroundColor(null),this.__activeColumn&&(this.__activeColumn.width=newWidth,!this.__activeColumn.widthUnit)){let newWidthUnit=this.__widthUnitCombobox.getSelectedValue();newWidthUnit?this.__activeColumn.widthUnit=newWidthUnit:this.__widthUnitCombobox.setSelectedIndex(0)}}else this.__widthTextbox.setBackgroundColor({color:"rgba(255, 0, 0, 1)"})},this.__onWidthUnitChanged=()=>{if(!this.__activeColumn)return;let newWidthUnit=this.__widthUnitCombobox.getSelectedValue();newWidthUnit?void 0!==this.__activeColumn.width&&(this.__activeColumn.widthUnit=newWidthUnit):delete this.__activeColumn.widthUnit},this.__onNameChanged=()=>{if(!this.__activeColumn||!this.__activeElement||!this.__activeColumn.columnName.startsWith("params::"))return;let newName="params::"+(this.__nameTextbox.getText()||"");this.__activeColumn.columnName=newName,this.__activeColumn.label||(this.__activeElement.firstChild.nodeValue=newName)},this.__onLabelChanged=()=>{if(!this.__activeColumn||!this.__activeElement||!this.__activeColumn.columnName.startsWith("params::"))return;let newLabel=this.__labelTextbox.getText();newLabel?this.__activeColumn.label=newLabel:delete this.__activeColumn.label,this.__activeColumn.label?this.__activeElement.firstChild.nodeValue=this.__activeColumn.label:this.__activeColumn.columnName?this.__activeElement.firstChild.nodeValue=this.__activeColumn.columnName:this.__activeElement.firstChild.nodeValue="params::"},this.__onSortableChanged=()=>{if(!this.__activeColumn)return;let newSortable=this.__sortableCheckbox.getToggleState();newSortable&&"Active"!==newSortable?this.__activeColumn.sortable=!1:delete this.__activeColumn.sortable},this.__elementAvailableColumns=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-available-columns")[0],this.__elementSelectedColumns=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-selected-columns")[0];let elementOrderButtons=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-order-buttons")[0],elementColumnWidth=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-width")[0];this.__elementColumnName=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-name")[0],this.__elementColumnLabel=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-label")[0];let elementColumnSortable=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-column-sortable")[0];if(!(this.__elementAvailableColumns&&this.__elementSelectedColumns&&elementOrderButtons&&elementColumnWidth&&this.__elementColumnName&&this.__elementColumnLabel&&elementColumnSortable))throw new Error("Invalid Template.html");for(let key in this.__columns)this.__columns.hasOwnProperty(key)&&this.__availableColumns.push({name:key,element:this.__createColumnDiv(this.__columns[key].label,"params::"!==key)});this.__availableColumns.sort((a,b)=>this.__columns[a.name].order-this.__columns[b.name].order);let upButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.upButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Column_Up%/l%"},this.__parentControl),downButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.downButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Column_Down%/l%"},this.__parentControl),widthTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.widthTextbox`,{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-text-horizontal-alignment":"Right","data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),widthUnitCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",`${this.__parentControl.getId()}.${this.__name}.widthUnitCombobox`,{"data-tchmi-width":60,"data-tchmi-height":26,"data-tchmi-src-data":[{text:"px",value:"px"},{text:"%",value:"%"}],"data-tchmi-content-padding":{left:4,right:4},"data-tchmi-is-enabled":!1},this.__parentControl),nameTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.nameTextbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:44,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),labelTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",`${this.__parentControl.getId()}.${this.__name}.labelTextbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-is-enabled":!1},this.__parentControl),sortableCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",`${this.__parentControl.getId()}.${this.__name}.sortableCheckbox`,{"data-tchmi-width":122,"data-tchmi-height":26,"data-tchmi-is-enabled":!1},this.__parentControl);if(!(upButton&&downButton&&widthTextbox&&widthUnitCombobox&&nameTextbox&&labelTextbox&&sortableCheckbox))throw new Error("Could not create controls for ColumnsPopup.");this.__upButton=upButton,this.__downButton=downButton,this.__widthTextbox=widthTextbox,this.__widthUnitCombobox=widthUnitCombobox,this.__nameTextbox=nameTextbox,this.__labelTextbox=labelTextbox,this.__sortableCheckbox=sortableCheckbox;let upButtonElement=upButton.getElement()[0];upButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-up-button"),upButtonElement.classList.add("tchmi-event-grid-template-move-up-button"),elementOrderButtons.appendChild(upButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(upButton.getId()+".onPressed",this.__onUpPressed));let downButtonElement=downButton.getElement()[0];downButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-move-down-button"),downButtonElement.classList.add("tchmi-event-grid-template-move-down-button"),elementOrderButtons.appendChild(downButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(downButton.getId()+".onPressed",this.__onDownPressed)),elementColumnWidth.appendChild(widthTextbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(widthTextbox.getId()+".onTextChanged",this.__onWidthChanged)),elementColumnWidth.appendChild(widthUnitCombobox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(widthUnitCombobox.getId()+".onSelectionChanged",this.__onWidthUnitChanged)),this.__elementColumnName.appendChild(nameTextbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(nameTextbox.getId()+".onTextChanged",this.__onNameChanged)),this.__elementColumnLabel.appendChild(labelTextbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(labelTextbox.getId()+".onTextChanged",this.__onLabelChanged)),elementColumnSortable.appendChild(sortableCheckbox.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(sortableCheckbox.getId()+".onToggleStateChanged",this.__onSortableChanged)),this.__elementAvailableColumns.addEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.addEventListener("click",this.__onSelectedColumnClick)}destroy(){super.destroy(),this.__elementAvailableColumns.removeEventListener("click",this.__onAvailableColumnClick),this.__elementSelectedColumns.removeEventListener("click",this.__onSelectedColumnClick);for(const column of this.__availableColumns)column.name.startsWith("params::")||this.__parentControl.__removeLocalizedElement(column.element);for(const column of this.__selectedColumns)column.name.startsWith("params::")||this.__parentControl.__removeLocalizedElement(column.element)}update(columns,resetable){super.update(columns,resetable);for(let i=0,ii=this.__availableColumns.length;i<ii;i++)this.__availableColumns[i].name.startsWith("params::")||-1===columns.findIndex(column=>column.columnName===this.__availableColumns[i].name)||(this.__selectedColumns.push(this.__availableColumns[i]),this.__availableColumns.splice(i,1),i--,ii--);for(let i=0,ii=this.__selectedColumns.length;i<ii;i++)this.__selectedColumns[i].name.startsWith("params::")?(this.__selectedColumns.splice(i,1),i--,ii--):-1===columns.findIndex(column=>column.columnName===this.__selectedColumns[i].name)&&(this.__availableColumns.push(this.__selectedColumns[i]),this.__selectedColumns.splice(i,1),i--,ii--);columns.filter(column=>column.columnName.startsWith("params::")).forEach(column=>this.__selectedColumns.push({name:column.columnName,element:this.__createColumnDiv(column.label||column.columnName||"params::")})),this.__availableColumns.sort((a,b)=>this.__columns[a.name].order-this.__columns[b.name].order),this.__selectedColumns.sort((a,b)=>columns.findIndex(column=>column.columnName===a.name)-columns.findIndex(column=>column.columnName===b.name));let availableFragment=document.createDocumentFragment();for(let i=0,ii=this.__availableColumns.length;i<ii;i++)availableFragment.appendChild(this.__availableColumns[i].element);this.__elementAvailableColumns.textContent="",this.__elementAvailableColumns.appendChild(availableFragment);let selectedFragment=document.createDocumentFragment();for(let i=0,ii=this.__selectedColumns.length;i<ii;i++)selectedFragment.appendChild(this.__selectedColumns[i].element);this.__elementSelectedColumns.textContent="",this.__elementSelectedColumns.appendChild(selectedFragment),this.__activateColumn(null)}__activateColumn(element){if(this.__activeElement&&this.__activeElement.classList.remove("active"),element){this.__activeElement=element,element.classList.add("active");let index=this.__selectedColumns.findIndex(item=>item.element===element);this.__activeColumn=this.__settings[index]||null}else this.__activeElement=null,this.__activeColumn=null;this.__updateButtons(),this.__updateColumnProperties()}__updateButtons(){this.__upButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.firstElementChild),this.__downButton.setIsEnabled(null!==this.__activeElement&&this.__activeElement!==this.__elementSelectedColumns.lastElementChild)}__updateColumnProperties(){var _a;let hideParamsProperties=()=>{this.__nameTextbox.setIsEnabled(!1),this.__labelTextbox.setIsEnabled(!1),this.__elementColumnName.classList.add("hidden"),this.__elementColumnLabel.classList.add("hidden")};if(this.__activeColumn){if(this.__widthTextbox.setIsEnabled(!0),this.__widthUnitCombobox.setIsEnabled(!0),void 0!==this.__activeColumn.width&&null!==this.__activeColumn.width?this.__widthTextbox.setText(this.__activeColumn.width.toString(10)):this.__widthTextbox.setText(null),this.__activeColumn.widthUnit){let index=-1,srcData=this.__widthUnitCombobox.getSrcData();Array.isArray(srcData)&&(index=srcData.findIndex(item=>item.value===this.__activeColumn.widthUnit)),this.__widthUnitCombobox.setSelectedIndex(-1!==index?index:null)}else this.__widthUnitCombobox.setSelectedIndex(null);(null===(_a=this.__columns[this.__activeColumn.columnName])||void 0===_a?void 0:_a.allowSortable)?(this.__sortableCheckbox.setIsEnabled(!0),void 0===this.__activeColumn.sortable?this.__sortableCheckbox.setToggleState("Active"):this.__sortableCheckbox.setToggleState(this.__activeColumn.sortable?"Active":"Normal")):(this.__sortableCheckbox.setIsEnabled(!1),this.__sortableCheckbox.setToggleState("Normal")),this.__activeColumn.columnName.startsWith("params::")?(this.__nameTextbox.setIsEnabled(!0),this.__labelTextbox.setIsEnabled(!0),this.__nameTextbox.setText(this.__activeColumn.columnName.slice("params::".length)),this.__labelTextbox.setText(this.__activeColumn.label||null),this.__elementColumnName.classList.remove("hidden"),this.__elementColumnLabel.classList.remove("hidden")):hideParamsProperties()}else this.__widthTextbox.setIsEnabled(!1),this.__widthUnitCombobox.setIsEnabled(!1),this.__sortableCheckbox.setIsEnabled(!1),this.__widthTextbox.setText(null),this.__widthUnitCombobox.setSelectedIndex(null),this.__sortableCheckbox.setToggleState("Normal"),hideParamsProperties()}__createColumnDiv(label,localize=!1){let columnDiv=document.createElement("div");columnDiv.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column"),columnDiv.classList.add("tchmi-event-grid-template-columns-config-column");let labelSpan=document.createElement("span");labelSpan.textContent=label,localize&&this.__parentControl.__addLocalizedElement(labelSpan,label),columnDiv.appendChild(labelSpan);let columnButton=document.createElement("div");return columnButton.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-columns-config-column-selection-toggle"),columnButton.classList.add("tchmi-event-grid-template-columns-config-column-selection-toggle"),columnDiv.appendChild(columnButton),columnDiv}}TcHmiEventGridPopups.ColumnsPopup=ColumnsPopup}(TcHmiEventGridPopups=Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){let TcHmiEventGridPopups;!function(TcHmiEventGridPopups){class FilterPopup extends TcHmiEventGridPopups.SettingsPopup{constructor(element,control){super(element,"filterPopup",control),this.__settings=[],this.__localizableEnums=[],this.__domainPaths=new Map,this.__rows=[],this.__selectedRows=[],this.__groupInfo=null,this.__ungroupInfo=null,this.__onScroll=event=>{this.__elementFilterTableHeader.scrollLeft=this.__elementFilterTable.scrollLeft},this.__onLocaleChangedDestroyer=null,this.__onLocaleChanged=()=>{this.__localizeEnumLabels()},this.__localizeRequestId=null,this.__listDomainsSubscriptionId=null;let elementFilterTableHeader=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table-header")[0];elementFilterTableHeader&&(this.__elementFilterTableHeader=elementFilterTableHeader);let elementIndentationHeader=this.__elementContent.querySelector("th.TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column");elementIndentationHeader&&(this.__elementIndentationHeader=elementIndentationHeader);let elementFilterTable=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table")[0];elementFilterTable&&(this.__elementFilterTable=elementFilterTable);let elementFilterTableBody=this.__elementContent.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-table tbody");elementFilterTableBody&&(this.__elementFilterTableBody=elementFilterTableBody);let elementMenuBar=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-menubar")[0];if(!(elementFilterTableHeader&&elementIndentationHeader&&elementFilterTable&&elementFilterTableBody&&elementMenuBar))throw new Error("Invalid Template.html");elementFilterTable.addEventListener("scroll",this.__onScroll);let addButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.addButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Filter_Add%/l%"},this.__parentControl),removeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.removeButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Filter_Remove%/l%"},this.__parentControl),groupButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.groupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Filter_Group%/l%"},this.__parentControl),ungroupButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.ungroupButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-is-enabled":!1,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Filter_Ungroup%/l%"},this.__parentControl);if(!(addButton&&removeButton&&groupButton&&ungroupButton))throw new Error("Could not create controls for FilterPopup.");removeButton.setIsEnabled(!1),groupButton.setIsEnabled(!1),ungroupButton.setIsEnabled(!1);let addButtonElement=addButton.getElement()[0];addButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-add-button"),addButtonElement.classList.add("tchmi-event-grid-template-add-button"),elementMenuBar.appendChild(addButtonElement);let removeButtonElement=removeButton.getElement()[0];removeButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-remove-button"),removeButtonElement.classList.add("tchmi-event-grid-template-remove-button"),elementMenuBar.appendChild(removeButtonElement);let groupButtonElement=groupButton.getElement()[0];groupButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-group-button"),groupButtonElement.classList.add("tchmi-event-grid-template-group-button"),elementMenuBar.appendChild(groupButtonElement);let ungroupButtonElement=ungroupButton.getElement()[0];ungroupButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-ungroup-button"),ungroupButtonElement.classList.add("tchmi-event-grid-template-ungroup-button"),elementMenuBar.appendChild(ungroupButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(addButton.getId()+".onPressed",()=>{this.__add()})),this.__eventDestroyers.push(TcHmi.EventProvider.register(removeButton.getId()+".onPressed",()=>{this.__remove()})),this.__eventDestroyers.push(TcHmi.EventProvider.register(groupButton.getId()+".onPressed",()=>{this.__group()})),this.__eventDestroyers.push(TcHmi.EventProvider.register(ungroupButton.getId()+".onPressed",()=>{this.__ungroupInfo&&this.__ungroup(this.__ungroupInfo,this.__selectedRows)})),this.__removeButton=removeButton,this.__groupButton=groupButton,this.__ungroupButton=ungroupButton;let parsedSchema=this.__parseSchema(TcHmi.Type.getSchema("tchmi:server#/definitions/eventFilter"));this.__schemaInfo=parsedSchema.schemaInfo,this.__localizableEnums=parsedSchema.localizationInfo;for(const path of parsedSchema.domainPaths){let info=this.__schemaInfo.availablePaths.get(path);info&&this.__domainPaths.set(path,info)}this.__localizeEnumLabels(),this.__subscribeListDomains(),this.__onLocaleChangedDestroyer=TcHmi.EventProvider.register("onLocaleChanged",this.__onLocaleChanged)}update(filter,resetable){super.update(filter,resetable),this.__selectedRows=[];let fragment=document.createDocumentFragment(),indentation=[],maxIndentDepth=0,nesting={filter:this.__settings,parent:null},createRows=(filter,logic,endsPreviousIndentations=0)=>{for(let i=0,ii=filter.length;i<ii;i++){const item=filter[i],isLast=i===ii-1;if(TcHmi.isLogicOperator(item))logic=item;else if(Array.isArray(item)){indentation.push({opens:!0,closes:1===item.length}),maxIndentDepth=Math.max(maxIndentDepth,indentation.length),nesting={filter:item,parent:nesting},isLast?createRows(item,logic,endsPreviousIndentations+1):createRows(item,logic),nesting.parent&&(nesting=nesting.parent)}else if(TcHmi.isComparison(item)){const indentationsToEnd=Math.min(endsPreviousIndentations+1,indentation.length);if(isLast)for(let j=1;j<=indentationsToEnd;j++)indentation[indentation.length-j].closes=!0;if(fragment.appendChild(this.__createRow(indentation,nesting,item,logic)),isLast)indentation=indentation.slice(0,-indentationsToEnd);else for(let j=0,jj=indentation.length;j<jj;j++)indentation[j].opens=!1}}};createRows(this.__settings),this.__elementFilterTableBody.innerHTML="",this.__elementFilterTableBody.appendChild(fragment),this.__elementIndentationHeader.style.minWidth=maxIndentDepth?6*maxIndentDepth+5+"px":"1px",this.__processSelection()}show(){super.show(),this.__subscribeListDomains()}hide(){super.hide(),this.__updateRequired&&this.__clear(),null!==this.__listDomainsSubscriptionId&&(TcHmi.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null)}destroy(){super.destroy(),this.__elementFilterTable.removeEventListener("scroll",this.__onScroll),this.__onLocaleChangedDestroyer&&(this.__onLocaleChangedDestroyer(),this.__onLocaleChangedDestroyer=null),null!==this.__localizeRequestId&&(TcHmi.Server.releaseRequest(this.__localizeRequestId),this.__localizeRequestId=null),null!==this.__listDomainsSubscriptionId&&(TcHmi.Server.unsubscribe(this.__listDomainsSubscriptionId),this.__listDomainsSubscriptionId=null),this.__clear()}__clear(){this.__elementFilterTableBody.innerHTML="";for(let i=0,ii=this.__rows.length;i<ii;i++){let row=this.__rows[i];row.selection.destroyer(),row.selection.control.destroy(),row.logic&&(row.logic.destroyer(),row.logic.control.destroy()),row.path.destroyer&&row.path.destroyer(),row.path.control&&row.path.control.destroy(),row.comparator.destroyer&&row.comparator.destroyer(),row.comparator.control&&row.comparator.control.destroy(),row.value.destroyer&&row.value.destroyer(),row.value.control&&row.value.control.destroy(),row.value.dateTimePickerEventDestroyer&&row.value.dateTimePickerEventDestroyer(),row.value.dateTimePicker&&row.value.dateTimePicker.destroy(),row.value.dateTimeButtonEventDestroyer&&row.value.dateTimeButtonEventDestroyer(),row.value.dateTimeButton&&row.value.dateTimeButton.destroy()}this.__rows=[]}__createRow(indentation,parent,comparison,logic){let row=document.createElement("tr"),selectionCell=document.createElement("td");selectionCell.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-selection-column"),selectionCell.classList.add("tchmi-event-grid-template-filter-selection-column");let selectionCheckbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCheckbox",this.__newControlId(),null,this.__parentControl);if(!selectionCheckbox)throw new Error("Could not create controls for FilterPopup.");let parentClone=this.__cloneNesting(parent),selectionCheckboxEventDestroyer=TcHmi.EventProvider.register(selectionCheckbox.getId()+".onStateChanged",(event,data)=>{let selection={rowElement:row,comparison:comparison,parent:parentClone};data.state?this.__selectRow(selection):this.__deselectRow(selection)});selectionCell.appendChild(selectionCheckbox.getElement()[0]);let indentationCell=document.createElement("td");indentationCell.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column"),indentationCell.classList.add("tchmi-event-grid-template-filter-indentation-column");for(let i=0,ii=indentation.length;i<ii;i++){let indentationMarker=document.createElement("div");indentationMarker.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),indentationMarker.classList.add("tchmi-event-grid-template-filter-indentation-marker"),indentationMarker.classList.toggle("first",indentation[i].opens),indentationMarker.classList.toggle("last",indentation[i].closes),indentationMarker.classList.toggle("middle",!indentation[i].opens&&!indentation[i].closes),indentationCell.appendChild(indentationMarker)}let logicCell=document.createElement("td");logicCell.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-logic-column"),logicCell.classList.add("tchmi-event-grid-template-filter-logic-column");let pathCell=document.createElement("td");pathCell.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-path-column"),pathCell.classList.add("tchmi-event-grid-template-filter-path-column");let comparatorCell=document.createElement("td");comparatorCell.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-comparator-column"),comparatorCell.classList.add("tchmi-event-grid-template-filter-comparator-column");let valueCell=document.createElement("td");valueCell.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-value-column"),valueCell.classList.add("tchmi-event-grid-template-filter-value-column");let rowData={row:row,comparison:comparison,parent:parentClone,selection:{control:selectionCheckbox,destroyer:selectionCheckboxEventDestroyer},path:{control:null,destroyer:null},comparator:{cell:comparatorCell,control:null,destroyer:null},value:{cell:valueCell,control:null,destroyer:null,dateTimePicker:null,dateTimePickerEventDestroyer:null,dateTimeButton:null,dateTimeButtonEventDestroyer:null}};if(logic){rowData.logicOperator=logic;let logicLocalizationMap={AND:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_And%/l%",OR:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_Or%/l%"},logicCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":this.__schemaInfo.availableLogic.map(value=>{var _a;return{value:value,text:null!==(_a=logicLocalizationMap[value])&&void 0!==_a?_a:value}}),"data-tchmi-selected-index":this.__schemaInfo.availableLogic.indexOf(logic.logic),"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!logicCombobox)throw new Error("Could not create controls for FilterPopup.");rowData.logic={control:logicCombobox,destroyer:TcHmi.EventProvider.register(logicCombobox.getId()+".onSelectionChanged",(event,data)=>{logic.logic=data.value})},logicCell.appendChild(logicCombobox.getElement()[0])}let availablePathNames=Array.from(this.__schemaInfo.availablePaths.keys());if(availablePathNames.length>0){let pathCombobox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-src-data":availablePathNames,"data-tchmi-allow-text-input":null!==this.__schemaInfo.freePath,"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":500},this.__parentControl);if(!pathCombobox)throw new Error("Could not create controls for FilterPopup.");rowData.path.control=pathCombobox;let selectedIndex=availablePathNames.indexOf(comparison.path||"");-1!==availablePathNames.indexOf(comparison.path||"")?pathCombobox.setSelectedIndex(selectedIndex):pathCombobox.setText(comparison.path),rowData.path.destroyer=TcHmi.EventProvider.register(pathCombobox.getId()+".onUserInteractionFinished",()=>{let path=pathCombobox.getText();comparison.path!==path&&(null==path||""===path?delete comparison.path:comparison.path=path.toString(),comparison.value="",this.__updateControls(rowData))}),pathCell.appendChild(pathCombobox.getElement()[0])}else{let pathTextbox=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiTextbox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl);if(!pathTextbox)throw new Error("Could not create controls for FilterPopup.");rowData.path.control=pathTextbox,rowData.path.destroyer=TcHmi.EventProvider.register(pathTextbox.getId()+".onUserInteractionFinished",()=>{let path=pathTextbox.getText();null==path||""===path?delete comparison.path:comparison.path=path}),pathCell.appendChild(pathTextbox.getElement()[0])}return this.__updateControls(rowData),row.appendChild(selectionCell),row.appendChild(indentationCell),row.appendChild(logicCell),row.appendChild(pathCell),row.appendChild(comparatorCell),row.appendChild(valueCell),this.__rows.push(rowData),row}__updateControls(row){var _a,_b,_c;let pathInfo=this.__getPathInfo(row.comparison.path);if(row.path.control instanceof Beckhoff.TcHmiCombobox&&((null==pathInfo?void 0:pathInfo.isSuggestion)?(row.path.control.setAllowTextInput(!0),null===(_a=row.path.control.getElement()[0].getElementsByTagName("input")[0])||void 0===_a||_a.focus()):row.path.control.setAllowTextInput(!1)),!row.comparator.control){if(row.comparator.control=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiCombobox",this.__newControlId(),{"data-tchmi-content-padding":{left:3,right:3},"data-tchmi-max-list-height":250},this.__parentControl)||null,!row.comparator.control)throw new Error("Could not create controls for FilterPopup.");row.comparator.destroyer=TcHmi.EventProvider.register(row.comparator.control.getId()+".onUserInteractionFinished",()=>{let comparator=row.comparator.control.getAllowTextInput()?row.comparator.control.getText():row.comparator.control.getSelectedValue();"string"==typeof comparator&&""!==comparator&&(row.comparison.comparator=comparator)}),row.comparator.cell.appendChild(row.comparator.control.getElement()[0])}let comparatorControl=row.comparator.control;if(pathInfo){let comparatorLocalizationMap={contains:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_Contains%/l%","contains not":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_ContainsNot%/l%","== [ignore case]":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_EqualsIgnoreCase%/l%","!= [ignore case]":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_EqualsNotIgnoreCase%/l%","contains [ignore case]":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_ContainsIgnoreCase%/l%","contains not [ignore case]":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Combobox_Entry_ContainsNotIgnoreCase%/l%"};comparatorControl.setAllowTextInput(!1),comparatorControl.setSrcData(pathInfo.comparators.map(comparator=>{var _a;return{value:comparator,text:null!==(_a=comparatorLocalizationMap[comparator])&&void 0!==_a?_a:comparator}})),comparatorControl.setSelectedIndex(pathInfo.comparators.indexOf(row.comparison.comparator))}else comparatorControl.setAllowTextInput(!0);let valueControlType="TcHmi.Controls.Beckhoff.TcHmiTextbox";pathInfo&&pathInfo.values.length>0&&(valueControlType="TcHmi.Controls.Beckhoff.TcHmiCombobox"),row.value.control&&row.value.control.getType()!==valueControlType&&(row.value.destroyer&&(row.value.destroyer(),row.value.destroyer=null),row.value.cell.removeChild(row.value.control.getElement()[0]),row.value.control.destroy(),row.value.control=null);let eventRegistrationNeeded=!1;if(!row.value.control){if(row.value.control=TcHmi.ControlFactory.createEx(valueControlType,this.__newControlId(),"TcHmi.Controls.Beckhoff.TcHmiCombobox"===valueControlType?{"data-tchmi-max-list-height":250}:{"data-tchmi-content-padding":{left:3,right:3}},this.__parentControl)||null,!row.value.control)throw new Error("Could not create controls for FilterPopup.");eventRegistrationNeeded=!0,row.value.cell.appendChild(row.value.control.getElement()[0])}switch(valueControlType){case"TcHmi.Controls.Beckhoff.TcHmiTextbox":let text,textbox=row.value.control;text=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),textbox.setText(text),eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(textbox.getId()+".onUserInteractionFinished",()=>{let value=textbox.getText();if(null==value)return;let pathInfo=this.__getPathInfo(row.comparison.path);if((null==pathInfo?void 0:pathInfo.nullable)&&"null"===value.toLowerCase())row.comparison.value=null;else{switch(pathInfo?pathInfo.valueType:"any"){case"string":row.comparison.value=TcHmi.ValueConverter.toString(value,"");break;case"number":case"integer":row.comparison.value=TcHmi.ValueConverter.toNumber(value,0);break;case"boolean":row.comparison.value=TcHmi.ValueConverter.toBoolean(value,!1);break;default:row.comparison.value=value}}row.value.dateTimePicker&&row.value.dateTimePicker.setValue(value)}));break;case"TcHmi.Controls.Beckhoff.TcHmiCombobox":let combobox=row.value.control;if(!pathInfo)break;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value:value,text:null!==(_c=null!==(_b=pathInfo.localizedLabels.get(value))&&void 0!==_b?_b:pathInfo.labels.get(value))&&void 0!==_c?_c:value})}if(combobox.setSrcData(srcData),combobox.setAllowTextInput(pathInfo.allowFreeValue),combobox.setSelectedIndex(pathInfo.values.indexOf(row.comparison.value)),pathInfo.allowFreeValue&&-1===pathInfo.values.indexOf(row.comparison.value)){let text;text=row.comparison.value instanceof Date?row.comparison.value.toISOString():null===row.comparison.value?"null":row.comparison.value.toString(),combobox.setText(text)}eventRegistrationNeeded&&(row.value.destroyer=TcHmi.EventProvider.register(combobox.getId()+".onUserInteractionFinished",()=>{let value=combobox.getSelectedValue(),pathInfo=this.__getPathInfo(row.comparison.path);if(null==value&&pathInfo.allowFreeValue&&(value=combobox.getText()),null!=value)if((null==pathInfo?void 0:pathInfo.nullable)&&"null"===value.toLowerCase())row.comparison.value=null;else{switch(pathInfo?pathInfo.valueType:"any"){case"string":row.comparison.value=TcHmi.ValueConverter.toString(value,"");break;case"number":case"integer":row.comparison.value=TcHmi.ValueConverter.toNumber(value,0);break;case"boolean":row.comparison.value=TcHmi.ValueConverter.toBoolean(value,!1);break;default:row.comparison.value=value}}}))}if(pathInfo&&pathInfo.valueIsDate){if(!row.value.dateTimePicker){if(row.value.dateTimePicker=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDateTimePicker",this.__newControlId(),{"data-tchmi-visibility":"Collapsed"},this.__parentControl)||null,!row.value.dateTimePicker)throw new Error("Could not create controls for FilterPopup.");row.value.dateTimePickerEventDestroyer=TcHmi.EventProvider.register(row.value.dateTimePicker.getId()+".onValueChanged",()=>{let value=row.value.dateTimePicker.getValue();if(!value)return;row.value.control&&row.value.control.setText(value);let pathInfo=this.__getPathInfo(row.comparison.path);(null==pathInfo?void 0:pathInfo.nullable)&&"null"===value.toLowerCase()?row.comparison.value=null:row.comparison.value=value}),row.value.cell.appendChild(row.value.dateTimePicker.getElement()[0])}if(row.value.dateTimePicker.setValue("string"==typeof row.comparison.value?row.comparison.value:null),!row.value.dateTimeButton){if(row.value.dateTimeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",this.__newControlId(),{"data-tchmi-width":26,"data-tchmi-height":30},this.__parentControl)||null,!row.value.dateTimeButton)throw new Error("Could not create controls for FilterPopup.");row.value.dateTimeButtonEventDestroyer=TcHmi.EventProvider.register(row.value.dateTimeButton.getId()+".onPressed",()=>{row.value.dateTimePicker&&row.value.dateTimePicker.openDateTimePicker()});let element=row.value.dateTimeButton.getElement()[0];element.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-date-time-button"),element.classList.add("tchmi-event-grid-template-date-time-button"),row.value.cell.appendChild(element)}}else row.value.dateTimePickerEventDestroyer&&(row.value.dateTimePickerEventDestroyer(),row.value.dateTimePickerEventDestroyer=null),row.value.dateTimePicker&&(row.value.cell.removeChild(row.value.dateTimePicker.getElement()[0]),row.value.dateTimePicker.destroy(),row.value.dateTimePicker=null),row.value.dateTimeButtonEventDestroyer&&(row.value.dateTimeButtonEventDestroyer(),row.value.dateTimeButtonEventDestroyer=null),row.value.dateTimeButton&&(row.value.cell.removeChild(row.value.dateTimeButton.getElement()[0]),row.value.dateTimeButton.destroy(),row.value.dateTimeButton=null)}__getPathInfo(path=""){let pathInfo=this.__schemaInfo.availablePaths.get(path);if(!pathInfo)for(const[key,value]of this.__schemaInfo.availablePaths)if(value.isSuggestion&&path.startsWith(key)){pathInfo=value;break}return!pathInfo&&this.__schemaInfo.freePath&&(pathInfo=this.__schemaInfo.freePath),null!=pathInfo?pathInfo:null}__selectRow(row){this.__selectedRows.push(row),this.__processSelection()}__deselectRow(row){for(let i=0,ii=this.__selectedRows.length;i<ii;i++)if(this.__selectedRows[i].comparison===row.comparison){this.__selectedRows.splice(i,1);break}this.__processSelection()}__add(){let[path,pathInfo]=this.__schemaInfo.freePath?["",this.__schemaInfo.freePath]:this.__schemaInfo.availablePaths.entries().next().value,logic={logic:this.__schemaInfo.availableLogic[0]},comparison={path:path,comparator:pathInfo.comparators[0],value:pathInfo.allowFreeValue?"":pathInfo.values[0]};if(this.__selectedRows.length>0){this.__selectedRows.sort((a,b)=>b.rowElement.rowIndex-a.rowElement.rowIndex);let lastRow=this.__selectedRows[0];lastRow.parent.filter.splice(lastRow.parent.filter.indexOf(lastRow.comparison)+1,0,logic,comparison);let indentation=[],indentationElements=lastRow.rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker");for(let i=0,ii=indentationElements.length;i<ii;i++)indentationElements[i].classList.contains("last")?(indentationElements[i].classList.remove("last"),indentationElements[i].classList.add("middle"),indentation.push({opens:!1,closes:!0})):indentation.push({opens:!1,closes:!1});lastRow.rowElement.insertAdjacentElement("afterend",this.__createRow(indentation,lastRow.parent,comparison,logic))}else this.__elementFilterTableBody.appendChild(this.__createRow([],{filter:this.__settings,parent:null},comparison,this.__settings.length>0?logic:void 0)),this.__settings.length>0&&this.__settings.push(logic),this.__settings.push(comparison);this.__processSelection()}__remove(){for(const selectedRow of this.__selectedRows){let index=selectedRow.parent.filter.indexOf(selectedRow.comparison);if(-1===index)continue;let indentationElements=selectedRow.rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),siblingIndentation=null;for(let i=0,ii=indentationElements.length;i<ii;i++){const containsFirst=indentationElements[i].classList.contains("first"),containsLast=indentationElements[i].classList.contains("last");if(containsFirst&&!containsLast){if(!siblingIndentation){const siblingRow=selectedRow.rowElement.nextElementSibling;if(!siblingRow)break;siblingIndentation=siblingRow.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker")}siblingIndentation[i].classList.remove("middle"),siblingIndentation[i].classList.add("first")}else if(containsLast&&!containsFirst){if(!siblingIndentation){const siblingRow=selectedRow.rowElement.previousElementSibling;if(!siblingRow)break;siblingIndentation=siblingRow.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker")}siblingIndentation[i].classList.remove("middle"),siblingIndentation[i].classList.add("last")}}const rowDataIndex=this.__rows.findIndex(rowData=>rowData.row===selectedRow.rowElement);if(-1!==rowDataIndex){const rowData=this.__rows[rowDataIndex];rowData.selection.destroyer(),rowData.selection.control.destroy(),rowData.logic&&(rowData.logic.destroyer(),rowData.logic.control.destroy()),rowData.path.destroyer&&rowData.path.destroyer(),rowData.path.control&&rowData.path.control.destroy(),rowData.comparator.destroyer&&rowData.comparator.destroyer(),rowData.comparator.control&&rowData.comparator.control.destroy(),rowData.value.destroyer&&rowData.value.destroyer(),rowData.value.control&&rowData.value.control.destroy(),rowData.value.dateTimePickerEventDestroyer&&rowData.value.dateTimePickerEventDestroyer(),rowData.value.dateTimePicker&&rowData.value.dateTimePicker.destroy(),rowData.value.dateTimeButtonEventDestroyer&&rowData.value.dateTimeButtonEventDestroyer(),rowData.value.dateTimeButton&&rowData.value.dateTimeButton.destroy(),this.__rows.splice(rowDataIndex,1)}if(this.__elementFilterTableBody.removeChild(selectedRow.rowElement),selectedRow.parent.filter.splice(index,1),index>0)selectedRow.parent.filter.splice(index-1,1);else{let parent=selectedRow.parent,parentIndex=0;for(;parent.parent&&0!==parentIndex;){if(parentIndex=parent.parent.filter.indexOf(parent.filter),-1===parentIndex)throw new Error("Filter in invalid state. Parent filter does not contain child filter.");parent=parent.parent}if(0===parentIndex){selectedRow.parent.filter.length>0&&selectedRow.parent.filter.splice(0,1);let firstRow=this.__elementFilterTableBody.firstElementChild;if(firstRow){for(let j=0,jj=this.__rows.length;j<jj;j++)if(this.__rows[j].row===selectedRow.rowElement){this.__rows[j].logic&&(this.__rows[j].logic.destroyer(),this.__rows[j].logic.control.destroy(),delete this.__rows[j].logic);break}let comboboxElement=firstRow.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-logic-column .TcHmi_Controls_Beckhoff_TcHmiCombobox");comboboxElement&&comboboxElement.remove()}}else parent.filter.splice(parentIndex-1,1,selectedRow.parent.filter.splice(0,1)[0])}if(1===selectedRow.parent.filter.length&&selectedRow.parent.parent){let ungroupRows=[];for(let j=0,jj=this.__rows.length;j<jj;j++){let parent=this.__rows[j].parent;for(;parent&&parent.filter!==selectedRow.parent.filter;)parent=parent.parent;parent&&ungroupRows.push({rowElement:this.__rows[j].row,comparison:this.__rows[j].comparison,parent:this.__rows[j].parent})}ungroupRows.length>0&&this.__ungroup({parent:selectedRow.parent.parent,toUngroup:selectedRow.parent},ungroupRows)}}this.__selectedRows=[],this.__processSelection()}__group(){if(!this.__groupInfo)return;let start=this.__groupInfo.parent.filter.length,end=-1;for(let i=0,ii=this.__groupInfo.toGroup.length;i<ii;i++){let index=this.__groupInfo.parent.filter.indexOf(this.__groupInfo.toGroup[i]);if(-1===index)return;start=index<start?index:start,end=index>end?index:end}let newNested=this.__groupInfo.parent.filter.splice(start,end-start+1);this.__groupInfo.parent.filter.splice(start,0,newNested),this.__selectedRows.sort((a,b)=>a.rowElement.rowIndex-b.rowElement.rowIndex);let newParent={filter:this.__groupInfo.parent.filter,parent:this.__groupInfo.parent.parent},groupInfoParentFilter=this.__groupInfo.parent.filter;for(let i=0,ii=this.__selectedRows.length;i<ii;i++){let parentToModify=this.__selectedRows[i].parent,indentationMarkerPosition=0;for(;parentToModify.parent&&parentToModify.filter!==groupInfoParentFilter;)parentToModify=parentToModify.parent,indentationMarkerPosition++;parentToModify.filter=newNested,parentToModify.parent=this.__cloneNesting(newParent);let indentationCell=this.__selectedRows[i].rowElement.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column")[0];if(indentationCell){let elementToAdd=document.createElement("div");elementToAdd.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker"),elementToAdd.classList.add("tchmi-event-grid-template-filter-indentation-marker"),0===i?elementToAdd.classList.add("first"):i+1===ii?elementToAdd.classList.add("last"):elementToAdd.classList.add("middle"),indentationCell.insertBefore(elementToAdd,indentationCell.childNodes[indentationCell.childElementCount-indentationMarkerPosition]||null)}}this.__processSelection(),this.__resizeIndentationHeader()}__ungroup(ungroupInfo,rows){let index=ungroupInfo.parent.filter.indexOf(ungroupInfo.toUngroup.filter);if(-1!==index){ungroupInfo.parent.filter.splice(index,1,...ungroupInfo.toUngroup.filter),rows.sort((a,b)=>a.rowElement.rowIndex-b.rowElement.rowIndex);for(let i=0,ii=rows.length;i<ii;i++){let elementToRemove,parentToModify=rows[i].parent;for(;parentToModify.parent&&parentToModify.parent.filter!==ungroupInfo.parent.filter;)parentToModify=parentToModify.parent;parentToModify.filter=ungroupInfo.parent.filter,parentToModify.parent=ungroupInfo.parent.parent?this.__cloneNesting(ungroupInfo.parent.parent):null,elementToRemove=0===i?rows[i].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.first"):i+1===ii?rows[i].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.last"):rows[i].rowElement.querySelector(".TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-marker.middle"),elementToRemove&&elementToRemove.parentElement.removeChild(elementToRemove)}this.__processSelection(),this.__resizeIndentationHeader()}}__processSelection(){if(this.__removeButton.setIsEnabled(this.__selectedRows.length>0),this.__groupInfo=null,this.__ungroupInfo=null,this.__selectedRows.length<2)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let selectedParents=new TcHmi.List,continuityTest=[];for(let i=0,ii=this.__selectedRows.length;i<ii;i++){let row=this.__selectedRows[i];continuityTest[row.rowElement.rowIndex]=!0;let selectedParent=selectedParents.firstOrDefault(sp=>sp.nesting.filter===row.parent.filter);for(selectedParent||(selectedParent={nesting:row.parent,itemCount:Math.ceil(row.parent.filter.length/2),selectedItems:[]},selectedParents.push(selectedParent)),selectedParent.selectedItems.push(row.comparison);selectedParent.selectedItems.length>=selectedParent.itemCount&&(i+1<ii||selectedParents.length>1);){if(!selectedParent.nesting.parent)return this.__groupButton.setIsEnabled(!1),void this.__ungroupButton.setIsEnabled(!1);let grandparent=selectedParents.firstOrDefault(sp=>sp.nesting.filter===selectedParent.nesting.parent.filter);grandparent||(grandparent={nesting:selectedParent.nesting.parent,itemCount:Math.ceil(selectedParent.nesting.parent.filter.length/2),selectedItems:[]},selectedParents.push(grandparent)),grandparent.selectedItems.push(selectedParent.nesting.filter),selectedParents.splice(selectedParents.indexOf(selectedParent),1),selectedParent=grandparent}}if(1===selectedParents.length){let groupingBase=selectedParents[0],isContinuous=!0;for(let i=continuityTest.indexOf(!0),ii=continuityTest.length;i<ii;i++)if(!continuityTest[i]){isContinuous=!1;break}groupingBase.selectedItems.length<groupingBase.itemCount&&isContinuous?this.__groupInfo={parent:groupingBase.nesting,toGroup:groupingBase.selectedItems}:groupingBase.selectedItems.length===groupingBase.itemCount&&groupingBase.nesting.parent&&(this.__ungroupInfo={parent:groupingBase.nesting.parent,toUngroup:groupingBase.nesting})}this.__groupButton.setIsEnabled(null!==this.__groupInfo),this.__ungroupButton.setIsEnabled(null!==this.__ungroupInfo)}__resizeIndentationHeader(){let indentationCell=this.__elementFilterTableBody.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-filter-indentation-column")[0];this.__elementIndentationHeader.style.minWidth=(indentationCell?indentationCell.offsetWidth:0)+"px"}__newControlId(){return`${this.__parentControl.getId()}.${this.__name}.${tchmi_create_guid()}`}__cloneNesting(nesting){return{filter:nesting.filter,parent:nesting.parent?this.__cloneNesting(nesting.parent):null}}__parseSchema(schema){var _a,_b;if(schema&&"array"===schema.type&&schema.items){let items=null;if(Array.isArray(schema.items)?items=schema.items:"object"===schema.items.type?items=[schema.items]:schema.items.anyOf?items=schema.items.anyOf:schema.items.oneOf&&(items=schema.items.oneOf),items){let info={availablePaths:new Map,freePath:null,availableLogic:[]},localizables=[],domainPaths=[];for(let i=0,ii=items.length;i<ii;i++){let item=items[i];if("object"===item.type&&item.properties&&item.properties.logic&&item.properties.logic.enum){for(let j=0,jj=item.properties.logic.enum.length;j<jj;j++)-1===info.availableLogic.indexOf(item.properties.logic.enum[j])&&info.availableLogic.push(item.properties.logic.enum[j]);continue}if(!("object"===item.type&&item.properties&&item.properties.comparator&&item.properties.comparator.enum&&item.properties.value))continue;let pathValues=null,isSuggestion=!1;if(item.properties.path){if(item.properties.path.enum)pathValues=item.properties.path.enum;else if(item.properties.path.pattern){let pattern=item.properties.path.pattern;if(pattern.startsWith("^")){let escaped=pattern.substring(1).replace(/\\(.)/g,"$1");new RegExp(pattern).test(escaped)&&(pathValues=[escaped],isSuggestion=!0)}}}else pathValues=[""];let pathInfos=[];if(pathValues)for(let j=0,jj=pathValues.length;j<jj;j++)info.availablePaths.has(pathValues[j])||info.availablePaths.set(pathValues[j],{comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:isSuggestion}),pathInfos.push(info.availablePaths.get(pathValues[j]));else info.freePath||(info.freePath={comparators:[],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!1,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1}),pathInfos.push(info.freePath);for(let j=0,jj=pathInfos.length;j<jj;j++){for(let k=0,kk=item.properties.comparator.enum.length;k<kk;k++)-1===pathInfos[j].comparators.indexOf(item.properties.comparator.enum[k])&&pathInfos[j].comparators.push(item.properties.comparator.enum[k]);let valueItems=null!==(_b=null!==(_a=item.properties.value.oneOf)&&void 0!==_a?_a:item.properties.value.anyOf)&&void 0!==_b?_b:[item.properties.value],typeFound=!1;valueItems.forEach(valueItem=>{if("string"===valueItem.type||"number"===valueItem.type||"integer"===valueItem.type||"boolean"===valueItem.type?typeFound?pathInfos[j].valueType="any":(pathInfos[j].valueType=valueItem.type,typeFound=!0):"null"===valueItem.type&&(pathInfos[j].nullable=!0),valueItem.enum)for(let k=0,kk=valueItem.enum.length;k<kk;k++)pathInfos[j].values.includes(valueItem.enum[k])||pathInfos[j].values.push(valueItem.enum[k]);else pathValues&&pathValues[j].toLowerCase().includes("domain")?(pathInfos[j].values=[""],pathInfos[j].allowFreeValue=!0,domainPaths.push(pathValues[j])):pathInfos[j].allowFreeValue=!0;if(valueItem.options){let options=valueItem.options;for(let k=0,kk=options.length;k<kk;k++)pathInfos[j].labels.set(options[k].value,options[k].label);localizables.includes(pathInfos[j])||localizables.push(pathInfos[j])}"date-time"===valueItem.format&&(pathInfos[j].valueIsDate=!0)})}}return{schemaInfo:info,localizationInfo:localizables,domainPaths:domainPaths}}}return{schemaInfo:{availablePaths:new Map,freePath:{comparators:["==","!=","<",">","<=",">=","contains","contains not","== [ignore case]","!= [ignore case]","contains [ignore case]","contains not [ignore case]"],values:[],labels:new Map,localizedLabels:new Map,allowFreeValue:!0,valueIsDate:!1,valueType:"any",nullable:!1,isSuggestion:!1},availableLogic:["AND","OR"]},localizationInfo:[],domainPaths:[]}}__localizeEnumLabels(){if(0===this.__localizableEnums.length)return;let request={requestType:"ReadWrite",commands:[]},map={};for(let i=0,ii=this.__localizableEnums.length;i<ii;i++)for(const[key,label]of this.__localizableEnums[i].labels)map[label]={pathInfo:this.__localizableEnums[i],key:key},request.commands.push({symbol:"LocalizeText",writeValue:{domain:"TcHmiSrv",name:label},commandOptions:["SendWriteValue","SendErrorMessage"]});this.__localizeRequestId=TcHmi.Server.requestEx(request,null,data=>{var _a,_b;if(this.__localizeRequestId=null,data.error===TcHmi.Errors.NONE)if(data.response)if(data.response.error)TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.response.error)}`);else if(data.response.commands&&0!==data.response.commands.length){for(let i=0,ii=data.response.commands.length;i<ii;i++){if(data.response.commands[i].error){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.response.commands[i].error)}`);continue}if(!data.response.commands[i].readValue){TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${data.response.commands[i].symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__parentControl.getType()}));continue}let writeValue=data.response.commands[i].writeValue;"object"==typeof writeValue&&writeValue.name&&map[writeValue.name]&&map[writeValue.name].pathInfo.localizedLabels.set(map[writeValue.name].key,data.response.commands[i].readValue)}for(let i=0,ii=this.__rows.length;i<ii;i++){let combobox=this.__rows[i].value.control;if(combobox instanceof Beckhoff.TcHmiCombobox){let pathInfo=this.__getPathInfo(this.__rows[i].comparison.path);if(!pathInfo||0===pathInfo.localizedLabels.size)continue;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value:value,text:null!==(_b=null!==(_a=pathInfo.localizedLabels.get(value))&&void 0!==_a?_a:pathInfo.labels.get(value))&&void 0!==_b?_b:value})}let selectedIndex=combobox.getSelectedIndex();combobox.setSrcData(srcData),combobox.setSelectedIndex(void 0===selectedIndex?null:selectedIndex)}}}else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__parentControl.getType()}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__parentControl.getType()}));else TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%LocalizeText%/s%] ${TcHmi.Log.buildMessage(data.details)}`)})}__subscribeListDomains(){0!==this.__domainPaths.size&&null===this.__listDomainsSubscriptionId&&(this.__listDomainsSubscriptionId=TcHmi.Server.subscribeEx([{symbol:"ListDomains"}],1e3,null,data=>{if(data.error!==TcHmi.Errors.NONE)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.details)}`));if(!data.response)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_RESPONSE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_RESPONSE_MISSING],reason:"Missing response from server.",domain:this.__parentControl.getType()})));if(data.response.error)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.response.error)}`));if(!data.response.commands||0===data.response.commands.length)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_COMMANDS_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_COMMANDS_MISSING],reason:`Missing commands in response from server with id: '${data.response.id}'.`,domain:this.__parentControl.getType()})));if(data.response.commands[0].error)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] ${TcHmi.Log.buildMessage(data.response.commands[0].error)}`));if(!data.response.commands[0].readValue)return void(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error(`[Source=Control, Module=${this.__parentControl.getType()}, Id=${this.__parentControl.getId()}, Symbol=%s%ListDomains%/s%] `+TcHmi.Log.buildMessage({code:TcHmi.Errors.E_SERVER_READVALUE_MISSING,message:TcHmi.Errors[TcHmi.Errors.E_SERVER_READVALUE_MISSING],reason:`Missing readValue for symbol '${data.response.commands[0].symbol}' in response from server with id: '${data.response.id}'.`,domain:this.__parentControl.getType()})));let domains=Object.keys(data.response.commands[0].readValue);for(const pathInfo of this.__domainPaths.values())pathInfo.values=domains;this.__rows.filter(row=>row.comparison.path&&this.__domainPaths.has(row.comparison.path)).forEach(row=>{var _a,_b,_c;let combobox=row.value.control;if(combobox instanceof Beckhoff.TcHmiCombobox){let pathInfo=this.__getPathInfo(row.comparison.path);if(!pathInfo)return;let srcData=[];for(let i=0,ii=pathInfo.values.length;i<ii;i++){let value=pathInfo.values[i];srcData.push({value:value,text:null!==(_b=null!==(_a=pathInfo.localizedLabels.get(value))&&void 0!==_a?_a:pathInfo.labels.get(value))&&void 0!==_b?_b:value})}let selectedValue=null!==(_c=combobox.getSelectedValue())&&void 0!==_c?_c:combobox.getText(),selectedIndex=srcData.findIndex(item=>item.value===selectedValue);combobox.setSrcData(srcData),-1!==selectedIndex?(combobox.getAllowTextInput()&&combobox.setText(null),combobox.setSelectedIndex(selectedIndex)):(combobox.setSelectedIndex(null),combobox.getAllowTextInput()&&combobox.setText(selectedValue))}})}))}}TcHmiEventGridPopups.FilterPopup=FilterPopup}(TcHmiEventGridPopups=Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){let TcHmiEventGridPopups;!function(TcHmiEventGridPopups){class DetailsPopup extends TcHmiEventGridPopups.Popup{constructor(element,control){super(element,"detailsPopup",control),this.__event=null,this.__localizedElements=[];let confirmButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.confirmButton`,{"data-tchmi-width":30,"data-tchmi-height":30,"data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Details_Confirm%/l%"},this.__parentControl),closeButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.closeButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Details_Close%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_Details_Close%/l%"},this.__parentControl);if(!confirmButton||!closeButton)throw new Error("Could not create controls for DetailsPopup.");this.__confirmButton=confirmButton;let confirmButtonElement=this.__confirmButton.getElement()[0];confirmButtonElement.classList.add("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-button"),confirmButtonElement.classList.add("tchmi-event-grid-template-confirm-button"),this.__elementFooter.appendChild(confirmButtonElement),this.__eventDestroyers.push(TcHmi.EventProvider.register(this.__confirmButton.getId()+".onPressed",()=>{this.__event&&TcHmi.Server.Events.isAlarm(this.__event)&&TcHmi.Server.Events.confirmAlarm(this.__event,data=>{data.error!==TcHmi.Errors.NONE&&(TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.__parentControl.getId()+"] Unable to confirm alarm with id "+this.__event.id+" in domain "+this.__event.domain+": "+TcHmi.Log.buildMessage(data.details)),"object"==typeof data.details&&null!==data.details&&data.details.code===TcHmi.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__parentControl.__setCanConfirm(!1))})})),this.__elementFooter.appendChild(closeButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(closeButton.getId()+".onPressed",()=>this.hide())),this.__setCanConfirm(this.__parentControl.__getCanConfirm())}destroy(){super.destroy();for(const element of this.__localizedElements)this.__parentControl.__removeLocalizedElement(element)}update(event){this.__event=event;let fragment=document.createDocumentFragment(),dl=document.createElement("dl");fragment.appendChild(dl);for(const element of this.__localizedElements)this.__parentControl.__removeLocalizedElement(element);let localize=(element,key)=>{this.__parentControl.__addLocalizedElement(element,key),this.__localizedElements.push(element)},appendDefinitionItem=(dtContentLocalizationKey,ddContent,localizeDdContent=!1)=>{let dt=document.createElement("dt");dt.textContent=dtContentLocalizationKey,localize(dt,dtContentLocalizationKey),dl.appendChild(dt);let dd=document.createElement("dd");dd.textContent=ddContent?tchmi_decode_control_characters(ddContent):"-",ddContent&&localizeDdContent&&localize(dd,ddContent),dl.appendChild(dd)},createObjectDetails=data=>{let dl=document.createElement("dl");for(let key in data)if(data.hasOwnProperty(key)){let dt=document.createElement("dt");dl.appendChild(dt),dt.textContent=key.slice(0,1).toUpperCase()+key.slice(1).replace(/([A-Z]+)/g," $1");let dd=document.createElement("dd");dl.appendChild(dd);let value=data[key];if(null==value||""===value)dd.textContent="-";else if(value instanceof Date)dd.textContent=TcHmi.Localization.formatDate(value);else if("object"==typeof value)dd.appendChild(createObjectDetails(value));else if("string"==typeof value){let parsedJson=null;try{parsedJson=JSON.parse(value)}catch(ex){}parsedJson&&"object"==typeof parsedJson?dd.appendChild(createObjectDetails(parsedJson)):dd.textContent=tchmi_decode_control_characters(value)}else dd.textContent=value}return dl};appendDefinitionItem("Column_Header_Domain",event.domain),event.type!==TcHmi.Server.Events.Type.Payload&&(appendDefinitionItem("Column_Header_SourceDomain",event.sourceDomain),appendDefinitionItem("Column_Header_Text",event.text)),appendDefinitionItem("Column_Header_Name",event.name);let type="";switch(event.type){case TcHmi.Server.Events.Type.Message:type="Label_Text_Message";break;case TcHmi.Server.Events.Type.Alarm:type="Label_Text_Alarm";break;case TcHmi.Server.Events.Type.Payload:type="Label_Text_Payload"}if(appendDefinitionItem("Column_Header_Type",type,!0),event.type!==TcHmi.Server.Events.Type.Payload){let severity="";switch(event.severity){case TcHmi.Server.Events.Severity.Verbose:severity="Label_Text_Verbose";break;case TcHmi.Server.Events.Severity.Info:severity="Label_Text_Info";break;case TcHmi.Server.Events.Severity.Warning:severity="Label_Text_Warning";break;case TcHmi.Server.Events.Severity.Error:severity="Label_Text_Error";break;case TcHmi.Server.Events.Severity.Critical:severity="Label_Text_Critical"}if(appendDefinitionItem("Column_Header_Severity",severity,!0),event.type===TcHmi.Server.Events.Type.Alarm){let alarmState="";switch(event.alarmState){case TcHmi.Server.Events.AlarmState.Raised:alarmState="Label_Text_Raised";break;case TcHmi.Server.Events.AlarmState.Confirmed:alarmState="Label_Text_Confirmed";break;case TcHmi.Server.Events.AlarmState.Cleared:alarmState="Label_Text_Cleared";break;case TcHmi.Server.Events.AlarmState.ClearedAndConfirmed:alarmState="Label_Text_Cleared_And_Confirmed";break;case TcHmi.Server.Events.AlarmState.Invalid:alarmState="Label_Text_Invalid"}event.confirmationState!==TcHmi.Server.Events.ConfirmationState.NotRequired&&event.confirmationState!==TcHmi.Server.Events.ConfirmationState.NotSupported||(alarmState+="_NoConfirmation"),appendDefinitionItem("Column_Header_AlarmState",alarmState,!0)}appendDefinitionItem("Column_Header_Raised",TcHmi.Localization.formatDate(event.timeRaised)),event.type===TcHmi.Server.Events.Type.Alarm?(void 0!==event.timeCleared&&null!==event.timeCleared&&event.timeCleared.valueOf()>0?appendDefinitionItem("Column_Header_Cleared",TcHmi.Localization.formatDate(event.timeCleared)):appendDefinitionItem("Column_Header_Cleared",""),void 0!==event.timeConfirmed&&null!==event.timeConfirmed&&event.timeConfirmed.valueOf()>0?appendDefinitionItem("Column_Header_Confirmed",TcHmi.Localization.formatDate(event.timeConfirmed)):appendDefinitionItem("Column_Header_Confirmed",""),this.__confirmButton.setIsEnabled(event.confirmationState===TcHmi.Server.Events.ConfirmationState.WaitForConfirmation)):this.__confirmButton.setIsEnabled(!1)}else appendDefinitionItem("Column_Header_Received",TcHmi.Localization.formatDate(event.timeReceived)),this.__confirmButton.setIsEnabled(!1);if(event.type!==TcHmi.Server.Events.Type.Payload){let dtParams=document.createElement("dt");dtParams.textContent="Column_Header_Parameters",localize(dtParams,"Column_Header_Parameters"),dl.appendChild(dtParams);let ddParams=document.createElement("dd");event.params&&Object.keys(event.params).length>0?ddParams.appendChild(createObjectDetails(event.params)):ddParams.textContent="-",dl.appendChild(ddParams)}else{let dtPayload=document.createElement("dt");dtPayload.textContent="Column_Header_Payload",localize(dtPayload,"Column_Header_Payload"),dl.appendChild(dtPayload);let ddPayload=document.createElement("dd");dl.appendChild(ddPayload),void 0!==event.payload&&null!==event.payload?event.payload instanceof Date?ddPayload.textContent=TcHmi.Localization.formatDate(event.payload):"object"==typeof event.payload?ddPayload.appendChild(createObjectDetails(event.payload)):ddPayload.textContent=event.payload:ddPayload.textContent="-"}this.__elementContent.textContent="",this.__elementContent.appendChild(fragment)}getEvent(){return this.__event}__setCanConfirm(value){this.__confirmButton.getElement()[0].classList.toggle("TcHmi_Controls_System_TcHmiControl-operate-disallowed",!value),this.__confirmButton.getElement()[0].classList.toggle("tchmi-control-operate-disallowed",!value),this.__confirmButton.setIsEnabled(value)}}TcHmiEventGridPopups.DetailsPopup=DetailsPopup}(TcHmiEventGridPopups=Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={})),function(TcHmi){let Controls;!function(Controls){let Beckhoff;!function(Beckhoff){let TcHmiEventGridPopups;!function(TcHmiEventGridPopups){class ConfirmAllPopup extends TcHmiEventGridPopups.Popup{constructor(element,control){if(super(element,"confirmAllPopup",control),this.__alarms=[],this.__elementAlarmCount=this.__elementContent.getElementsByClassName("TcHmi_Controls_Beckhoff_TcHmiEventGrid-template-confirm-all-popup-alarm-count")[0],!this.__elementAlarmCount)throw new Error("Invalid Template.html");let datagrid=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiDatagrid",`${this.__parentControl.getId()}.${this.__name}.datagrid`,{"data-tchmi-src-column":[{name:"severity",label:"",control:"Image",width:30,widthUnit:"px",resize:!1,minWidth:30,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center",dataDefinitions:[{text:"Verbose",value:0,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/verbose.svg"},{text:"Info",value:1,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/info.svg"},{text:"Warning",value:2,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/warning.svg"},{text:"Error",value:3,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/error.svg"},{text:"Critical",value:4,height:26,width:26,source:Controls.getBasePathEx(control)+"/Themes/Base/Images/critical.svg"}]},{name:"timeRaised",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Raised%/l%",control:"TextBlock",format:{objectType:"Function",fn:"ToDateTimeString",fnParams:[]},width:150,widthUnit:"px",resize:!0,minWidth:70,minWidthUnit:"px",editable:!1,horizontalAlignment:"Center",verticalAlignment:"Center"},{name:"text",label:"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Column_Header_Text%/l%",control:"TextBlock",width:300,widthUnit:"px",resize:!0,minWidth:100,minWidthUnit:"px",editable:!1,horizontalAlignment:"Left",verticalAlignment:"Center"}]},this.__parentControl),yesButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.confirmButton`,{"data-tchmi-width":120,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_ConfirmAll_Yes%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_ConfirmAll_Yes%/l%","data-tchmi-is-enabled":!1},this.__parentControl),cancelButton=TcHmi.ControlFactory.createEx("TcHmi.Controls.Beckhoff.TcHmiButton",`${this.__parentControl.getId()}.${this.__name}.closeButton`,{"data-tchmi-width":60,"data-tchmi-height":30,"data-tchmi-text":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Text_Cancel%/l%","data-tchmi-tooltip":"%l%Control::TcHmi.Controls.Beckhoff.TcHmiEventGrid::Button_Tooltip_ConfirmAll_Cancel%/l%"},this.__parentControl);if(!datagrid||!yesButton||!cancelButton)throw new Error("Could not create controls for ConfirmAllPopup.");this.__datagrid=datagrid,this.__yesButton=yesButton,this.__elementContent.appendChild(this.__datagrid.getElement()[0]),this.__elementFooter.appendChild(yesButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(yesButton.getId()+".onPressed",()=>{for(let i=0,ii=this.__alarms.length;i<ii;i++)TcHmi.Server.Events.confirmAlarm(this.__alarms[i],data=>{data.error!==TcHmi.Errors.NONE&&TCHMI_CONSOLE_LOG_LEVEL>=1&&TcHmi.Log.error("[Source=Control, Module=TcHmi.Controls.Beckhoff.TcHmiEventGrid, Id="+this.__parentControl.getId()+"] Unable to confirm alarm with id "+this.__alarms[i].id+" in domain "+this.__alarms[i].domain+". Error: "+TcHmi.Log.buildMessage(data.details)),"object"==typeof data.details&&null!==data.details&&data.details.code===TcHmi.Server.Error.HMI_E_INSUFFICIENT_ACCESS&&this.__parentControl.__setCanConfirm(!1)});this.hide()})),this.__elementFooter.appendChild(cancelButton.getElement()[0]),this.__eventDestroyers.push(TcHmi.EventProvider.register(cancelButton.getId()+".onPressed",()=>this.hide()))}destroy(){super.destroy(),this.__parentControl.__removeLocalizedElement(this.__elementAlarmCount)}update(alarms){this.__alarms=alarms,this.__parentControl.__removeLocalizedElement(this.__elementAlarmCount),this.__datagrid.setSrcData(this.__alarms),this.__yesButton.setIsEnabled(this.__alarms.length>0),1===this.__alarms.length?this.__parentControl.__addLocalizedElement(this.__elementAlarmCount,"Label_Text_ConfirmAll_Sure_Singular"):this.__parentControl.__addLocalizedElement(this.__elementAlarmCount,"Label_Text_ConfirmAll_Sure_Plural",this.__alarms.length),this.__elementContent.style.height=30*this.__alarms.length+70+"px"}getAlarms(){return this.__alarms}}TcHmiEventGridPopups.ConfirmAllPopup=ConfirmAllPopup}(TcHmiEventGridPopups=Beckhoff.TcHmiEventGridPopups||(Beckhoff.TcHmiEventGridPopups={}))}(Beckhoff=Controls.Beckhoff||(Controls.Beckhoff={}))}(Controls=TcHmi.Controls||(TcHmi.Controls={}))}(TcHmi||(TcHmi={}));